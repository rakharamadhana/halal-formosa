System.register(["./index-legacy-DryGZUwD.js","./useNotifier-legacy-SkfUyYsb.js","./html5-qrcode-legacy-D5DtuMLO.js"],function(e,l){"use strict";var t,a,o,i,n,u,d,r,f,c,s,p,m,_,v,h,g,y,b,$,P,k,w,C,x,V,F,j,D,N,U,q,E,L,O,T,A,B,G,M,S,z,H,I,J,K,Q,R,W,Y,Z,X,ee,le,te,ae;return{setters:[e=>{t=e.d,a=e.a6,o=e.aY,i=e.r,n=e.aZ,u=e.a_,d=e.s,r=e.B,f=e.aD,c=e.a$,s=e.aF,p=e.b0,m=e.c,_=e.w,v=e.u,h=e.b,g=e.e,y=e.O,b=e.P,$=e.Q,P=e.p,k=e.t,w=e.R,C=e.b1,x=e.S,V=e.k,F=e.D,j=e.N,D=e.i,N=e.ai,U=e.aj,q=e.n,E=e.aK,L=e.b2,O=e.V,T=e.b3,A=e.b4,B=e.aE,G=e.ao,M=e.j,S=e.W,z=e.H,H=e.F,I=e.an,J=e.J,K=e.aq,Q=e.aG,R=e.ar,W=e.b5,Y=e.aL,Z=e.b6,X=e.b7,ee=e.y,le=e.b8,te=e.b9},e=>{ae=e.u},null],execute:function(){const l={style:{"margin-top":"6px"}},oe=["src"],ie=["src"],ne={style:{margin:"0","padding-left":"1rem","font-size":"0.9rem"}};e("default",t({__name:"EditProfileView",setup(e){const{notifyEvent:t}=ae(),ue=r(),de=a(()=>!o.value);let re=null;const fe=i(!1),ce=i(!1),se=i(""),pe=i(null),me=i(!0),_e=a(()=>n.value.filter(e=>e.name.common.toLowerCase().includes(se.value.toLowerCase())));async function saveProfile(){if(!re)return;await le(re);const{data:e,error:l}=await d.from("user_profiles").select("\n      display_name,\n      bio,\n      date_of_birth,\n      nationality,\n      profile_completed_notified\n    ").eq("id",re).single();if(l||!e)return console.warn("Failed to reload profile after save",l),void ue.back();if(e.bio&&e.date_of_birth&&e.nationality&&!e.profile_completed_notified){var a,o,i,u,r;const l=null!==(a=null===(o=n.value.find(l=>l.cca2===e.nationality))||void 0===o?void 0:o.name.common)&&void 0!==a?a:e.nationality,f=["A user has completed their profile and is now active.","",`ðŸ“§ Email: ${null!==(i=null===(u=te.value)||void 0===u?void 0:u.email)&&void 0!==i?i:"unknown"}`,`ðŸ‘¤ Name: ${e.display_name||"Not provided"}`,`ðŸŽ‚ Date of Birth: ${e.date_of_birth}`,`ðŸŒ Nationality: ${l}`].join("\n");t("user_activated","ðŸŽ‰ User Activated",f,void 0,{user_id:re,email:null===(r=te.value)||void 0===r?void 0:r.email,name:e.display_name,date_of_birth:e.date_of_birth,nationality:l},["discord"]).catch(console.error),await d.from("user_profiles").update({profile_completed_notified:!0}).eq("id",re)}ue.replace("/profile")}return u(async()=>{const{data:e}=await d.auth.getUser();null!=e&&e.user?(re=e.user.id,await f(re),n.value.length||await c(),s.value&&(pe.value=n.value.find(e=>e.cca2===s.value)||null),me.value=!1):ue.push("/login")}),p((e,l,t)=>{fe.value||o.value?t():t(!1)}),(e,t)=>(h(),m(v(ee),null,{default:_(()=>[g(v(y),null,{default:_(()=>[g(v(b),null,{default:_(()=>[g(v($),null,{default:_(()=>[P(k(e.$t("profile.editProfile.title")),1)]),_:1}),g(v(w),{slot:"start"},{default:_(()=>[g(v(C),{"default-href":"/profile",disabled:!fe.value&&!v(o)},null,8,["disabled"])]),_:1})]),_:1})]),_:1}),g(v(x),{class:"ion-padding"},{default:_(()=>[de.value?(h(),m(v(F),{key:0,color:"warning",class:"ion-margin-bottom"},{default:_(()=>[g(v(j),null,{default:_(()=>[D("strong",null,k(e.$t("profile.editProfile.mustCompleteTitle")),1),D("p",l,k(e.$t("profile.editProfile.mustCompleteDesc")),1)]),_:1})]),_:1})):V("",!0),g(v(N),null,{default:_(()=>[g(v(U),null,{default:_(()=>[g(v(q),null,{default:_(()=>[P(k(e.$t("profile.editProfile.dob")),1)]),_:1}),g(v(E),{slot:"end"},{default:_(()=>[g(v(L),{datetime:"dobPicker"})]),_:1}),g(v(O),{"keep-contents-mounted":"true"},{default:_(()=>[g(v(T),{id:"dobPicker",color:"carrot",modelValue:v(B),"onUpdate:modelValue":t[0]||(t[0]=e=>A(B)?B.value=e:null),presentation:"date","show-default-buttons":!0,"done-text":e.$t("common.ok"),"cancel-text":e.$t("common.cancel")},null,8,["modelValue","done-text","cancel-text"])]),_:1})]),_:1}),g(v(U),{button:"",onClick:t[1]||(t[1]=e=>ce.value=!0)},{default:_(()=>[g(v(q),null,{default:_(()=>[P(k(e.$t("profile.editProfile.nationality")),1)]),_:1}),g(v(G),{slot:"end",style:{color:"var(--ion-color-dark)"}},{default:_(()=>[v(n).length?pe.value?(h(),M(z,{key:1},[D("img",{src:pe.value.flags.png,style:{width:"24px",height:"16px","margin-right":"8px"},alt:"Country Flag"},null,8,oe),P(" "+k(pe.value.name.common),1)],64)):(h(),M(z,{key:2},[P(k(e.$t("profile.editProfile.selectCountry")),1)],64)):(h(),m(v(S),{key:0,animated:"",style:{width:"100px",height:"16px"}}))]),_:1})]),_:1}),g(v(O),{"is-open":ce.value,onDidDismiss:t[4]||(t[4]=e=>ce.value=!1)},{default:_(()=>[g(v(y),null,{default:_(()=>[g(v(b),null,{default:_(()=>[g(v($),null,{default:_(()=>[P(k(e.$t("profile.editProfile.selectNationality")),1)]),_:1}),g(v(w),{slot:"end"},{default:_(()=>[g(v(H),{onClick:t[2]||(t[2]=e=>ce.value=!1)},{default:_(()=>[P(k(e.$t("common.close")),1)]),_:1})]),_:1})]),_:1}),g(v(b),null,{default:_(()=>[g(v(I),{modelValue:se.value,"onUpdate:modelValue":t[3]||(t[3]=e=>se.value=e),placeholder:e.$t("profile.editProfile.searchCountry")},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),g(v(x),null,{default:_(()=>[g(v(N),null,{default:_(()=>[(h(!0),M(z,null,J(_e.value,e=>(h(),m(v(U),{key:e.cca2,button:"",onClick:l=>function selectCountry(e){s.value=e.cca2,pe.value=e,ce.value=!1}(e)},{default:_(()=>[D("img",{src:e.flags.png,style:{width:"24px",height:"16px","margin-right":"8px"},alt:"Country Flag"},null,8,ie),g(v(q),null,{default:_(()=>[P(k(e.name.common),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1},8,["is-open"]),g(v(U),null,{default:_(()=>[g(v(q),null,{default:_(()=>[P(k(e.$t("profile.editProfile.gender")),1)]),_:1}),g(v(K),{modelValue:v(Q),"onUpdate:modelValue":t[5]||(t[5]=e=>A(Q)?Q.value=e:null),interface:"popover",slot:"end",placeholder:e.$t("profile.editProfile.selectGender")},{default:_(()=>[g(v(R),{value:"Male"},{default:_(()=>[P(k(e.$t("profile.editProfile.genderMale")),1)]),_:1}),g(v(R),{value:"Female"},{default:_(()=>[P(k(e.$t("profile.editProfile.genderFemale")),1)]),_:1}),g(v(R),{value:"Other"},{default:_(()=>[P(k(e.$t("profile.editProfile.genderOther")),1)]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1}),g(v(U),null,{default:_(()=>[g(v(q),{position:"stacked"},{default:_(()=>[P(k(e.$t("profile.editProfile.bio")),1)]),_:1}),g(v(W),{modelValue:v(Y),"onUpdate:modelValue":t[6]||(t[6]=e=>A(Y)?Y.value=e:null),"auto-grow":"",placeholder:e.$t("profile.editProfile.bioPlaceholder")},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),g(v(U),{lines:"none"},{default:_(()=>[g(v(Z),{checked:v(X),onIonChange:t[7]||(t[7]=e=>X.value=e.detail.checked),slot:"start"},null,8,["checked"]),g(v(q),null,{default:_(()=>[P(k(e.$t("profile.editProfile.consentTitle"))+" ",1),D("ul",ne,[D("li",null,k(e.$t("profile.editProfile.consentContent1")),1),D("li",null,k(e.$t("profile.editProfile.consentContent2")),1)])]),_:1})]),_:1}),g(v(H),{expand:"block",color:"carrot",onClick:saveProfile,disabled:!v(o)},{default:_(()=>[P(k(de.value?e.$t("profile.editProfile.completeToContinue"):e.$t("profile.editProfile.save")),1)]),_:1},8,["disabled"])]),_:1})]),_:1}))}}))}}});
