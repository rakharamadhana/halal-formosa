System.register(["./index-legacy-DryGZUwD.js","./html5-qrcode-legacy-D5DtuMLO.js"],function(e,a){"use strict";var l,o,t,n,u,r,s,d,i,c,_,f,g,p,v,m,h,y,x,b,w,k,C,S,T,z,R,D,L,N,M,j,E,I,O,U,A,H,P,V,J,q,B,F,G,K,Q;return{setters:[e=>{l=e.d,o=e.a2,t=e.a3,n=e.a4,u=e.a5,r=e.r,s=e.o,d=e.c,i=e.w,c=e.u,_=e.s,f=e.b,g=e.e,p=e.O,v=e.ad,m=e.aM,h=e.S,y=e.ae,x=e.af,b=e.ai,w=e.j,k=e.H,C=e.J,S=e.aj,T=e.k,z=e.ak,R=e.i,D=e.n,L=e.t,N=e.p,M=e.ao,j=e.ag,E=e.V,I=e.P,O=e.Q,U=e.R,A=e.F,H=e.D,P=e.G,V=e.E,J=e.N,q=e.aK,B=e.b5,F=e.cf,G=e.cg,K=e.y,Q=e._},null],execute:function(){var a=document.createElement("style");a.textContent=".log-label h2.log-user[data-v-d4e6c8b4]{margin:0 0 4px;font-weight:600}.log-product[data-v-d4e6c8b4]{margin:4px 0;font-size:.9rem}.log-action[data-v-d4e6c8b4]{display:flex;align-items:center;gap:8px;margin:4px 0}.log-time[data-v-d4e6c8b4]{margin:0;font-size:.85rem;color:var(--ion-color-medium)}.ocr-block[data-v-d4e6c8b4]{background:var(--ion-color-light);padding:10px;border-radius:8px;white-space:pre-wrap;font-size:14px}.json-block[data-v-d4e6c8b4]{background:#1e1e1e;color:#c4c4c4;padding:12px;border-radius:8px;font-size:12px;overflow-x:auto}.copy-area[data-v-d4e6c8b4]{background:var(--ion-color-light);border-radius:8px;padding:8px;font-size:14px;white-space:pre-wrap;--highlight-color-focused: transparent}.copy-area.mono[data-v-d4e6c8b4]{font-family:monospace;font-size:13px}\n",document.head.appendChild(a);const W=["src"],X={class:"log-user"},Y={class:"log-product"},Z={class:"log-action"},$={class:"log-time"},ee={class:"log-time"};e("default",Q(l({__name:"ScanLogsView",setup(e){o.extend(t),o.extend(n),o.extend(u);const a=r([]),l=r(!1),Q=r(!1),ae=r(!1),le=r(null);function closeModal(){ae.value=!1,le.value=null}function handleRefresh(e){fetchLogs(!0).then(()=>{e.target.complete()})}function fromNowToTaipei(e){return e?o.utc(e).tz("Asia/Taipei").fromNow():""}async function fetchLogs(e=!1){e&&(a.value=[],Q.value=!1);const l=a.value.length,{data:o,error:t}=await _.from("ingredient_scan_logs").select("\n      *,\n      user_profiles: user_id (\n        display_name,\n        avatar_url,\n        email\n      )\n    ").order("created_at",{ascending:!1}).range(l,l+15-1);t?console.error("‚ùå Error fetching logs:",t):((!o||o.length<15)&&(Q.value=!0),a.value.push(...o.map(e=>{var a,l,o;return{...e,display_name:null===(a=e.user_profiles)||void 0===a?void 0:a.display_name,email:null===(l=e.user_profiles)||void 0===l?void 0:l.email,avatar_url:null===(o=e.user_profiles)||void 0===o?void 0:o.avatar_url}})))}async function loadMore(e){l.value||Q.value||(l.value=!0,await fetchLogs(),l.value=!1),e.target.complete()}return s(()=>fetchLogs(!0)),(e,l)=>(f(),d(c(K),null,{default:i(()=>[g(c(p),null,{default:i(()=>[g(v,{title:"Ingredient Scan Logs",icon:c(m),showBack:!0},null,8,["icon"])]),_:1}),g(c(h),{class:"ion-padding"},{default:i(()=>[g(c(y),{slot:"fixed",onIonRefresh:handleRefresh},{default:i(()=>[g(c(x))]),_:1}),g(c(b),null,{default:i(()=>[(f(!0),w(k,null,C(a.value,e=>(f(),d(c(S),{key:e.id,button:"",detail:"",onClick:a=>function openDetails(e){le.value=e,ae.value=!0}(e)},{default:i(()=>[e.avatar_url?(f(),d(c(z),{key:0,slot:"start"},{default:i(()=>[R("img",{src:e.avatar_url,alt:"User Avatar"},null,8,W)]),_:2},1024)):T("",!0),g(c(D),{class:"log-label"},{default:i(()=>[R("h2",X,L(e.full_name||e.display_name||e.email||"Unknown User"),1),R("p",Y,[l[0]||(l[0]=N(" üõí ",-1)),R("strong",null,L(e.product_name||"Unknown Product"),1)]),R("div",Z,[g(c(M),{color:"dark"},{default:i(()=>[R("strong",null,"Status: "+L(e.auto_status||"N/A"),1)]),_:2},1024),g(c(j),{color:"camera"===e.source?"primary":"secondary"},{default:i(()=>[N(L(e.source),1)]),_:2},1032,["color"])]),R("p",$,L(fromNowToTaipei(e.created_at)),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1}),g(c(E),{"is-open":ae.value,onDidDismiss:closeModal},{default:i(()=>[g(c(p),null,{default:i(()=>[g(c(I),null,{default:i(()=>[g(c(O),null,{default:i(()=>l[1]||(l[1]=[N("Scan Details",-1)])),_:1,__:[1]}),g(c(U),{slot:"end"},{default:i(()=>[g(c(A),{onClick:closeModal},{default:i(()=>l[2]||(l[2]=[N("Close",-1)])),_:1,__:[2]})]),_:1})]),_:1})]),_:1}),g(c(h),{class:"ion-padding"},{default:i(()=>[le.value?(f(),d(c(H),{key:0},{default:i(()=>[g(c(P),null,{default:i(()=>[g(c(V),null,{default:i(()=>[N(L(le.value.product_name||"Unknown Product"),1)]),_:1}),R("p",ee,L(fromNowToTaipei(le.value.created_at)),1)]),_:1}),g(c(J),null,{default:i(()=>[g(c(b),{lines:"none"},{default:i(()=>[g(c(S),null,{default:i(()=>[g(c(D),null,{default:i(()=>l[3]||(l[3]=[N("Status",-1)])),_:1,__:[3]}),g(c(j),{color:"Haram"===le.value.auto_status?"danger":"Syubhah"===le.value.auto_status?"warning":"Halal"===le.value.auto_status?"success":"primary"},{default:i(()=>[N(L(le.value.auto_status),1)]),_:1},8,["color"])]),_:1}),g(c(S),null,{default:i(()=>[g(c(D),null,{default:i(()=>l[4]||(l[4]=[N("Source",-1)])),_:1,__:[4]}),g(c(q),{slot:"end"},{default:i(()=>[N(L(le.value.source),1)]),_:1})]),_:1}),g(c(S),null,{default:i(()=>[g(c(D),null,{default:i(()=>l[5]||(l[5]=[N("Device",-1)])),_:1,__:[5]}),g(c(q),{slot:"end"},{default:i(()=>[N(L(le.value.device_model)+" ("+L(le.value.platform)+") ",1)]),_:1})]),_:1}),le.value.processing_time_ms?(f(),d(c(S),{key:0},{default:i(()=>[g(c(D),null,{default:i(()=>l[6]||(l[6]=[N("Processing Time",-1)])),_:1,__:[6]}),g(c(q),{slot:"end"},{default:i(()=>[N(L(le.value.processing_time_ms)+" ms",1)]),_:1})]),_:1})):T("",!0),le.value.error_message?(f(),d(c(S),{key:1},{default:i(()=>[g(c(D),null,{default:i(()=>l[7]||(l[7]=[N("Error",-1)])),_:1,__:[7]}),g(c(q),{slot:"end",color:"danger"},{default:i(()=>[N(L(le.value.error_message),1)]),_:1})]),_:1})):T("",!0),g(c(S),null,{default:i(()=>[g(c(D),null,{default:i(()=>l[8]||(l[8]=[N("App Version",-1)])),_:1,__:[8]}),g(c(q),{slot:"end"},{default:i(()=>[N(L(le.value.app_version),1)]),_:1})]),_:1})]),_:1}),l[9]||(l[9]=R("h1",{style:{"margin-top":"16px"}},"OCR Chinese",-1)),g(c(B),{readonly:"","auto-grow":!0,class:"copy-area",value:le.value.ingredients_text_zh||"‚Äî"},null,8,["value"]),l[10]||(l[10]=R("h1",null,"OCR English",-1)),g(c(B),{readonly:"","auto-grow":!0,class:"copy-area",value:le.value.ingredients_text_en||"‚Äî"},null,8,["value"]),l[11]||(l[11]=R("h1",null,"Detected Highlights",-1)),g(c(B),{readonly:"","auto-grow":!0,class:"copy-area mono",value:JSON.stringify(le.value.highlight_summary,null,2)},null,8,["value"]),l[12]||(l[12]=R("h1",null,"Raw OCR Text",-1)),g(c(B),{readonly:"","auto-grow":!0,class:"copy-area mono",value:le.value.ocr_raw||"‚Äî"},null,8,["value"])]),_:1,__:[9,10,11,12]})]),_:1})):T("",!0)]),_:1})]),_:1},8,["is-open"]),g(c(F),{threshold:"100px",onIonInfinite:loadMore,disabled:Q.value},{default:i(()=>[g(c(G),{"loading-spinner":"bubbles","loading-text":"Loading more logs..."})]),_:1},8,["disabled"])]),_:1})]),_:1}))}}),[["__scopeId","data-v-d4e6c8b4"]]))}}});
