import{d as e,bm as l,r as a,a6 as t,o,c as r,w as i,u as n,s as u,b as s,e as d,O as c,P as y,Q as f,p as v,t as p,R as m,b1 as k,k as _,F as g,S as b,D as h,G as w,E as x,N as C,j as R,H as V,J as q,aj as z,n as P,by as S,aq as E,ar as H,ah as I,ai as N,i as U,ao as j,ba as L,y as A,_ as M}from"./index-D9IhqqAc.js";import"./html5-qrcode-D_4nuB1t.js";const D={product_categories:{label:"Product Categories",pk:"id",fields:[{key:"name",label:"Name",type:"text",required:!0}]},ingredient_highlights:{label:"Ingredient Highlights",pk:"id",fields:[{key:"keyword",label:"Keyword (EN)",type:"text",required:!0},{key:"keyword_zh",label:"Keyword (ZH)",type:"text"},{key:"color",label:"Status",type:"select",required:!0,options:[{value:"primary",label:"Muslim-friendly"},{value:"warning",label:"Syubhah"},{value:"danger",label:"Haram"}]}]},location_types:{label:"Location Types",pk:"id",fields:[{key:"name",label:"Name",type:"text",required:!0},{key:"emoji",label:"Emoji",type:"text",required:!1},{key:"color",label:"Color (Hex)",type:"text",required:!1},{key:"icon",label:"Ionicon Key",type:"text",required:!1},{key:"is_active",label:"Active",type:"select",options:[{value:!0,label:"Active"},{value:!1,label:"Inactive"}]}]},stores:{label:"Stores",pk:"id",fields:[{key:"name",label:"Store Name",type:"text",required:!0},{key:"website",label:"Website",type:"url"},{key:"logo_url",label:"Logo URL",type:"url"},{key:"sort_order",label:"Sort Order",type:"number"}]},category_rules:{label:"Category Rules",pk:"id",fields:[{key:"keyword",label:"Keyword",type:"text",required:!0},{key:"category_id",label:"Category",type:"select",relation:{table:"product_categories",value:"id",label:"name"}}]}},F={key:0,style:{color:"red"}},K={class:"highlight-row"},O={key:0,class:"meta"},W={key:0,class:"meta"},G={key:0,style:{display:"flex","justify-content":"center",gap:"12px",margin:"1rem 0"}},J=M(e({__name:"AdminMasterDataEditor",setup(e){const M=l().params.table,J=D[M];if(!J)throw new Error("Invalid master data table");const Q=a([]),T=a({}),Z=a({}),B=a(null),X=a(!1),Y=a(!1),$=a(1),ee=a(0);async function fetchRows(){X.value=!0;const e=10*($.value-1),l=e+10-1,{data:a,count:t,error:o}=await u.from(M).select("*",{count:"exact"}).order(J.pk,{ascending:!0}).range(e,l);o||(Q.value=a||[],ee.value=t||0),X.value=!1}async function save(){Y.value=!0;const e={...Z.value};"ingredient_highlights"===M&&e.color&&(e.color=function toCssColor(e){return e.startsWith("--ion-color-")?e:"--ion-color-".concat(e)}(e.color)),B.value?await u.from(M).update(e).eq(J.pk,B.value):await u.from(M).insert(e),resetForm(),$.value=1,await fetchRows(),Y.value=!1}function resetForm(){B.value=null,Z.value={}}const le=t(()=>Math.ceil(ee.value/10));function nextPage(){$.value<le.value&&($.value++,fetchRows())}function prevPage(){$.value>1&&($.value--,fetchRows())}function displayPrimary(e){return e.name||e.keyword||e.id}function displaySecondary(e){if(e.keyword_zh)return e.keyword_zh;if(e.website)return e.website;if(e.category_id&&T.value.category_id){const l=T.value.category_id.find(l=>l.id===e.category_id);return(null==l?void 0:l.name)||""}return""}function getHighlightLabel(e){switch(e){case"--ion-color-primary":return"Muslim-friendly";case"--ion-color-warning":return"Syubhah";case"--ion-color-danger":return"Haram";default:return e}}function normalizeIonColor(e){return e?e.replace("--ion-color-",""):"medium"}function getRelationValue(e){var l;return null==(l=e.relation)?void 0:l.value}function getRelationLabel(e){var l;return null==(l=e.relation)?void 0:l.label}return o(async()=>{await async function fetchRelations(){for(const e of J.fields)if(e.relation){const{table:l,value:a,label:t}=e.relation,{data:o}=await u.from(l).select("".concat(a,", ").concat(t)).order(t);T.value[e.key]=o||[]}}(),await fetchRows()}),(e,l)=>(s(),r(n(A),null,{default:i(()=>[d(n(c),null,{default:i(()=>[d(n(y),null,{default:i(()=>[d(n(f),null,{default:i(()=>{var e;return[v(p((null==(e=n(J))?void 0:e.label)||"Master Data"),1)]}),_:1}),d(n(m),{slot:"start"},{default:i(()=>[d(n(k),{"default-href":"/admin/master-data"})]),_:1}),d(n(m),{slot:"end"},{default:i(()=>[B.value?(s(),r(n(g),{key:0,color:"medium",size:"small",onClick:resetForm},{default:i(()=>l[0]||(l[0]=[v(" Cancel Edit ",-1)])),_:1,__:[0]})):_("",!0)]),_:1})]),_:1})]),_:1}),d(n(b),{class:"ion-padding"},{default:i(()=>[n(J)?(s(),r(n(h),{key:0},{default:i(()=>[d(n(w),null,{default:i(()=>[d(n(x),null,{default:i(()=>[v(p(B.value?"Edit":"Add New")+" "+p(n(J).label),1)]),_:1})]),_:1}),d(n(C),null,{default:i(()=>[(s(!0),R(V,null,q(n(J).fields,e=>(s(),r(n(z),{key:e.key,lines:"full"},{default:i(()=>{return[d(n(P),{position:"stacked"},{default:i(()=>[v(p(e.label)+" ",1),e.required?(s(),R("span",F,"*")):_("",!0)]),_:2},1024),["text","url","number"].includes(e.type)?(s(),r(n(S),{key:0,modelValue:Z.value[e.key],"onUpdate:modelValue":l=>Z.value[e.key]=l,type:(l=e.type,"number"===l?"number":"url"===l?"url":"text"),placeholder:e.label},null,8,["modelValue","onUpdate:modelValue","type","placeholder"])):"select"===e.type&&e.options?(s(),r(n(E),{key:1,modelValue:Z.value[e.key],"onUpdate:modelValue":l=>Z.value[e.key]=l,interface:"popover"},{default:i(()=>[(s(!0),R(V,null,q(e.options,e=>(s(),r(n(H),{key:e.value,value:e.value},{default:i(()=>[v(p(e.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):_("",!0),"color"===e.key&&Z.value.color?(s(),r(n(I),{key:2,color:Z.value.color,style:{"margin-top":"8px"}},{default:i(()=>{var l,a;return[v(p(null==(a=null==(l=e.options)?void 0:l.find(e=>e.value===Z.value.color))?void 0:a.label),1)]}),_:2},1032,["color"])):"select"===e.type&&e.relation?(s(),r(n(E),{key:3,modelValue:Z.value[e.key],"onUpdate:modelValue":l=>Z.value[e.key]=l,interface:"popover"},{default:i(()=>[(s(!0),R(V,null,q(T.value[e.key],l=>(s(),r(n(H),{key:l[getRelationValue(e)],value:l[getRelationValue(e)]},{default:i(()=>[v(p(l[getRelationLabel(e)]),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):_("",!0)];var l}),_:2},1024))),128)),d(n(g),{expand:"block",color:"carrot",style:{"margin-top":"1rem"},disabled:Y.value,onClick:save},{default:i(()=>[v(p(B.value?"Update":"Add"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})):_("",!0),Q.value.length?(s(),r(n(h),{key:1},{default:i(()=>[d(n(w),null,{default:i(()=>[d(n(x),null,{default:i(()=>[v("Existing "+p(n(J).label),1)]),_:1})]),_:1}),d(n(C),null,{default:i(()=>[d(n(N),null,{default:i(()=>[(s(!0),R(V,null,q(Q.value,e=>(s(),r(n(z),{key:e[n(J).pk],lines:"full"},{default:i(()=>[d(n(P),null,{default:i(()=>["ingredient_highlights"===n(M)?(s(),R(V,{key:0},[U("div",K,[U("strong",null,p(e.keyword),1)]),e.keyword_zh?(s(),R("div",O,p(e.keyword_zh),1)):_("",!0),e.color?(s(),r(n(I),{key:1,color:normalizeIonColor(e.color),size:"small"},{default:i(()=>[v(p(getHighlightLabel(e.color)),1)]),_:2},1032,["color"])):_("",!0)],64)):(s(),R(V,{key:1},[U("strong",null,p(displayPrimary(e)),1),displaySecondary(e)?(s(),R("div",W,p(displaySecondary(e)),1)):_("",!0)],64))]),_:2},1024),d(n(m),{slot:"end"},{default:i(()=>[d(n(g),{size:"small",fill:"clear",color:"primary",onClick:l=>function editRow(e){B.value=e[J.pk];const l={...e};"ingredient_highlights"===M&&l.color&&(l.color=normalizeIonColor(l.color)),Z.value=l}(e)},{default:i(()=>l[1]||(l[1]=[v(" Edit ",-1)])),_:2,__:[1]},1032,["onClick"]),d(n(g),{size:"small",fill:"clear",color:"danger",onClick:l=>async function remove(e){confirm("Are you sure you want to delete this item?")&&(await u.from(M).delete().eq(J.pk,e),1===Q.value.length&&$.value>1&&$.value--,await fetchRows())}(e[n(J).pk])},{default:i(()=>l[2]||(l[2]=[v(" Delete ",-1)])),_:2,__:[2]},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),ee.value>10?(s(),R("div",G,[d(n(g),{size:"small",fill:"outline",disabled:1===$.value,onClick:prevPage},{default:i(()=>l[3]||(l[3]=[v(" Previous ",-1)])),_:1,__:[3]},8,["disabled"]),d(n(j),{style:{"align-self":"center"}},{default:i(()=>[v(" Page "+p($.value)+" of "+p(le.value),1)]),_:1}),d(n(g),{size:"small",fill:"outline",disabled:$.value>=le.value,onClick:nextPage},{default:i(()=>l[4]||(l[4]=[v(" Next ",-1)])),_:1,__:[4]},8,["disabled"])])):_("",!0)]),_:1})):_("",!0),Q.value.length||X.value?_("",!0):(s(),r(n(j),{key:2,color:"medium"},{default:i(()=>l[5]||(l[5]=[U("p",{style:{"text-align":"center","margin-top":"2rem"}}," No data yet. ",-1)])),_:1,__:[5]})),X.value?(s(),r(n(L),{key:3,class:"center-spinner"})):_("",!0)]),_:1})]),_:1}))}}),[["__scopeId","data-v-c62d634c"]]);export{J as default};
