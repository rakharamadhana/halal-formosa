System.register(["./index-legacy-DryGZUwD.js","./html5-qrcode-legacy-D5DtuMLO.js"],function(e,t){"use strict";var a,o,r,i,l,n,s,d,c,u,p,m,f,g,v,h,x,y,b,w,_,k,C,z,F,I,P,j,N,S,U,R,A,H,q,M,T,E,O,D,Y,V,$,B,J,K,L,W,X,G,Q,Z,ee,te;return{setters:[e=>{a=e.d,o=e.r,r=e.a6,i=e.o,l=e.s,n=e.c,s=e.w,d=e.u,c=e.B,u=e.b,p=e.e,m=e.O,f=e.ad,g=e.aP,v=e.S,h=e.j,x=e.k,y=e.ba,b=e.H,w=e.bb,_=e.D,k=e.i,C=e.t,z=e.U,F=e.p,I=e.F,P=e.l,j=e.bc,N=e.bd,S=e.q,U=e.aM,R=e.J,A=e.ai,H=e.aj,q=e.n,M=e.be,T=e.aS,E=e.bf,O=e.bg,D=e.ah,Y=e.L,V=e.bh,$=e.bi,B=e.bj,J=e.y,K=e.a9,L=e.aW,W=e.aX,X=e.aa,G=e.a8,Q=e.bk,Z=e.aV,ee=e.bl,te=e._},null],execute:function(){var t=document.createElement("style");t.textContent=".folder-grid[data-v-7501451f]{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:16px}.folder-card[data-v-7501451f]{background:var(--ion-color-light);border-radius:12px;padding:16px;display:flex;flex-direction:column;align-items:flex-start;cursor:pointer;box-shadow:0 4px 6px rgba(0,0,0,.02);transition:transform .2s ease}.folder-card[data-v-7501451f]:active{transform:scale(.96)}.folder-icon-wrapper[data-v-7501451f]{background:rgba(var(--ion-color-carrot-rgb),.15);padding:10px;border-radius:10px;margin-bottom:12px}.folder-icon[data-v-7501451f]{font-size:28px;color:var(--ion-color-carrot)}.folder-info[data-v-7501451f]{display:flex;flex-direction:column;width:100%}.folder-name[data-v-7501451f]{font-weight:600;font-size:15px;margin-bottom:2px;color:var(--ion-color-dark);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;width:100%}.folder-count[data-v-7501451f]{font-size:13px;color:var(--ion-color-medium)}.item-card[data-v-7501451f]{background:var(--ion-color-light);border-radius:12px;display:flex;flex-direction:column;align-items:flex-start;cursor:pointer;box-shadow:0 4px 6px rgba(0,0,0,.02);transition:transform .2s ease;overflow:hidden;position:relative}.item-card[data-v-7501451f]:active{transform:scale(.96)}.item-move-btn[data-v-7501451f]{position:absolute;top:4px;right:40px;margin:0;--padding-start: 8px;--padding-end: 8px;background:rgba(255,255,255,.85);border-radius:50%;width:32px;height:32px;z-index:2}.item-delete-btn[data-v-7501451f]{position:absolute;top:4px;right:4px;margin:0;--padding-start: 8px;--padding-end: 8px;background:rgba(255,255,255,.85);border-radius:50%;width:32px;height:32px;z-index:2}.item-img-wrapper[data-v-7501451f]{width:100%;height:100px;background:#fff}.item-img-wrapper img[data-v-7501451f]{width:100%;height:100%;object-fit:contain}.item-info[data-v-7501451f]{padding:12px;display:flex;flex-direction:column;width:100%}\n",document.head.appendChild(t);const ae={key:0,class:"ion-text-center ion-margin-top"},oe={class:"ion-padding",style:{"padding-bottom":"12px"}},re={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"8px"}},ie={style:{"font-size":"14px","font-weight":"bold",color:"var(--ion-color-carrot)"}},le={key:0,style:{"font-size":"12px",color:"var(--ion-color-danger)","margin-top":"12px","margin-bottom":"0"}},ne={key:1,style:{"font-size":"12px",color:"var(--ion-color-medium)","margin-top":"12px","margin-bottom":"0"}},se={key:1,class:"ion-text-center ion-margin-top",style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",height:"50vh"}},de={key:2},ce={key:0},ue={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"16px"}},pe={style:{background:"var(--ion-color-light)","border-radius":"8px",display:"flex",padding:"2px"}},me={key:0,class:"folder-grid"},fe=["onClick"],ge={class:"folder-icon-wrapper"},ve={class:"folder-info"},he={class:"folder-name"},xe={class:"folder-count"},ye={style:{"font-size":"13px",color:"var(--ion-color-medium)"}},be={key:1},we={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"16px"}},_e={style:{"font-weight":"600"}},ke={style:{background:"var(--ion-color-light)","border-radius":"8px",display:"flex",padding:"2px"}},Ce={key:0,class:"ion-text-center ion-margin-top"},ze={key:1,class:"folder-grid"},Fe=["onClick"],Ie={class:"item-img-wrapper"},Pe=["src"],je={class:"item-info"},Ne={class:"folder-name"},Se=["src"],Ue={style:{"font-weight":"600"}};e("default",te(a({__name:"SavedItemsView",setup(e){const t=c(),a=o(!0),te=o([]),Re=o("grid"),Ae=o(null),He=r(()=>te.value.reduce((e,t)=>{var a;return e+((null===(a=t.saved_items)||void 0===a?void 0:a.length)||0)},0)),qe=r(()=>Ae.value&&te.value.find(e=>e.id===Ae.value)||null);function openFolder(e){Ae.value=e.id}function closeFolder(){Ae.value=null}async function presentRcPaywall(){if(!K.isNativePlatform())return console.warn("[RC] Paywall can only run on native apps."),!1;try{const{result:e}=await L.presentPaywall();if(e===W.PURCHASED||e===W.RESTORED)return await X({syncToServer:!0}),G.log("pro_purchase_success",{source:"saved_items_view"}),!0}catch(e){console.error("Paywall failed:",e)}return!1}async function loadFoldersAndItems(){a.value=!0;const{data:{user:e}}=await l.auth.getUser();if(!e)return void(a.value=!1);const{data:t}=await l.from("saved_item_folders").select("id, name").eq("user_id",e.id).order("created_at",{ascending:!1});if(!t||0===t.length)return te.value=[],void(a.value=!1);const{data:o}=await l.from("saved_items").select("\n      id,\n      folder_id,\n      products ( id, barcode, name, status, photo_front_url )\n    ").eq("user_id",e.id),r=t.map(e=>({...e,saved_items:o?o.filter(t=>t.folder_id===e.id):[]}));te.value=r,a.value=!1}async function promptCreateFolder(){const e=await Q.create({header:"New Folder",inputs:[{name:"folderName",type:"text",placeholder:"Folder Name"}],buttons:[{text:"Cancel",role:"cancel"},{text:"Create",handler:async e=>{e.folderName&&""!==e.folderName.trim()&&await async function createFolder(e){const{data:{user:t}}=await l.auth.getUser();if(!t)return;const{error:a}=await l.from("saved_item_folders").insert({user_id:t.id,name:e});a||await loadFoldersAndItems()}(e.folderName.trim())}}]});await e.present()}function goToItem(e){t.push(`/item/${e}`)}async function removeItem(e){const t=await Q.create({header:"Remove Item",message:"Are you sure you want to remove this item from your folder?",buttons:[{text:"Cancel",role:"cancel"},{text:"Remove",role:"destructive",handler:async()=>{await l.from("saved_items").delete().eq("id",e),await loadFoldersAndItems()}}]});await t.present()}async function moveItem(e,t,a){const{data:{user:o}}=await l.auth.getUser();if(!o)return;const r=te.value.filter(e=>e.id!==t);if(0===r.length){const e=await Q.create({header:"No Other Folders",message:"You have no other folders to move this item to. Create a new folder first!",buttons:["OK"]});return void(await e.present())}const i=r.map(t=>({text:t.name,icon:E,handler:async()=>{const{error:r}=await l.from("saved_items").insert({user_id:o.id,folder_id:t.id,product_id:a});if(r&&"23505"===r.code){const e=await Z.create({message:"Item already exists in that folder!",duration:2e3,color:"warning",position:"bottom"});await e.present()}else if(r){const e=await Z.create({message:"Failed to move item.",duration:2e3,color:"danger",position:"bottom"});await e.present()}else{await l.from("saved_items").delete().eq("id",e),await loadFoldersAndItems(),Ae.value=t.id;const a=await Z.create({message:`Moved to ${t.name}`,duration:2e3,color:"success",position:"bottom"});await a.present()}}}));i.push({text:"Cancel",icon:"close",role:"cancel",handler:()=>{}});const n=await ee.create({header:"Move to folder...",buttons:i});await n.present()}return i(async()=>{await loadFoldersAndItems()}),(e,t)=>(u(),n(d(J),null,{default:s(()=>[p(d(m),null,{default:s(()=>[p(f,{title:"Saved Items","show-back":"","back-route":"/profile",icon:d(g)},null,8,["icon"])]),_:1}),p(d(v),{class:"ion-padding"},{default:s(()=>[a.value?(u(),h("div",ae,[p(d(y))])):(u(),h(b,{key:1},[d(w)?x("",!0):(u(),n(d(_),{key:0,class:"ion-margin-bottom",style:{"margin-left":"0","margin-right":"0","box-shadow":"none",border:"1px solid var(--ion-color-light)","border-radius":"12px","margin-top":"0"}},{default:s(()=>[k("div",oe,[k("div",re,[t[4]||(t[4]=k("span",{style:{"font-size":"14px","font-weight":"600",color:"var(--ion-color-medium)"}},"Free Tier Usage",-1)),k("span",ie,C(He.value)+" / 10 ",1)]),p(d(z),{value:He.value/10,color:"carrot",style:{"border-radius":"4px",height:"8px"}},null,8,["value"]),He.value>=10?(u(),h("p",le," You've reached your free limit. Upgrade to Pro to save unlimited items! ")):(u(),h("p",ne,t[5]||(t[5]=[F(" Upgrade to ",-1),k("span",{style:{"font-weight":"600",color:"var(--ion-color-dark)"}},"Halal Formosa Pro",-1),F(" for unlimited saves. ",-1)]))),p(d(I),{expand:"block",color:"carrot",size:"small",style:{"margin-top":"12px","margin-bottom":"0"},onClick:presentRcPaywall},{default:s(()=>t[6]||(t[6]=[F(" Upgrade to Pro ",-1)])),_:1,__:[6]})])]),_:1})),0===te.value.length?(u(),h("div",se,[p(d(P),{icon:d(j),style:{"font-size":"64px",color:"var(--ion-color-medium)","margin-bottom":"16px"}},null,8,["icon"]),t[8]||(t[8]=k("h3",{style:{"margin-top":"0","font-weight":"600"}},"No Collections Yet",-1)),t[9]||(t[9]=k("p",{style:{color:"var(--ion-color-medium)","max-width":"80%"}},"Create a folder to start organizing your saved items!",-1)),p(d(I),{color:"carrot",style:{"margin-top":"16px"},onClick:promptCreateFolder},{default:s(()=>[p(d(P),{icon:d(N),slot:"start"},null,8,["icon"]),t[7]||(t[7]=F(" Create Folder ",-1))]),_:1,__:[7]})])):(u(),h("div",de,[qe.value?(u(),h("div",be,[k("div",we,[p(d(I),{fill:"clear",onClick:closeFolder,style:{margin:"0","margin-left":"-10px"}},{default:s(()=>[p(d(P),{icon:d(M),slot:"start"},null,8,["icon"]),k("span",_e,C(qe.value.name),1)]),_:1}),k("div",ke,[p(d(I),{fill:"clear",size:"small",color:"grid"===Re.value?"carrot":"medium",onClick:t[2]||(t[2]=e=>Re.value="grid"),style:{margin:"0","--padding-start":"8px","--padding-end":"8px"}},{default:s(()=>[p(d(P),{icon:d(S)},null,8,["icon"])]),_:1},8,["color"]),p(d(I),{fill:"clear",size:"small",color:"list"===Re.value?"carrot":"medium",onClick:t[3]||(t[3]=e=>Re.value="list"),style:{margin:"0","--padding-start":"8px","--padding-end":"8px"}},{default:s(()=>[p(d(P),{icon:d(U)},null,8,["icon"])]),_:1},8,["color"])])]),0===qe.value.saved_items.length?(u(),h("p",Ce,t[11]||(t[11]=[k("small",null,"No items saved here.",-1)]))):"grid"===Re.value?(u(),h("div",ze,[(u(!0),h(b,null,R(qe.value.saved_items,e=>(u(),h("div",{key:e.id,class:"item-card",onClick:t=>goToItem(e.products.barcode)},[p(d(I),{fill:"clear",color:"primary",class:"item-move-btn",onClick:T(t=>moveItem(e.id,qe.value.id,e.products.id),["stop"])},{default:s(()=>[p(d(P),{icon:d(E)},null,8,["icon"])]),_:2},1032,["onClick"]),p(d(I),{fill:"clear",color:"danger",class:"item-delete-btn",onClick:T(t=>removeItem(e.id),["stop"])},{default:s(()=>[p(d(P),{icon:d(O)},null,8,["icon"])]),_:2},1032,["onClick"]),k("div",Ie,[k("img",{src:e.products.photo_front_url||"https://via.placeholder.com/80.webp",alt:"Product Image"},null,8,Pe)]),k("div",je,[k("span",Ne,C(e.products.name),1),p(d(D),{size:"small",class:Y(["Halal"===e.products.status?"chip-success":"Muslim-friendly"===e.products.status?"chip-primary":"Syubhah"===e.products.status?"chip-warning":"Haram"===e.products.status?"chip-danger":"chip-medium"]),style:{"margin-left":"0","margin-top":"4px","font-size":"11px"}},{default:s(()=>[F(C(e.products.status),1)]),_:2},1032,["class"])])],8,Fe))),128))])):(u(),n(d(A),{key:2,style:{background:"transparent"}},{default:s(()=>[(u(!0),h(b,null,R(qe.value.saved_items,e=>(u(),n(d(H),{key:e.id,button:"",onClick:t=>goToItem(e.products.barcode),style:{"margin-bottom":"8px","--border-radius":"8px","--background":"var(--ion-color-light)"},lines:"none"},{default:s(()=>[p(d(V),{slot:"start",style:{"border-radius":"8px",overflow:"hidden"}},{default:s(()=>[k("img",{src:e.products.photo_front_url||"https://via.placeholder.com/80.webp",alt:"Product Image",style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,Se)]),_:2},1024),p(d(q),null,{default:s(()=>[k("h3",Ue,C(e.products.name),1),p(d(D),{size:"small",class:Y(["Halal"===e.products.status?"chip-success":"Muslim-friendly"===e.products.status?"chip-primary":"Syubhah"===e.products.status?"chip-warning":"Haram"===e.products.status?"chip-danger":"chip-medium"]),style:{"margin-left":"0","margin-top":"4px"}},{default:s(()=>[F(C(e.products.status),1)]),_:2},1032,["class"])]),_:2},1024),p(d(I),{fill:"clear",color:"primary",slot:"end",onClick:T(t=>moveItem(e.id,qe.value.id,e.products.id),["stop"])},{default:s(()=>[p(d(P),{icon:d(E)},null,8,["icon"])]),_:2},1032,["onClick"]),p(d(I),{fill:"clear",color:"danger",slot:"end",onClick:T(t=>removeItem(e.id),["stop"])},{default:s(()=>[p(d(P),{icon:d(O)},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["onClick"]))),128))]),_:1}))])):(u(),h("div",ce,[k("div",ue,[t[10]||(t[10]=k("h2",{style:{margin:"0","font-size":"1.2rem","font-weight":"600"}},"My Collections",-1)),k("div",pe,[p(d(I),{fill:"clear",size:"small",color:"grid"===Re.value?"carrot":"medium",onClick:t[0]||(t[0]=e=>Re.value="grid"),style:{margin:"0","--padding-start":"8px","--padding-end":"8px"}},{default:s(()=>[p(d(P),{icon:d(S)},null,8,["icon"])]),_:1},8,["color"]),p(d(I),{fill:"clear",size:"small",color:"list"===Re.value?"carrot":"medium",onClick:t[1]||(t[1]=e=>Re.value="list"),style:{margin:"0","--padding-start":"8px","--padding-end":"8px"}},{default:s(()=>[p(d(P),{icon:d(U)},null,8,["icon"])]),_:1},8,["color"])])]),"grid"===Re.value?(u(),h("div",me,[(u(!0),h(b,null,R(te.value,e=>(u(),h("div",{key:e.id,class:"folder-card",onClick:t=>openFolder(e)},[k("div",ge,[p(d(P),{icon:d(j),class:"folder-icon"},null,8,["icon"])]),k("div",ve,[k("span",he,C(e.name),1),k("span",xe,C(e.saved_items.length)+" items",1)])],8,fe))),128))])):(u(),n(d(A),{key:1,style:{background:"transparent"}},{default:s(()=>[(u(!0),h(b,null,R(te.value,e=>(u(),n(d(H),{key:e.id,button:"",onClick:t=>openFolder(e),style:{"margin-bottom":"8px","--border-radius":"8px","--background":"var(--ion-color-light)"},lines:"none"},{default:s(()=>[p(d(P),{icon:d(j),slot:"start",color:"carrot"},null,8,["icon"]),p(d(q),null,{default:s(()=>[k("h3",null,C(e.name),1),k("p",ye,C(e.saved_items.length)+" items",1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1}))]))]))],64)),te.value.length>0&&!qe.value?(u(),n(d($),{key:2,vertical:"bottom",horizontal:"end",slot:"fixed"},{default:s(()=>[p(d(B),{color:"carrot",onClick:promptCreateFolder},{default:s(()=>[p(d(P),{icon:d(N)},null,8,["icon"])]),_:1})]),_:1})):x("",!0)]),_:1})]),_:1}))}}),[["__scopeId","data-v-7501451f"]]))}}});
