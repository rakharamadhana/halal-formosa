System.register(["./index-legacy-DryGZUwD.js","./html5-qrcode-legacy-D5DtuMLO.js"],function(e,l){"use strict";var a,t,n,u,r,i,o,d,s,c,_,v,p,f,m,g,y,k,h,w,x,b,$,U,S,N,D,O,A,L,P,C,V,j,z,F,H,I,B;return{setters:[e=>{a=e.d,t=e.a2,n=e.a5,u=e.bm,r=e.r,i=e.o,o=e.aZ,d=e.a$,s=e.c,c=e.w,_=e.u,v=e.s,p=e.b,f=e.e,m=e.O,g=e.ad,y=e.aM,k=e.S,h=e.k,w=e.D,x=e.aj,b=e.ak,$=e.j,U=e.n,S=e.i,N=e.t,D=e.N,O=e.G,A=e.E,L=e.p,P=e.ai,C=e.aK,V=e.H,j=e.J,z=e.bh,F=e.cf,H=e.cg,I=e.y,B=e._},null],execute:function(){var l=document.createElement("style");l.textContent=".avatar-placeholder[data-v-42d35373]{width:40px;height:40px;border-radius:50%;background:var(--ion-color-light);display:flex;align-items:center;justify-content:center}.stats-card[data-v-42d35373]{padding:8px 4px}.stats-row[data-v-42d35373]{display:flex;gap:12px;margin-bottom:12px}.stats-row[data-v-42d35373]:last-child{margin-bottom:0}.stat-item[data-v-42d35373]{flex:1;background:var(--ion-background-color-step-50);border-radius:12px;padding:12px;text-align:center}.stat-item strong[data-v-42d35373]{display:block;font-size:1.3rem;font-weight:700;color:var(--ion-text-color)}.stat-item span[data-v-42d35373]{font-size:.8rem;color:var(--ion-color-medium)}.activity-title[data-v-42d35373]{font-weight:600}.activity-meta[data-v-42d35373]{font-size:.85rem;color:var(--ion-color-medium)}.activity-time[data-v-42d35373]{font-size:.75rem;color:var(--ion-color-medium)}.mono[data-v-42d35373]{font-family:monospace;font-size:.75rem}\n",document.head.appendChild(l);const M=["src"],R={key:1,class:"avatar-placeholder"},E={class:"stats-row"},T={class:"stat-item"},q={class:"stat-item"},G={class:"stats-row"},J={class:"stat-item"},Y={class:"stat-item"},K=["src"],Z={class:"activity-time"},Q=["src"],W={class:"activity-time"},X=["src"],ee={class:"activity-time"},le={class:"activity-title"},ae={class:"activity-meta"},te={key:0},ne={class:"activity-time"};e("default",B(a({__name:"UserDetailView",setup(e){t.extend(n);const l=u().params.id,a=r(null),B=r(null),ue=r([]),re=r(!1),ie=r(!1),oe=r([]),de=r([]),se=r([]),fromNow=e=>e?t(e).fromNow():"Never",ce=r(null);function getNationality(e){if(!e)return null;const l=o.value.find(l=>l.cca2===e);return l?{name:l.name.common,flag:l.flags.png}:null}function describeActivity(e){var l,a,t,n,u,r,i,o,d,s,c,_,v,p,f,m,g,y,k,h,w;const x=function parseDetail(e){if(!e)return{};if("string"==typeof e)try{return JSON.parse(e)}catch{return{}}return e}(e.activity_detail);switch(e.activity_type){case"home_page_open":return"Opened Home page";case"home_scan_ingredient":return"Opened ingredient scanner from Home";case"home_viewmore_products":return"Viewed more products on Home";case"home_open_locations":return"Opened locations from Home";case"home_leaderboard_profile":return`Viewed leaderboard profile: ${null!==(l=x.display_name)&&void 0!==l?l:"Unknown user"}`;case"explore_page_open":return"Opened Explore page";case"explore_center_user":return"Centered map to current location";case"explore_filter_category":return`Filtered category: ${null!==(a=x.category_name)&&void 0!==a?a:"Unknown category"}`;case"explore_marker_click":return`Clicked map marker: ${null!==(t=x.name)&&void 0!==t?t:"Unknown place"} (${null!==(n=x.type)&&void 0!==n?n:"Unknown"})`;case"explore_place_card_click":return`Opened place card: ${null!==(u=x.name)&&void 0!==u?u:"Unknown place"} (${null!==(r=x.type)&&void 0!==r?r:"Unknown"})`;case"explore_place_detail_open":return`Opened place details: ${null!==(i=x.name)&&void 0!==i?i:"Unknown place"}`;case"explore_place_detail_view":return`Viewed place details: ${null!==(o=x.name)&&void 0!==o?o:"Unknown place"}`;case"explore_detail_open_image":return`Viewed place image: ${null!==(d=x.name)&&void 0!==d?d:"Unknown place"}`;case"search_page_open":return"Opened Search page";case"search_product_click":return`Opened product: ${null!==(s=x.product_name)&&void 0!==s?s:"Unknown product"} (${null!==(c=x.status)&&void 0!==c?c:"Unknown"})`;case"search_sort_change":return`Sort product by ${null!==(_=x.sort)&&void 0!==_?_:"Unknown product"}`;case"search_filter_status":return`Filter product by ${null!==(v=x.status)&&void 0!==v?v:"Unknown product"}`;case"search_filter_category":return`Filter product by ${null!==(p=x.category_name)&&void 0!==p?p:"Unknown product"}`;case"product_details_open":return`Viewed product: ${null!==(f=x.product_name)&&void 0!==f?f:"Unknown product"} (${null!==(m=x.status)&&void 0!==m?m:"Unknown"})`;case"scan_ingredients_start":return`Started ingredient scan (${null!==(g=x.source)&&void 0!==g?g:"unknown source"})`;case"scan_ingredients_success":return`Scan result: ${null!==(y=x.product_name)&&void 0!==y?y:"Unknown product"} ‚Ä¢ ${x.auto_status} ‚Ä¢ ${null!==(k=x.ingredient_count)&&void 0!==k?k:0} ingredients`;case"scan_ingredients_error":return`Scan failed: ${null!==(h=x.error)&&void 0!==h?h:"Unknown error"}`;case"profile_page_open":return"Opened Profile page";case"social_link_click":return`Clicked social link (${null!==(w=x.platform)&&void 0!==w?w:"unknown"})`;default:return e.activity_type.replace(/_/g," ")}}async function fetchLogs(e=!1){e&&(ue.value=[],re.value=!1);const a=ue.value.length,{data:t,error:n}=await v.rpc("get_user_activity_logs",{p_user_id:l,p_limit:20,p_offset:a});n?console.error("‚ùå Failed to load activity logs",n):((!t||t.length<20)&&(re.value=!0),ue.value.push(...t))}async function loadMore(e){ie.value||re.value||(ie.value=!0,await fetchLogs(),ie.value=!1),e.target.complete()}return i(async()=>{o.value.length||await d(),await async function fetchUser(){const{data:e}=await v.from("user_profiles").select("*").eq("id",l).single();a.value=e}(),await async function fetchSummary(){const{data:e}=await v.rpc("get_admin_user_summary",{p_user_id:l});B.value=null==e?void 0:e.find(e=>e.user_id===l)}(),await async function fetchLastDevice(){var e;const{data:a,error:t}=await v.rpc("get_user_last_device",{p_user_id:l});t?console.error("‚ùå Failed to load device info",t):ce.value=null!==(e=null==a?void 0:a[0])&&void 0!==e?e:null}(),await async function fetchRecents(){var e,a,t;const[n,u,r]=await Promise.all([v.rpc("get_user_recent_searches",{p_user_id:l,p_limit:20}),v.rpc("get_user_recent_products",{p_user_id:l,p_limit:20}),v.rpc("get_user_recent_places",{p_user_id:l,p_limit:20})]);n.error||(oe.value=null!==(e=n.data)&&void 0!==e?e:[]),u.error||(de.value=null!==(a=u.data)&&void 0!==a?a:[]),r.error||(se.value=null!==(t=r.data)&&void 0!==t?t:[])}(),await fetchLogs(!0)}),(e,n)=>(p(),s(_(I),null,{default:c(()=>[f(_(m),null,{default:c(()=>[f(g,{title:"User Detail",icon:_(y),showBack:!0},null,8,["icon"])]),_:1}),f(_(k),{class:"ion-padding"},{default:c(()=>[a.value?(p(),s(_(w),{key:0},{default:c(()=>[f(_(x),{lines:"none"},{default:c(()=>[f(_(b),{slot:"start"},{default:c(()=>[a.value.avatar_url?(p(),$("img",{key:0,src:a.value.avatar_url},null,8,M)):(p(),$("div",R,"üë§"))]),_:1}),f(_(U),null,{default:c(()=>[S("h2",null,N(a.value.display_name||"Unknown User"),1),S("p",null,N(a.value.email),1)]),_:1})]),_:1})]),_:1})):h("",!0),B.value?(p(),s(_(w),{key:1},{default:c(()=>[f(_(D),{class:"stats-card"},{default:c(()=>[S("div",E,[S("div",T,[S("strong",null,N(B.value.total_activities),1),n[0]||(n[0]=S("span",null,"Activities",-1))]),S("div",q,[S("strong",null,N(fromNow(B.value.last_active)),1),n[1]||(n[1]=S("span",null,"Last Active",-1))])]),S("div",G,[S("div",J,[S("strong",null,N(B.value.points),1),n[2]||(n[2]=S("span",null,"Points",-1))]),S("div",Y,[S("strong",null,N(B.value.donor_type),1),n[3]||(n[3]=S("span",null,"Account Type",-1))])])]),_:1})]),_:1})):h("",!0),a.value?(p(),s(_(w),{key:2},{default:c(()=>[f(_(O),null,{default:c(()=>[f(_(A),null,{default:c(()=>n[4]||(n[4]=[L("Profile Details",-1)])),_:1,__:[4]})]),_:1}),f(_(P),{lines:"none"},{default:c(()=>[f(_(x),null,{default:c(()=>[f(_(U),null,{default:c(()=>n[5]||(n[5]=[L("Date of Birth",-1)])),_:1,__:[5]}),f(_(C),{slot:"end"},{default:c(()=>[L(N(a.value.date_of_birth||"‚Äî"),1)]),_:1})]),_:1}),f(_(x),null,{default:c(()=>[f(_(U),null,{default:c(()=>n[6]||(n[6]=[L("Nationality",-1)])),_:1,__:[6]}),getNationality(a.value.nationality)?(p(),s(_(C),{key:0,slot:"end"},{default:c(()=>{var e,l;return[S("img",{src:null===(e=getNationality(a.value.nationality))||void 0===e?void 0:e.flag,alt:"flag",style:{width:"20px",height:"14px","margin-right":"6px","vertical-align":"middle"}},null,8,K),L(" "+N(null===(l=getNationality(a.value.nationality))||void 0===l?void 0:l.name),1)]}),_:1})):(p(),s(_(C),{key:1,slot:"end"},{default:c(()=>n[7]||(n[7]=[L("‚Äî",-1)])),_:1,__:[7]}))]),_:1}),f(_(x),null,{default:c(()=>[f(_(U),null,{default:c(()=>n[8]||(n[8]=[L("Gender",-1)])),_:1,__:[8]}),f(_(C),{slot:"end"},{default:c(()=>[L(N(a.value.gender||"‚Äî"),1)]),_:1})]),_:1}),f(_(x),null,{default:c(()=>[f(_(U),null,{default:c(()=>n[9]||(n[9]=[L("Bio",-1)])),_:1,__:[9]}),f(_(C),{slot:"end",class:"bio-text"},{default:c(()=>[L(N(a.value.bio||"No bio provided"),1)]),_:1})]),_:1}),f(_(x),null,{default:c(()=>[f(_(U),null,{default:c(()=>n[10]||(n[10]=[L("Public Leaderboard",-1)])),_:1,__:[10]}),f(_(C),{slot:"end"},{default:c(()=>[L(N(a.value.public_leaderboard?"Yes":"No"),1)]),_:1})]),_:1}),f(_(x),null,{default:c(()=>[f(_(U),null,{default:c(()=>n[11]||(n[11]=[L("Profile Completed",-1)])),_:1,__:[11]}),f(_(C),{slot:"end"},{default:c(()=>[L(N(a.value.profile_completed_notified?"Yes":"No"),1)]),_:1})]),_:1})]),_:1})]),_:1})):h("",!0),f(_(w),null,{default:c(()=>[f(_(O),null,{default:c(()=>[f(_(A),null,{default:c(()=>n[12]||(n[12]=[L("Technical Details",-1)])),_:1,__:[12]})]),_:1}),f(_(P),{lines:"none"},{default:c(()=>{var e,u,r,i,o,d,v;return[f(_(x),null,{default:c(()=>[f(_(U),null,{default:c(()=>n[13]||(n[13]=[L("User ID",-1)])),_:1,__:[13]}),f(_(C),{slot:"end",class:"mono"},{default:c(()=>[L(N(_(l)),1)]),_:1})]),_:1}),null!==(e=a.value)&&void 0!==e&&e.created_at?(p(),s(_(x),{key:0},{default:c(()=>[f(_(U),null,{default:c(()=>n[14]||(n[14]=[L("Account Created",-1)])),_:1,__:[14]}),f(_(C),{slot:"end"},{default:c(()=>[L(N(new Date(a.value.created_at).toLocaleDateString()),1)]),_:1})]),_:1})):h("",!0),null!==(u=a.value)&&void 0!==u&&u.created_at?(p(),s(_(x),{key:1},{default:c(()=>[f(_(U),null,{default:c(()=>n[15]||(n[15]=[L("Member Since",-1)])),_:1,__:[15]}),f(_(C),{slot:"end"},{default:c(()=>{return[L(N((e=a.value.created_at,t(e).fromNow(!0)+" ago")),1)];var e}),_:1})]),_:1})):h("",!0),null!==(r=a.value)&&void 0!==r&&r.last_sign_in_at?(p(),s(_(x),{key:2},{default:c(()=>[f(_(U),null,{default:c(()=>n[16]||(n[16]=[L("Last Sign In (Auth)",-1)])),_:1,__:[16]}),f(_(C),{slot:"end"},{default:c(()=>[L(N(fromNow(a.value.last_sign_in_at)),1)]),_:1})]),_:1})):h("",!0),null!==(i=ce.value)&&void 0!==i&&i.last_scan_at?(p(),s(_(x),{key:3},{default:c(()=>[f(_(U),null,{default:c(()=>n[17]||(n[17]=[L("Last Scan Activity",-1)])),_:1,__:[17]}),f(_(C),{slot:"end"},{default:c(()=>[L(N(fromNow(ce.value.last_scan_at)),1)]),_:1})]),_:1})):h("",!0),null!==(o=ce.value)&&void 0!==o&&o.platform?(p(),s(_(x),{key:4},{default:c(()=>[f(_(U),null,{default:c(()=>n[18]||(n[18]=[L("Platform",-1)])),_:1,__:[18]}),f(_(C),{slot:"end"},{default:c(()=>[L(N(ce.value.platform),1)]),_:1})]),_:1})):h("",!0),null!==(d=ce.value)&&void 0!==d&&d.device_model?(p(),s(_(x),{key:5},{default:c(()=>[f(_(U),null,{default:c(()=>n[19]||(n[19]=[L("Device",-1)])),_:1,__:[19]}),f(_(C),{slot:"end"},{default:c(()=>[L(N(ce.value.device_model),1)]),_:1})]),_:1})):h("",!0),null!==(v=ce.value)&&void 0!==v&&v.app_version?(p(),s(_(x),{key:6},{default:c(()=>[f(_(U),null,{default:c(()=>n[20]||(n[20]=[L("App Version",-1)])),_:1,__:[20]}),f(_(C),{slot:"end"},{default:c(()=>[L(N(ce.value.app_version),1)]),_:1})]),_:1})):h("",!0)]}),_:1})]),_:1}),oe.value.length?(p(),s(_(w),{key:3},{default:c(()=>[f(_(O),null,{default:c(()=>[f(_(A),null,{default:c(()=>n[21]||(n[21]=[L("Recent Searches",-1)])),_:1,__:[21]})]),_:1}),f(_(P),{lines:"none"},{default:c(()=>[(p(!0),$(V,null,j(oe.value,(e,l)=>(p(),s(_(x),{key:l},{default:c(()=>[f(_(U),null,{default:c(()=>[S("strong",null,N(e.search_text),1),S("p",Z,N(fromNow(e.searched_at)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):h("",!0),de.value.length?(p(),s(_(w),{key:4},{default:c(()=>[f(_(O),null,{default:c(()=>[f(_(A),null,{default:c(()=>n[22]||(n[22]=[L("Recent Products",-1)])),_:1,__:[22]})]),_:1}),f(_(P),{lines:"none"},{default:c(()=>[(p(!0),$(V,null,j(de.value,(e,l)=>(p(),s(_(x),{key:l},{default:c(()=>[e.product_image?(p(),s(_(z),{key:0,slot:"start"},{default:c(()=>[S("img",{src:e.product_image},null,8,Q)]),_:2},1024)):h("",!0),f(_(U),null,{default:c(()=>{var l;return[S("strong",null,N(null!==(l=e.product_name)&&void 0!==l?l:`Barcode: ${e.product_id}`),1),S("p",W,N(fromNow(e.viewed_at)),1)]}),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):h("",!0),se.value.length?(p(),s(_(w),{key:5},{default:c(()=>[f(_(O),null,{default:c(()=>[f(_(A),null,{default:c(()=>n[23]||(n[23]=[L("Recent Places",-1)])),_:1,__:[23]})]),_:1}),f(_(P),{lines:"none"},{default:c(()=>[(p(!0),$(V,null,j(se.value,(e,l)=>(p(),s(_(x),{key:l},{default:c(()=>[e.place_image?(p(),s(_(z),{key:0,slot:"start"},{default:c(()=>[S("img",{src:e.place_image},null,8,X)]),_:2},1024)):h("",!0),f(_(U),null,{default:c(()=>{var l;return[S("strong",null,N(null!==(l=e.place_name)&&void 0!==l?l:`Place #${e.place_id}`),1),S("p",ee,N(fromNow(e.interacted_at)),1)]}),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1})):h("",!0),f(_(w),null,{default:c(()=>[f(_(O),null,{default:c(()=>[f(_(A),null,{default:c(()=>n[24]||(n[24]=[L("Activity Timeline",-1)])),_:1,__:[24]})]),_:1}),f(_(P),null,{default:c(()=>[(p(!0),$(V,null,j(ue.value,e=>(p(),s(_(x),{key:e.id,lines:"full"},{default:c(()=>[f(_(U),null,{default:c(()=>[S("h3",le,N(describeActivity(e)),1),S("p",ae,[L(N(e.activity_group||"general")+" ",1),e.entity_type?(p(),$("span",te," ‚Ä¢ "+N(e.entity_type)+" "+N(e.entity_id),1)):h("",!0)]),S("p",ne,N(fromNow(e.created_at)),1)]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),f(_(F),{threshold:"100px",onIonInfinite:loadMore,disabled:re.value},{default:c(()=>[f(_(H),{"loading-spinner":"bubbles","loading-text":"Loading activity..."})]),_:1},8,["disabled"])]),_:1})]),_:1}))}}),[["__scopeId","data-v-42d35373"]]))}}});
