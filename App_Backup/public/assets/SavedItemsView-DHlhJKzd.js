import{d as e,r as a,a6 as t,o,s as l,c as s,w as i,u as r,B as n,b as d,e as c,O as u,ad as m,aP as p,S as f,j as v,k as g,ba as y,H as h,bb as _,D as b,i as w,t as x,U as k,p as C,F,l as I,bc as z,bd as P,q as j,aM as N,J as S,ai as U,aj as R,n as A,be as H,aS as q,bf as M,bg as T,ah as O,L as D,bh as E,bi as Y,bj as V,y as B,a9 as J,aW as K,aX as L,aa as W,a8 as X,bk as G,aV as Q,bl as Z,_ as $}from"./index-D9IhqqAc.js";import"./html5-qrcode-D_4nuB1t.js";const ee={key:0,class:"ion-text-center ion-margin-top"},ae={class:"ion-padding",style:{"padding-bottom":"12px"}},te={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"8px"}},oe={style:{"font-size":"14px","font-weight":"bold",color:"var(--ion-color-carrot)"}},le={key:0,style:{"font-size":"12px",color:"var(--ion-color-danger)","margin-top":"12px","margin-bottom":"0"}},se={key:1,style:{"font-size":"12px",color:"var(--ion-color-medium)","margin-top":"12px","margin-bottom":"0"}},ie={key:1,class:"ion-text-center ion-margin-top",style:{display:"flex","flex-direction":"column","align-items":"center","justify-content":"center",height:"50vh"}},re={key:2},ne={key:0},de={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"16px"}},ce={style:{background:"var(--ion-color-light)","border-radius":"8px",display:"flex",padding:"2px"}},ue={key:0,class:"folder-grid"},me=["onClick"],pe={class:"folder-icon-wrapper"},fe={class:"folder-info"},ve={class:"folder-name"},ge={class:"folder-count"},ye={style:{"font-size":"13px",color:"var(--ion-color-medium)"}},he={key:1},_e={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"16px"}},be={style:{"font-weight":"600"}},we={style:{background:"var(--ion-color-light)","border-radius":"8px",display:"flex",padding:"2px"}},xe={key:0,class:"ion-text-center ion-margin-top"},ke={key:1,class:"folder-grid"},Ce=["onClick"],Fe={class:"item-img-wrapper"},Ie=["src"],ze={class:"item-info"},Pe={class:"folder-name"},je=["src"],Ne={style:{"font-weight":"600"}},Se=$(e({__name:"SavedItemsView",setup(e){const $=n(),Se=a(!0),Ue=a([]),Re=a("grid"),Ae=a(null),He=t(()=>Ue.value.reduce((e,a)=>{var t;return e+((null==(t=a.saved_items)?void 0:t.length)||0)},0)),qe=t(()=>Ae.value&&Ue.value.find(e=>e.id===Ae.value)||null);function openFolder(e){Ae.value=e.id}function closeFolder(){Ae.value=null}async function presentRcPaywall(){if(!J.isNativePlatform())return console.warn("[RC] Paywall can only run on native apps."),!1;try{const{result:e}=await K.presentPaywall();if(e===L.PURCHASED||e===L.RESTORED)return await W({syncToServer:!0}),X.log("pro_purchase_success",{source:"saved_items_view"}),!0}catch(e){console.error("Paywall failed:",e)}return!1}async function loadFoldersAndItems(){Se.value=!0;const{data:{user:e}}=await l.auth.getUser();if(!e)return void(Se.value=!1);const{data:a}=await l.from("saved_item_folders").select("id, name").eq("user_id",e.id).order("created_at",{ascending:!1});if(!a||0===a.length)return Ue.value=[],void(Se.value=!1);const{data:t}=await l.from("saved_items").select("\n      id,\n      folder_id,\n      products ( id, barcode, name, status, photo_front_url )\n    ").eq("user_id",e.id),o=a.map(e=>({...e,saved_items:t?t.filter(a=>a.folder_id===e.id):[]}));Ue.value=o,Se.value=!1}async function promptCreateFolder(){const e=await G.create({header:"New Folder",inputs:[{name:"folderName",type:"text",placeholder:"Folder Name"}],buttons:[{text:"Cancel",role:"cancel"},{text:"Create",handler:async e=>{e.folderName&&""!==e.folderName.trim()&&await async function createFolder(e){const{data:{user:a}}=await l.auth.getUser();if(!a)return;const{error:t}=await l.from("saved_item_folders").insert({user_id:a.id,name:e});t||await loadFoldersAndItems()}(e.folderName.trim())}}]});await e.present()}function goToItem(e){$.push("/item/".concat(e))}async function removeItem(e){const a=await G.create({header:"Remove Item",message:"Are you sure you want to remove this item from your folder?",buttons:[{text:"Cancel",role:"cancel"},{text:"Remove",role:"destructive",handler:async()=>{await l.from("saved_items").delete().eq("id",e),await loadFoldersAndItems()}}]});await a.present()}async function moveItem(e,a,t){const{data:{user:o}}=await l.auth.getUser();if(!o)return;const s=Ue.value.filter(e=>e.id!==a);if(0===s.length){const e=await G.create({header:"No Other Folders",message:"You have no other folders to move this item to. Create a new folder first!",buttons:["OK"]});return void(await e.present())}const i=s.map(a=>({text:a.name,icon:M,handler:async()=>{const{error:s}=await l.from("saved_items").insert({user_id:o.id,folder_id:a.id,product_id:t});if(s&&"23505"===s.code){const e=await Q.create({message:"Item already exists in that folder!",duration:2e3,color:"warning",position:"bottom"});await e.present()}else if(s){const e=await Q.create({message:"Failed to move item.",duration:2e3,color:"danger",position:"bottom"});await e.present()}else{await l.from("saved_items").delete().eq("id",e),await loadFoldersAndItems(),Ae.value=a.id;const t=await Q.create({message:"Moved to ".concat(a.name),duration:2e3,color:"success",position:"bottom"});await t.present()}}}));i.push({text:"Cancel",icon:"close",role:"cancel",handler:()=>{}});const r=await Z.create({header:"Move to folder...",buttons:i});await r.present()}return o(async()=>{await loadFoldersAndItems()}),(e,a)=>(d(),s(r(B),null,{default:i(()=>[c(r(u),null,{default:i(()=>[c(m,{title:"Saved Items","show-back":"","back-route":"/profile",icon:r(p)},null,8,["icon"])]),_:1}),c(r(f),{class:"ion-padding"},{default:i(()=>[Se.value?(d(),v("div",ee,[c(r(y))])):(d(),v(h,{key:1},[r(_)?g("",!0):(d(),s(r(b),{key:0,class:"ion-margin-bottom",style:{"margin-left":"0","margin-right":"0","box-shadow":"none",border:"1px solid var(--ion-color-light)","border-radius":"12px","margin-top":"0"}},{default:i(()=>[w("div",ae,[w("div",te,[a[4]||(a[4]=w("span",{style:{"font-size":"14px","font-weight":"600",color:"var(--ion-color-medium)"}},"Free Tier Usage",-1)),w("span",oe,x(He.value)+" / 10 ",1)]),c(r(k),{value:He.value/10,color:"carrot",style:{"border-radius":"4px",height:"8px"}},null,8,["value"]),He.value>=10?(d(),v("p",le," You've reached your free limit. Upgrade to Pro to save unlimited items! ")):(d(),v("p",se,a[5]||(a[5]=[C(" Upgrade to ",-1),w("span",{style:{"font-weight":"600",color:"var(--ion-color-dark)"}},"Halal Formosa Pro",-1),C(" for unlimited saves. ",-1)]))),c(r(F),{expand:"block",color:"carrot",size:"small",style:{"margin-top":"12px","margin-bottom":"0"},onClick:presentRcPaywall},{default:i(()=>a[6]||(a[6]=[C(" Upgrade to Pro ",-1)])),_:1,__:[6]})])]),_:1})),0===Ue.value.length?(d(),v("div",ie,[c(r(I),{icon:r(z),style:{"font-size":"64px",color:"var(--ion-color-medium)","margin-bottom":"16px"}},null,8,["icon"]),a[8]||(a[8]=w("h3",{style:{"margin-top":"0","font-weight":"600"}},"No Collections Yet",-1)),a[9]||(a[9]=w("p",{style:{color:"var(--ion-color-medium)","max-width":"80%"}},"Create a folder to start organizing your saved items!",-1)),c(r(F),{color:"carrot",style:{"margin-top":"16px"},onClick:promptCreateFolder},{default:i(()=>[c(r(I),{icon:r(P),slot:"start"},null,8,["icon"]),a[7]||(a[7]=C(" Create Folder ",-1))]),_:1,__:[7]})])):(d(),v("div",re,[qe.value?(d(),v("div",he,[w("div",_e,[c(r(F),{fill:"clear",onClick:closeFolder,style:{margin:"0","margin-left":"-10px"}},{default:i(()=>[c(r(I),{icon:r(H),slot:"start"},null,8,["icon"]),w("span",be,x(qe.value.name),1)]),_:1}),w("div",we,[c(r(F),{fill:"clear",size:"small",color:"grid"===Re.value?"carrot":"medium",onClick:a[2]||(a[2]=e=>Re.value="grid"),style:{margin:"0","--padding-start":"8px","--padding-end":"8px"}},{default:i(()=>[c(r(I),{icon:r(j)},null,8,["icon"])]),_:1},8,["color"]),c(r(F),{fill:"clear",size:"small",color:"list"===Re.value?"carrot":"medium",onClick:a[3]||(a[3]=e=>Re.value="list"),style:{margin:"0","--padding-start":"8px","--padding-end":"8px"}},{default:i(()=>[c(r(I),{icon:r(N)},null,8,["icon"])]),_:1},8,["color"])])]),0===qe.value.saved_items.length?(d(),v("p",xe,a[11]||(a[11]=[w("small",null,"No items saved here.",-1)]))):"grid"===Re.value?(d(),v("div",ke,[(d(!0),v(h,null,S(qe.value.saved_items,e=>(d(),v("div",{key:e.id,class:"item-card",onClick:a=>goToItem(e.products.barcode)},[c(r(F),{fill:"clear",color:"primary",class:"item-move-btn",onClick:q(a=>moveItem(e.id,qe.value.id,e.products.id),["stop"])},{default:i(()=>[c(r(I),{icon:r(M)},null,8,["icon"])]),_:2},1032,["onClick"]),c(r(F),{fill:"clear",color:"danger",class:"item-delete-btn",onClick:q(a=>removeItem(e.id),["stop"])},{default:i(()=>[c(r(I),{icon:r(T)},null,8,["icon"])]),_:2},1032,["onClick"]),w("div",Fe,[w("img",{src:e.products.photo_front_url||"https://via.placeholder.com/80.webp",alt:"Product Image"},null,8,Ie)]),w("div",ze,[w("span",Pe,x(e.products.name),1),c(r(O),{size:"small",class:D(["Halal"===e.products.status?"chip-success":"Muslim-friendly"===e.products.status?"chip-primary":"Syubhah"===e.products.status?"chip-warning":"Haram"===e.products.status?"chip-danger":"chip-medium"]),style:{"margin-left":"0","margin-top":"4px","font-size":"11px"}},{default:i(()=>[C(x(e.products.status),1)]),_:2},1032,["class"])])],8,Ce))),128))])):(d(),s(r(U),{key:2,style:{background:"transparent"}},{default:i(()=>[(d(!0),v(h,null,S(qe.value.saved_items,e=>(d(),s(r(R),{key:e.id,button:"",onClick:a=>goToItem(e.products.barcode),style:{"margin-bottom":"8px","--border-radius":"8px","--background":"var(--ion-color-light)"},lines:"none"},{default:i(()=>[c(r(E),{slot:"start",style:{"border-radius":"8px",overflow:"hidden"}},{default:i(()=>[w("img",{src:e.products.photo_front_url||"https://via.placeholder.com/80.webp",alt:"Product Image",style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,je)]),_:2},1024),c(r(A),null,{default:i(()=>[w("h3",Ne,x(e.products.name),1),c(r(O),{size:"small",class:D(["Halal"===e.products.status?"chip-success":"Muslim-friendly"===e.products.status?"chip-primary":"Syubhah"===e.products.status?"chip-warning":"Haram"===e.products.status?"chip-danger":"chip-medium"]),style:{"margin-left":"0","margin-top":"4px"}},{default:i(()=>[C(x(e.products.status),1)]),_:2},1032,["class"])]),_:2},1024),c(r(F),{fill:"clear",color:"primary",slot:"end",onClick:q(a=>moveItem(e.id,qe.value.id,e.products.id),["stop"])},{default:i(()=>[c(r(I),{icon:r(M)},null,8,["icon"])]),_:2},1032,["onClick"]),c(r(F),{fill:"clear",color:"danger",slot:"end",onClick:q(a=>removeItem(e.id),["stop"])},{default:i(()=>[c(r(I),{icon:r(T)},null,8,["icon"])]),_:2},1032,["onClick"])]),_:2},1032,["onClick"]))),128))]),_:1}))])):(d(),v("div",ne,[w("div",de,[a[10]||(a[10]=w("h2",{style:{margin:"0","font-size":"1.2rem","font-weight":"600"}},"My Collections",-1)),w("div",ce,[c(r(F),{fill:"clear",size:"small",color:"grid"===Re.value?"carrot":"medium",onClick:a[0]||(a[0]=e=>Re.value="grid"),style:{margin:"0","--padding-start":"8px","--padding-end":"8px"}},{default:i(()=>[c(r(I),{icon:r(j)},null,8,["icon"])]),_:1},8,["color"]),c(r(F),{fill:"clear",size:"small",color:"list"===Re.value?"carrot":"medium",onClick:a[1]||(a[1]=e=>Re.value="list"),style:{margin:"0","--padding-start":"8px","--padding-end":"8px"}},{default:i(()=>[c(r(I),{icon:r(N)},null,8,["icon"])]),_:1},8,["color"])])]),"grid"===Re.value?(d(),v("div",ue,[(d(!0),v(h,null,S(Ue.value,e=>(d(),v("div",{key:e.id,class:"folder-card",onClick:a=>openFolder(e)},[w("div",pe,[c(r(I),{icon:r(z),class:"folder-icon"},null,8,["icon"])]),w("div",fe,[w("span",ve,x(e.name),1),w("span",ge,x(e.saved_items.length)+" items",1)])],8,me))),128))])):(d(),s(r(U),{key:1,style:{background:"transparent"}},{default:i(()=>[(d(!0),v(h,null,S(Ue.value,e=>(d(),s(r(R),{key:e.id,button:"",onClick:a=>openFolder(e),style:{"margin-bottom":"8px","--border-radius":"8px","--background":"var(--ion-color-light)"},lines:"none"},{default:i(()=>[c(r(I),{icon:r(z),slot:"start",color:"carrot"},null,8,["icon"]),c(r(A),null,{default:i(()=>[w("h3",null,x(e.name),1),w("p",ye,x(e.saved_items.length)+" items",1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1}))]))]))],64)),Ue.value.length>0&&!qe.value?(d(),s(r(Y),{key:2,vertical:"bottom",horizontal:"end",slot:"fixed"},{default:i(()=>[c(r(V),{color:"carrot",onClick:promptCreateFolder},{default:i(()=>[c(r(I),{icon:r(P)},null,8,["icon"])]),_:1})]),_:1})):g("",!0)]),_:1})]),_:1}))}}),[["__scopeId","data-v-7501451f"]]);export{Se as default};
