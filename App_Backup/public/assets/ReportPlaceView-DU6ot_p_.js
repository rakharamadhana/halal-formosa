import{d as a,r as e,bm as l,o as t,s as u,c as s,w as n,u as o,B as i,bG as r,b as d,e as c,O as v,P as m,Q as p,p as _,S as f,k as b,D as g,G as y,E as k,t as w,N as h,aj as R,n as x,b5 as C,F as D,bC as S,y as V}from"./index-D9IhqqAc.js";import"./html5-qrcode-D_4nuB1t.js";const j=a({__name:"ReportPlaceView",setup(a){const j=l(),L=i(),P=e(!1),T=e(""),q=e("success"),E=Number(j.params.id),F=e(null),G=e(""),N=e(null),O=e(!1);async function submitReport(){var a,e;if(!F.value||!G.value.trim())return;O.value=!0;const{error:l}=await u.from("location_reports").insert([{location_id:F.value.id,description:G.value.trim(),created_at:(new Date).toISOString(),reported_by:null!=(e=null==(a=N.value)?void 0:a.id)?e:null}]);O.value=!1,l?(T.value="Failed to submit report.",q.value="danger"):(T.value="✅ Report submitted successfully!",q.value="success",setTimeout(()=>L.back(),1e3)),P.value=!0}return t(async()=>{const{data:{user:a}}=await u.auth.getUser();N.value=a,E&&async function fetchPlace(){const{data:a,error:e}=await u.from("locations").select("id, name, image, lat, lng, location_types(name)").eq("id",E).single();e?(T.value="❌ Location not found.",q.value="danger",P.value=!0,setTimeout(()=>L.back(),1500)):F.value=a}()}),(a,e)=>{const l=r("ion-input");return d(),s(o(V),null,{default:n(()=>[c(o(v),null,{default:n(()=>[c(o(m),null,{default:n(()=>[c(o(p),null,{default:n(()=>e[3]||(e[3]=[_("Report Location",-1)])),_:1,__:[3]})]),_:1})]),_:1}),c(o(f),{class:"ion-padding"},{default:n(()=>[F.value?(d(),s(o(g),{key:0},{default:n(()=>[c(o(y),null,{default:n(()=>[c(o(k),null,{default:n(()=>[_(w(F.value.name),1)]),_:1})]),_:1}),c(o(h),null,{default:n(()=>[c(o(R),null,{default:n(()=>{var a;return[c(o(x),{position:"stacked"},{default:n(()=>e[4]||(e[4]=[_("Type",-1)])),_:1,__:[4]}),c(l,{value:(null==(a=F.value.location_types)?void 0:a.name)||"Halal Location",readonly:""},null,8,["value"])]}),_:1}),c(o(R),null,{default:n(()=>[c(o(C),{label:"Reason","label-placement":"floating",modelValue:G.value,"onUpdate:modelValue":e[0]||(e[0]=a=>G.value=a),"auto-grow":"",placeholder:"Explain what’s wrong with this location"},null,8,["modelValue"])]),_:1}),c(o(D),{expand:"block",color:"danger",onClick:submitReport,disabled:!G.value.trim()||O.value},{default:n(()=>e[5]||(e[5]=[_(" Submit Report ",-1)])),_:1,__:[5]},8,["disabled"]),c(o(D),{expand:"block",fill:"clear",onClick:e[1]||(e[1]=a=>o(L).back())},{default:n(()=>e[6]||(e[6]=[_(" Cancel ",-1)])),_:1,__:[6]})]),_:1})]),_:1})):b("",!0),c(o(S),{"is-open":P.value,message:T.value,color:q.value,duration:"2000",onDidDismiss:e[2]||(e[2]=a=>P.value=!1),style:{transform:"translateY(-55px)"}},null,8,["is-open","message","color"])]),_:1})]),_:1})}}});export{j as default};
