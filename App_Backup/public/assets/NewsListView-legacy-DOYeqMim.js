System.register(["./index-legacy-DryGZUwD.js","./html5-qrcode-legacy-D5DtuMLO.js"],function(e,t){"use strict";var a,l,n,i,o,d,s,c,r,u,h,p,m,f,w,g,x,v,y,b,_,N,k,C,I,j,S,T,B,z,L,$,V,A,M,E,R,q,D,G,H,J,O,P,U,W;return{setters:[e=>{a=e.d,l=e.r,n=e.a2,i=e.a3,o=e.a4,d=e.a5,s=e.o,c=e.s,r=e.a6,u=e.c,h=e.w,p=e.u,m=e.B,f=e.b,w=e.e,g=e.O,x=e.ad,v=e.P,y=e.i,b=e.an,_=e.S,N=e.j,k=e.k,C=e.ae,I=e.af,j=e.cd,S=e.H,T=e.J,B=e.D,z=e.W,L=e.G,$=e.N,V=e.E,A=e.p,M=e.t,E=e.ce,R=e.cf,q=e.cg,D=e.aB,G=e.ch,H=e.bi,J=e.bj,O=e.l,P=e.bd,U=e.y,W=e._},null],execute:function(){var t=document.createElement("style");t.textContent=".news-card ion-card[data-v-ecc78a6a]{margin:6px 0;padding:8px;box-shadow:0 2px 6px rgba(0,0,0,.2)}.news-thumbnail[data-v-ecc78a6a]{width:100%;height:140px;object-fit:cover;border-radius:6px}ion-card-title[data-v-ecc78a6a]{font-size:16px;font-weight:600}ion-card-subtitle[data-v-ecc78a6a]{font-size:12px;color:var(--ion-color-medium)}.news-summary[data-v-ecc78a6a]{font-size:13px;line-height:1.3;color:var(--ion-background-color-step-800)}ion-searchbar.rounded[data-v-ecc78a6a]{--border-radius: 8px;--box-shadow: 0 1px 3px rgba(41, 40, 40, .1)}\n",document.head.appendChild(t);const F={style:{display:"flex","align-items":"center",width:"100%",gap:"8px"}},K=["onClick"],Q=["src"],X={class:"news-summary"};e("default",W(a({__name:"NewsListView",setup(e){const t=m(),a=l(!0),W=l([]),Y=l([]),Z=l(""),ee=l(!1);let te=0;async function loadInitialNews(){a.value=!0,te=0,W.value=[],Y.value=[],ee.value=!1,await fetchNewsBatch(),a.value=!1}async function fetchNewsBatch(){const{data:e,error:t}=await c.from("news").select("id, title, header_image, content, created_at").order("created_at",{ascending:!1}).range(te,te+5-1);if(!t&&e){const t=e.map(e=>({id:e.id,title:truncateText(e.title,12),summary:generateSummary(e.content,e.title,20),thumbnail:e.header_image||"https://placehold.co/600x400",created_at:e.created_at}));W.value.push(...t),Y.value=W.value,te+=5,t.length<5&&(ee.value=!0)}}async function loadMore(e){await fetchNewsBatch(),e.target.complete()}async function refreshNews(e){await loadInitialNews(),e.detail.complete()}function truncateText(e,t=10){const a=e.trim().split(/\s+/);return a.slice(0,t).join(" ")+(a.length>t?"…":"")}function generateSummary(e,t,a=20){const l=e.replace(/<[^>]+>/g,"").trim().split(/\r?\n/).map(e=>e.trim()).filter(Boolean).filter(e=>!e.includes(t)).join(" ").split(/\s+/);return l.slice(0,a).join(" ")+(l.length>a?"…":"")}function handleSearch(){}n.extend(i),n.extend(o),n.extend(d),s(async()=>{await loadInitialNews()});const ae=r(()=>Z.value?Y.value.filter(e=>e.title.toLowerCase().includes(Z.value.toLowerCase())||e.summary.toLowerCase().includes(Z.value.toLowerCase())):Y.value);function goToAddNews(){t.push("/news/add")}return(e,l)=>(f(),u(p(U),null,{default:h(()=>[w(p(g),null,{default:h(()=>[w(x,{title:e.$t("news.title"),"show-back":"",icon:"none","back-route":"/home"},null,8,["title"]),w(p(v),{style:{padding:"8px"}},{default:h(()=>[y("div",F,[w(p(b),{placeholder:e.$t("news.placeholder"),debounce:800,modelValue:Z.value,"onUpdate:modelValue":l[0]||(l[0]=e=>Z.value=e),onIonInput:handleSearch,class:"rounded",style:{flex:"1"}},null,8,["placeholder","modelValue"])])]),_:1})]),_:1}),w(p(_),{class:"ion-padding"},{default:h(()=>[w(p(C),{style:{"margin-top":"15px"},slot:"fixed",onIonRefresh:refreshNews},{default:h(()=>[w(p(I),{"pulling-icon":p(j),pullingText:e.$t("search.pullToRefresh"),refreshingSpinner:"circles"},null,8,["pulling-icon","pullingText"])]),_:1}),a.value?(f(),N(S,{key:0},T(5,e=>w(p(B),{key:"skeleton-"+e},{default:h(()=>[w(p(z),{animated:"",style:{width:"100%",height:"140px","border-radius":"8px","margin-bottom":"8px"}}),w(p(L),null,{default:h(()=>[w(p(z),{animated:"",style:{width:"70%",height:"18px","margin-bottom":"6px"}}),w(p(z),{animated:"",style:{width:"40%",height:"14px"}})]),_:1}),w(p($),null,{default:h(()=>[w(p(z),{animated:"",style:{width:"100%",height:"12px","margin-bottom":"4px"}}),w(p(z),{animated:"",style:{width:"80%",height:"12px"}})]),_:1})]),_:2},1024)),64)):(f(!0),N(S,{key:1},T(ae.value,(e,a)=>(f(),N("div",{key:a,onClick:a=>function openNews(e){t.push(`/news/${e.id}`)}(e),class:"news-card"},[w(p(B),null,{default:h(()=>[y("img",{src:e.thumbnail,alt:"news-thumbnail",class:"news-thumbnail"},null,8,Q),w(p(L),null,{default:h(()=>[w(p(V),null,{default:h(()=>[A(M(e.title),1)]),_:2},1024),w(p(E),null,{default:h(()=>{return[A(M((t=e.created_at,t?n.utc(t).tz("Asia/Taipei").fromNow():"")),1)];var t}),_:2},1024)]),_:2},1024),w(p($),null,{default:h(()=>[y("p",X,M(e.summary),1)]),_:2},1024)]),_:2},1024)],8,K))),128)),w(p(R),{ref:"infiniteScroll",onIonInfinite:loadMore,threshold:"100px"},{default:h(()=>[w(p(q),{"loading-spinner":"bubbles","loading-text":e.$t("news.loadingMoreNews")},null,8,["loading-text"])]),_:1},512),p(D)||p(G)?(f(),u(p(H),{key:2,vertical:"bottom",horizontal:"end",slot:"fixed"},{default:h(()=>[w(p(J),{color:"carrot",onClick:goToAddNews},{default:h(()=>[w(p(O),{icon:p(P)},null,8,["icon"])]),_:1})]),_:1})):k("",!0)]),_:1})]),_:1}))}}),[["__scopeId","data-v-ecc78a6a"]]))}}});
