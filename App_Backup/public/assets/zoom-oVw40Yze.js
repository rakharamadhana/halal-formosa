import{cw as e,cx as t,cy as i,cz as a,cA as o}from"./index-D9IhqqAc.js";function Zoom(n){let{swiper:r,extendParams:s,on:l,emit:c}=n;const m=e();s({zoom:{enabled:!1,limitToOriginalSize:!1,maxRatio:3,minRatio:1,panOnMouseMove:!1,toggle:!0,containerClass:"swiper-zoom-container",zoomedSlideClass:"swiper-slide-zoomed"}}),r.zoom={enabled:!1};let d=1,u=!1,p=!1,h={x:0,y:0};let g,v;const E=[],f={originX:0,originY:0,slideEl:void 0,slideWidth:void 0,slideHeight:void 0,imageEl:void 0,imageWrapEl:void 0,maxRatio:3},x={isTouched:void 0,isMoved:void 0,currentX:void 0,currentY:void 0,minX:void 0,minY:void 0,maxX:void 0,maxY:void 0,width:void 0,height:void 0,startX:void 0,startY:void 0,touchesStart:{},touchesCurrent:{}},M={x:void 0,y:void 0,prevPositionX:void 0,prevPositionY:void 0,prevTime:void 0};let y,X=1;function getDistanceBetweenTouches(){if(E.length<2)return 1;const e=E[0].pageX,t=E[0].pageY,i=E[1].pageX,a=E[1].pageY;return Math.sqrt((i-e)**2+(a-t)**2)}function getMaxRatio(){const e=r.params.zoom,t=f.imageWrapEl.getAttribute("data-swiper-zoom")||e.maxRatio;if(e.limitToOriginalSize&&f.imageEl&&f.imageEl.naturalWidth){const e=f.imageEl.naturalWidth/f.imageEl.offsetWidth;return Math.min(e,t)}return t}function eventWithinSlide(e){const t=function getSlideSelector(){return r.isElement?"swiper-slide":".".concat(r.params.slideClass)}();return!!e.target.matches(t)||r.slides.filter(t=>t.contains(e.target)).length>0}function eventWithinZoomContainer(e){const t=".".concat(r.params.zoom.containerClass);return!!e.target.matches(t)||[...r.hostEl.querySelectorAll(t)].filter(t=>t.contains(e.target)).length>0}function onGestureStart(e){if("mouse"===e.pointerType&&E.splice(0,E.length),!eventWithinSlide(e))return;const t=r.params.zoom;if(g=!1,v=!1,E.push(e),!(E.length<2)){if(g=!0,f.scaleStart=getDistanceBetweenTouches(),!f.slideEl){f.slideEl=e.target.closest(".".concat(r.params.slideClass,", swiper-slide")),f.slideEl||(f.slideEl=r.slides[r.activeIndex]);let a=f.slideEl.querySelector(".".concat(t.containerClass));if(a&&(a=a.querySelectorAll("picture, img, svg, canvas, .swiper-zoom-target")[0]),f.imageEl=a,f.imageWrapEl=a?i(f.imageEl,".".concat(t.containerClass))[0]:void 0,!f.imageWrapEl)return void(f.imageEl=void 0);f.maxRatio=getMaxRatio()}if(f.imageEl){const[e,t]=function getScaleOrigin(){if(E.length<2)return{x:null,y:null};const e=f.imageEl.getBoundingClientRect();return[(E[0].pageX+(E[1].pageX-E[0].pageX)/2-e.x-m.scrollX)/d,(E[0].pageY+(E[1].pageY-E[0].pageY)/2-e.y-m.scrollY)/d]}();f.originX=e,f.originY=t,f.imageEl.style.transitionDuration="0ms"}u=!0}}function onGestureChange(e){if(!eventWithinSlide(e))return;const t=r.params.zoom,i=r.zoom,a=E.findIndex(t=>t.pointerId===e.pointerId);a>=0&&(E[a]=e),E.length<2||(v=!0,f.scaleMove=getDistanceBetweenTouches(),f.imageEl&&(i.scale=f.scaleMove/f.scaleStart*d,i.scale>f.maxRatio&&(i.scale=f.maxRatio-1+(i.scale-f.maxRatio+1)**.5),i.scale<t.minRatio&&(i.scale=t.minRatio+1-(t.minRatio-i.scale+1)**.5),f.imageEl.style.transform="translate3d(0,0,0) scale(".concat(i.scale,")")))}function onGestureEnd(e){if(!eventWithinSlide(e))return;if("mouse"===e.pointerType&&"pointerout"===e.type)return;const t=r.params.zoom,i=r.zoom,a=E.findIndex(t=>t.pointerId===e.pointerId);a>=0&&E.splice(a,1),g&&v&&(g=!1,v=!1,f.imageEl&&(i.scale=Math.max(Math.min(i.scale,f.maxRatio),t.minRatio),f.imageEl.style.transitionDuration="".concat(r.params.speed,"ms"),f.imageEl.style.transform="translate3d(0,0,0) scale(".concat(i.scale,")"),d=i.scale,u=!1,i.scale>1&&f.slideEl?f.slideEl.classList.add("".concat(t.zoomedSlideClass)):i.scale<=1&&f.slideEl&&f.slideEl.classList.remove("".concat(t.zoomedSlideClass)),1===i.scale&&(f.originX=0,f.originY=0,f.slideEl=void 0)))}function allowTouchMove(){r.touchEventsData.preventTouchMoveFromPointerMove=!1}function onTouchMove(e){const t="mouse"===e.pointerType&&r.params.zoom.panOnMouseMove;if(!eventWithinSlide(e)||!eventWithinZoomContainer(e))return;const i=r.zoom;if(!f.imageEl)return;if(!x.isTouched||!f.slideEl)return void(t&&onMouseMove(e));if(t)return void onMouseMove(e);x.isMoved||(x.width=f.imageEl.offsetWidth||f.imageEl.clientWidth,x.height=f.imageEl.offsetHeight||f.imageEl.clientHeight,x.startX=o(f.imageWrapEl,"x")||0,x.startY=o(f.imageWrapEl,"y")||0,f.slideWidth=f.slideEl.offsetWidth,f.slideHeight=f.slideEl.offsetHeight,f.imageWrapEl.style.transitionDuration="0ms");const a=x.width*i.scale,n=x.height*i.scale;x.minX=Math.min(f.slideWidth/2-a/2,0),x.maxX=-x.minX,x.minY=Math.min(f.slideHeight/2-n/2,0),x.maxY=-x.minY,x.touchesCurrent.x=E.length>0?E[0].pageX:e.pageX,x.touchesCurrent.y=E.length>0?E[0].pageY:e.pageY;if(Math.max(Math.abs(x.touchesCurrent.x-x.touchesStart.x),Math.abs(x.touchesCurrent.y-x.touchesStart.y))>5&&(r.allowClick=!1),!x.isMoved&&!u){if(r.isHorizontal()&&(Math.floor(x.minX)===Math.floor(x.startX)&&x.touchesCurrent.x<x.touchesStart.x||Math.floor(x.maxX)===Math.floor(x.startX)&&x.touchesCurrent.x>x.touchesStart.x))return x.isTouched=!1,void allowTouchMove();if(!r.isHorizontal()&&(Math.floor(x.minY)===Math.floor(x.startY)&&x.touchesCurrent.y<x.touchesStart.y||Math.floor(x.maxY)===Math.floor(x.startY)&&x.touchesCurrent.y>x.touchesStart.y))return x.isTouched=!1,void allowTouchMove()}e.cancelable&&e.preventDefault(),e.stopPropagation(),function preventTouchMove(){clearTimeout(y),r.touchEventsData.preventTouchMoveFromPointerMove=!0,y=setTimeout(()=>{r.destroyed||allowTouchMove()})}(),x.isMoved=!0;const s=(i.scale-d)/(f.maxRatio-r.params.zoom.minRatio),{originX:l,originY:c}=f;x.currentX=x.touchesCurrent.x-x.touchesStart.x+x.startX+s*(x.width-2*l),x.currentY=x.touchesCurrent.y-x.touchesStart.y+x.startY+s*(x.height-2*c),x.currentX<x.minX&&(x.currentX=x.minX+1-(x.minX-x.currentX+1)**.8),x.currentX>x.maxX&&(x.currentX=x.maxX-1+(x.currentX-x.maxX+1)**.8),x.currentY<x.minY&&(x.currentY=x.minY+1-(x.minY-x.currentY+1)**.8),x.currentY>x.maxY&&(x.currentY=x.maxY-1+(x.currentY-x.maxY+1)**.8),M.prevPositionX||(M.prevPositionX=x.touchesCurrent.x),M.prevPositionY||(M.prevPositionY=x.touchesCurrent.y),M.prevTime||(M.prevTime=Date.now()),M.x=(x.touchesCurrent.x-M.prevPositionX)/(Date.now()-M.prevTime)/2,M.y=(x.touchesCurrent.y-M.prevPositionY)/(Date.now()-M.prevTime)/2,Math.abs(x.touchesCurrent.x-M.prevPositionX)<2&&(M.x=0),Math.abs(x.touchesCurrent.y-M.prevPositionY)<2&&(M.y=0),M.prevPositionX=x.touchesCurrent.x,M.prevPositionY=x.touchesCurrent.y,M.prevTime=Date.now(),f.imageWrapEl.style.transform="translate3d(".concat(x.currentX,"px, ").concat(x.currentY,"px,0)")}function onTransitionEnd(){const e=r.zoom;f.slideEl&&r.activeIndex!==r.slides.indexOf(f.slideEl)&&(f.imageEl&&(f.imageEl.style.transform="translate3d(0,0,0) scale(1)"),f.imageWrapEl&&(f.imageWrapEl.style.transform="translate3d(0,0,0)"),f.slideEl.classList.remove("".concat(r.params.zoom.zoomedSlideClass)),e.scale=1,d=1,f.slideEl=void 0,f.imageEl=void 0,f.imageWrapEl=void 0,f.originX=0,f.originY=0)}function onMouseMove(e){if(d<=1||!f.imageWrapEl)return;if(!eventWithinSlide(e)||!eventWithinZoomContainer(e))return;const t=m.getComputedStyle(f.imageWrapEl).transform,i=new m.DOMMatrix(t);if(!p)return p=!0,h.x=e.clientX,h.y=e.clientY,x.startX=i.e,x.startY=i.f,x.width=f.imageEl.offsetWidth||f.imageEl.clientWidth,x.height=f.imageEl.offsetHeight||f.imageEl.clientHeight,f.slideWidth=f.slideEl.offsetWidth,void(f.slideHeight=f.slideEl.offsetHeight);const a=-3*(e.clientX-h.x),o=-3*(e.clientY-h.y),n=x.width*d,r=x.height*d,s=f.slideWidth,l=f.slideHeight,c=Math.min(s/2-n/2,0),u=-c,g=Math.min(l/2-r/2,0),v=-g,E=Math.max(Math.min(x.startX+a,u),c),M=Math.max(Math.min(x.startY+o,v),g);f.imageWrapEl.style.transitionDuration="0ms",f.imageWrapEl.style.transform="translate3d(".concat(E,"px, ").concat(M,"px, 0)"),h.x=e.clientX,h.y=e.clientY,x.startX=E,x.startY=M,x.currentX=E,x.currentY=M}function zoomIn(e){const o=r.zoom,n=r.params.zoom;if(!f.slideEl){e&&e.target&&(f.slideEl=e.target.closest(".".concat(r.params.slideClass,", swiper-slide"))),f.slideEl||(r.params.virtual&&r.params.virtual.enabled&&r.virtual?f.slideEl=t(r.slidesEl,".".concat(r.params.slideActiveClass))[0]:f.slideEl=r.slides[r.activeIndex]);let a=f.slideEl.querySelector(".".concat(n.containerClass));a&&(a=a.querySelectorAll("picture, img, svg, canvas, .swiper-zoom-target")[0]),f.imageEl=a,f.imageWrapEl=a?i(f.imageEl,".".concat(n.containerClass))[0]:void 0}if(!f.imageEl||!f.imageWrapEl)return;let s,l,c,u,p,h,g,v,E,M,y,X,Y,z,W,C,S,w;r.params.cssMode&&(r.wrapperEl.style.overflow="hidden",r.wrapperEl.style.touchAction="none"),f.slideEl.classList.add("".concat(n.zoomedSlideClass)),void 0===x.touchesStart.x&&e?(s=e.pageX,l=e.pageY):(s=x.touchesStart.x,l=x.touchesStart.y);const T=d,b="number"==typeof e?e:null;1===d&&b&&(s=void 0,l=void 0,x.touchesStart.x=void 0,x.touchesStart.y=void 0);const L=getMaxRatio();o.scale=b||L,d=b||L,!e||1===d&&b?(g=0,v=0):(S=f.slideEl.offsetWidth,w=f.slideEl.offsetHeight,c=a(f.slideEl).left+m.scrollX,u=a(f.slideEl).top+m.scrollY,p=c+S/2-s,h=u+w/2-l,E=f.imageEl.offsetWidth||f.imageEl.clientWidth,M=f.imageEl.offsetHeight||f.imageEl.clientHeight,y=E*o.scale,X=M*o.scale,Y=Math.min(S/2-y/2,0),z=Math.min(w/2-X/2,0),W=-Y,C=-z,T>0&&b&&"number"==typeof x.currentX&&"number"==typeof x.currentY?(g=x.currentX*o.scale/T,v=x.currentY*o.scale/T):(g=p*o.scale,v=h*o.scale),g<Y&&(g=Y),g>W&&(g=W),v<z&&(v=z),v>C&&(v=C)),b&&1===o.scale&&(f.originX=0,f.originY=0),x.currentX=g,x.currentY=v,f.imageWrapEl.style.transitionDuration="300ms",f.imageWrapEl.style.transform="translate3d(".concat(g,"px, ").concat(v,"px,0)"),f.imageEl.style.transitionDuration="300ms",f.imageEl.style.transform="translate3d(0,0,0) scale(".concat(o.scale,")")}function zoomOut(){const e=r.zoom,a=r.params.zoom;if(!f.slideEl){r.params.virtual&&r.params.virtual.enabled&&r.virtual?f.slideEl=t(r.slidesEl,".".concat(r.params.slideActiveClass))[0]:f.slideEl=r.slides[r.activeIndex];let e=f.slideEl.querySelector(".".concat(a.containerClass));e&&(e=e.querySelectorAll("picture, img, svg, canvas, .swiper-zoom-target")[0]),f.imageEl=e,f.imageWrapEl=e?i(f.imageEl,".".concat(a.containerClass))[0]:void 0}f.imageEl&&f.imageWrapEl&&(r.params.cssMode&&(r.wrapperEl.style.overflow="",r.wrapperEl.style.touchAction=""),e.scale=1,d=1,x.currentX=void 0,x.currentY=void 0,x.touchesStart.x=void 0,x.touchesStart.y=void 0,f.imageWrapEl.style.transitionDuration="300ms",f.imageWrapEl.style.transform="translate3d(0,0,0)",f.imageEl.style.transitionDuration="300ms",f.imageEl.style.transform="translate3d(0,0,0) scale(1)",f.slideEl.classList.remove("".concat(a.zoomedSlideClass)),f.slideEl=void 0,f.originX=0,f.originY=0,r.params.zoom.panOnMouseMove&&(h={x:0,y:0},p&&(p=!1,x.startX=0,x.startY=0)))}function zoomToggle(e){const t=r.zoom;t.scale&&1!==t.scale?zoomOut():zoomIn(e)}function getListeners(){return{passiveListener:!!r.params.passiveListeners&&{passive:!0,capture:!1},activeListenerWithCapture:!r.params.passiveListeners||{passive:!1,capture:!0}}}function enable(){const e=r.zoom;if(e.enabled)return;e.enabled=!0;const{passiveListener:t,activeListenerWithCapture:i}=getListeners();r.wrapperEl.addEventListener("pointerdown",onGestureStart,t),r.wrapperEl.addEventListener("pointermove",onGestureChange,i),["pointerup","pointercancel","pointerout"].forEach(e=>{r.wrapperEl.addEventListener(e,onGestureEnd,t)}),r.wrapperEl.addEventListener("pointermove",onTouchMove,i)}function disable(){const e=r.zoom;if(!e.enabled)return;e.enabled=!1;const{passiveListener:t,activeListenerWithCapture:i}=getListeners();r.wrapperEl.removeEventListener("pointerdown",onGestureStart,t),r.wrapperEl.removeEventListener("pointermove",onGestureChange,i),["pointerup","pointercancel","pointerout"].forEach(e=>{r.wrapperEl.removeEventListener(e,onGestureEnd,t)}),r.wrapperEl.removeEventListener("pointermove",onTouchMove,i)}Object.defineProperty(r.zoom,"scale",{get:()=>X,set(e){if(X!==e){const t=f.imageEl,i=f.slideEl;c("zoomChange",e,t,i)}X=e}}),l("init",()=>{r.params.zoom.enabled&&enable()}),l("destroy",()=>{disable()}),l("touchStart",(e,t)=>{r.zoom.enabled&&function onTouchStart(e){const t=r.device;if(!f.imageEl)return;if(x.isTouched)return;t.android&&e.cancelable&&e.preventDefault(),x.isTouched=!0;const i=E.length>0?E[0]:e;x.touchesStart.x=i.pageX,x.touchesStart.y=i.pageY}(t)}),l("touchEnd",(e,t)=>{r.zoom.enabled&&function onTouchEnd(){const e=r.zoom;if(E.length=0,!f.imageEl)return;if(!x.isTouched||!x.isMoved)return x.isTouched=!1,void(x.isMoved=!1);x.isTouched=!1,x.isMoved=!1;let t=300,i=300;const a=M.x*t,o=x.currentX+a,n=M.y*i,s=x.currentY+n;0!==M.x&&(t=Math.abs((o-x.currentX)/M.x)),0!==M.y&&(i=Math.abs((s-x.currentY)/M.y));const l=Math.max(t,i);x.currentX=o,x.currentY=s;const c=x.width*e.scale,m=x.height*e.scale;x.minX=Math.min(f.slideWidth/2-c/2,0),x.maxX=-x.minX,x.minY=Math.min(f.slideHeight/2-m/2,0),x.maxY=-x.minY,x.currentX=Math.max(Math.min(x.currentX,x.maxX),x.minX),x.currentY=Math.max(Math.min(x.currentY,x.maxY),x.minY),f.imageWrapEl.style.transitionDuration="".concat(l,"ms"),f.imageWrapEl.style.transform="translate3d(".concat(x.currentX,"px, ").concat(x.currentY,"px,0)")}()}),l("doubleTap",(e,t)=>{!r.animating&&r.params.zoom.enabled&&r.zoom.enabled&&r.params.zoom.toggle&&zoomToggle(t)}),l("transitionEnd",()=>{r.zoom.enabled&&r.params.zoom.enabled&&onTransitionEnd()}),l("slideChange",()=>{r.zoom.enabled&&r.params.zoom.enabled&&r.params.cssMode&&onTransitionEnd()}),Object.assign(r.zoom,{enable:enable,disable:disable,in:zoomIn,out:zoomOut,toggle:zoomToggle})}export{Zoom as Z};
