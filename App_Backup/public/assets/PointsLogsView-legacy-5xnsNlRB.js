System.register(["./index-legacy-DryGZUwD.js","./html5-qrcode-legacy-D5DtuMLO.js"],function(e,t){"use strict";var a,l,r,o,n,i,s,c,u,d,g,_,f,m,p,v,y,h,w,x,k,b,j,C,z,A,E,L,B,F,P,S,U,q;return{setters:[e=>{a=e.d,l=e.r,r=e.a2,o=e.a3,n=e.a4,i=e.a5,s=e.o,c=e.c,u=e.w,d=e.u,g=e.s,_=e.b,f=e.e,m=e.O,p=e.ad,v=e.aM,y=e.S,h=e.ai,w=e.j,x=e.H,k=e.J,b=e.aj,j=e.k,C=e.ak,z=e.i,A=e.n,E=e.t,L=e.ao,B=e.ag,F=e.p,P=e.aB,S=e.F,U=e.y,q=e.am},null],execute:function(){var t=document.createElement("style");t.textContent=".log-label h2.log-user{margin:0 0 4px;font-weight:600}.log-action{display:flex;align-items:center;gap:8px;margin-bottom:4px}.log-badge{font-size:.8rem}.log-time{margin:0;font-size:.85rem;color:var(--ion-color-medium)}\n",document.head.appendChild(t);const H=["src"],J={class:"log-user"},M={class:"log-action"},N={class:"log-time"};e("default",a({__name:"PointsLogsView",setup(e){const t=l([]);r.extend(o),r.extend(n),r.extend(i);const{currentPoints:a}=q();return s(async function fetchLogs(){const{data:e,error:a}=await g.rpc("get_point_logs_with_users",{limit_count:15});a?(console.error("Error fetching point logs:",a),t.value=[]):t.value=e||[]}),(e,l)=>(_(),c(d(U),null,{default:u(()=>[f(d(m),null,{default:u(()=>[f(p,{title:e.$t("points.title"),icon:d(v),showBack:!0},null,8,["title","icon"])]),_:1}),f(d(y),{class:"ion-padding"},{default:u(()=>[f(d(h),null,{default:u(()=>[(_(!0),w(x,null,k(t.value,e=>(_(),c(d(b),{key:e.id},{default:u(()=>[e.avatar_url?(_(),c(d(C),{key:0,slot:"start"},{default:u(()=>[z("img",{src:e.avatar_url,alt:"User Avatar"},null,8,H)]),_:2},1024)):j("",!0),f(d(A),{class:"log-label"},{default:u(()=>{return[z("h2",J,E(e.full_name||e.display_name||e.email),1),z("div",M,[f(d(L),{color:"dark"},{default:u(()=>[z("strong",null,"ðŸŽ¯ "+E(e.label),1)]),_:2},1024),f(d(B),{color:"primary",class:"log-badge"},{default:u(()=>[F(" +"+E(e.points)+" pts ",1)]),_:2},1024)]),z("p",N,E((t=e.created_at,t?r.utc(t).tz("Asia/Taipei").fromNow():"")),1)];var t}),_:2},1024),d(P)?(_(),c(d(S),{key:1,color:"danger",fill:"clear",slot:"end",onClick:l=>async function retractLog(e){if(!confirm("Are you sure you want to retract this log?"))return;const{error:l,data:r}=await g.rpc("retract_point_log",{log_id:e});if(l)console.error("âŒ Error retracting log:",l),alert("Failed to retract log: "+l.message);else{t.value=t.value.filter(t=>t.id!==e);const{data:{user:l}}=await g.auth.getUser();l&&(null==r?void 0:r.user_id)===l.id&&(a.value=r.new_points)}}(e.id)},{default:u(()=>l[0]||(l[0]=[F(" Retract ",-1)])),_:2,__:[0]},1032,["onClick"])):j("",!0)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}))}}))}}});
