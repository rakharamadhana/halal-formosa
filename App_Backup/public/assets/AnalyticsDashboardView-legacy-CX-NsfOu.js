System.register(["./index-legacy-DryGZUwD.js","./index-legacy-DeRWDn8A.js","./html5-qrcode-legacy-D5DtuMLO.js"],function(e,l){"use strict";var a,t,u,n,o,s,i,r,c,d,v,_,f,y,p,h,g,m,b,k,w,A,x,M,U,C,D,S,V,R,T,q,L,H,W,j,B,E,N,z,I,O,P,F,J,G,$,K,Q,X;return{setters:[e=>{a=e.d,t=e.r,u=e.a6,n=e.o,o=e.aB,s=e.B,i=e.c,r=e.w,c=e.u,d=e.s,v=e.b,_=e.e,f=e.O,y=e.ad,p=e.aM,h=e.S,g=e.D,m=e.N,b=e.ai,k=e.aj,w=e.n,A=e.p,x=e.aq,M=e.ar,U=e.G,C=e.E,D=e.t,S=e.i,V=e.l,R=e.cB,T=e.al,q=e.j,L=e.k,H=e.H,W=e.J,j=e.ag,B=e.F,E=e.y,N=e._},e=>{z=e.C,I=e.p,O=e.a,P=e.b,F=e.B,J=e.d,G=e.P,$=e.c,K=e.L,Q=e.e,X=e.f},null],execute:function(){var l=document.createElement("style");l.textContent=".chart-container[data-v-0715dc45]{width:100%;height:500px!important;position:relative}\n",document.head.appendChild(l);const Y=["innerHTML"],Z={class:"chart-container"},ee={key:0,style:{"text-align":"center","margin-top":"10px"}},le={class:"chart-container"},ae={key:0,style:{"text-align":"center","margin-top":"10px"}},te={class:"chart-container"},ue={key:0,style:{"text-align":"center","margin-top":"10px"}},ne={class:"chart-container"},oe={key:0,style:{"text-align":"center","margin-top":"10px"}},se={key:0,style:{"text-align":"center","margin-top":"10px"}};e("default",N(a({__name:"AnalyticsDashboardView",setup(e){z.register(I,O,P,F,J,G,$,K,Q);const l=s(),a=t(0),N=t(0),ie=t([]),re=t([]),ce=t([]),de=t([]),ve=t(!1),_e=t(!1),fe=t(!1),ye=t(!1),pe=t(!1),he=t([]),ge=u(()=>{const e=ve.value?ie.value:ie.value.slice(0,5);return{labels:e.map(e=>e.activity_type),datasets:[{label:"Usage",data:e.map(e=>e.count),backgroundColor:"rgba(255,159,64,0.8)"}]}}),me=u(()=>{const e=_e.value?re.value:re.value.slice(0,5);return{labels:e.map(e=>function shortName(e,l=20){return e?e.length>l?e.slice(0,l)+"â€¦":e:"(Unnamed)"}(e.product_name)),datasets:[{label:"Views",data:e.map(e=>e.count),backgroundColor:"#2ecc71"}]}}),be=u(()=>{const e=fe.value?ce.value:ce.value.slice(0,5);return{labels:e.map(e=>e.name||e.place_name||"(Unknown)"),datasets:[{label:"Views",data:e.map(e=>Number(e.count)),backgroundColor:"#3498db"}]}}),ke=t(null),we={responsive:!0,maintainAspectRatio:!1,scales:{x:{ticks:{maxRotation:30,minRotation:0,autoSkip:!0,color:"#ccc"}},y:{ticks:{color:"#ccc"}}}},Ae={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"#ccc"}}},scales:{x:{ticks:{color:"#ccc"}},y:{ticks:{color:"#ccc"}}}},xe=u(()=>"daily"===De.value?"Today's Activity":"weekly"===De.value?"This Week's Activity":"monthly"===De.value?"This Month's Activity":"Activity"),Me=u(()=>"daily"===De.value?"Today":"weekly"===De.value?"This Week":"monthly"===De.value?"This Month":""),Ue=u(()=>"daily"===De.value?"DAU":"weekly"===De.value?"WAU":"monthly"===De.value?"MAU":"DAU"),Ce=u(()=>"daily"===De.value?"<b>DAU</b> = Daily Active Users<br>Unique users who opened the app today.":"weekly"===De.value?"<b>WAU</b> = Weekly Active Users<br>Unique users who opened the app this week.":"monthly"===De.value?"<b>MAU</b> = Monthly Active Users<br>Unique users who opened the app this month.":""),De=t("daily");async function fetchAnalytics(){const e=function resolveDateRange(){const e=(new Date).toISOString(),start=new Date;if("daily"===De.value)start.setHours(0,0,0,0);else if("weekly"===De.value){const e=start.getDay(),l=0===e?6:e-1;start.setDate(start.getDate()-l),start.setHours(0,0,0,0)}else"monthly"===De.value&&(start.setDate(1),start.setHours(0,0,0,0));return{start:start.toISOString(),end:e}}();if(!e)return;const{start:start,end:l}=e,{data:t,error:u}=await d.rpc("analytics_full_range",{start_ts:start,end_ts:l});if(u)return void console.error("Analytics RPC Error:",u);a.value=t.summary.unique_users,N.value=t.summary.total_events,ie.value=t.top_features||[],re.value=t.top_products||[],ce.value=t.top_locations||[];const n=Array(24).fill(0),o=t.summary.hourly||{};Object.entries(o).forEach(([e,l])=>{n[Number(e)]=Number(l)});const s=function loess(e,l=.25){const a=[],t=e.length;for(let u=0;u<t;u++){const n=[];for(let e=0;e<t;e++){const a=Math.abs(e-u),o=Math.exp(-a*a/(2*l*l*t*t));n.push(o)}let o=0,s=0;for(let l=0;l<t;l++)o+=n[l]*e[l],s+=n[l];a.push(s?o/s:0)}return a}(n,.22);ke.value={labels:[...Array(24).keys()].map(e=>`${e}:00`),datasets:[{type:"bar",label:"Events (Bar)",data:n,backgroundColor:"rgba(255,159,64,0.6)",borderRadius:4,order:0},{type:"line",label:"Trend",data:s,borderColor:"#bb86fc",backgroundColor:"rgba(187,134,252,0.15)",fill:!1,tension:.6,cubicInterpolationMode:"monotone",pointRadius:0,borderWidth:3,order:1}]};const{data:i}=await d.from("activity_log").select("id, activity_detail").eq("activity_type","search_query").gte("created_at",start).lte("created_at",l).order("created_at",{ascending:!1}).limit(10);de.value=(i||[]).map(e=>({...e,activity_detail:"string"==typeof e.activity_detail?JSON.parse(e.activity_detail):e.activity_detail}));const{data:r}=await d.rpc("analytics_user_behavior_clusters",{start_ts:start,end_ts:l});he.value=(r||[]).slice(0,10),ve.value=!1,_e.value=!1,fe.value=!1,ye.value=!1}return n(()=>{o.value?fetchAnalytics():l.replace("/profile")}),(e,l)=>(v(),i(c(E),null,{default:r(()=>[_(c(f),null,{default:r(()=>[_(y,{title:"Analytics Dashboard",icon:c(p),showBack:!0},null,8,["icon"])]),_:1}),_(c(h),{class:"ion-padding"},{default:r(()=>[_(c(g),null,{default:r(()=>[_(c(m),null,{default:r(()=>[_(c(b),null,{default:r(()=>[_(c(k),null,{default:r(()=>[_(c(w),null,{default:r(()=>l[7]||(l[7]=[A("Range",-1)])),_:1,__:[7]}),_(c(x),{modelValue:De.value,"onUpdate:modelValue":l[0]||(l[0]=e=>De.value=e),interface:"popover",placeholder:"Select Range",onIonChange:l[1]||(l[1]=e=>function onRangeChange(e){De.value=e.detail.value,fetchAnalytics()}(e))},{default:r(()=>[_(c(M),{value:"daily"},{default:r(()=>l[8]||(l[8]=[A("Daily",-1)])),_:1,__:[8]}),_(c(M),{value:"weekly"},{default:r(()=>l[9]||(l[9]=[A("Weekly",-1)])),_:1,__:[9]}),_(c(M),{value:"monthly"},{default:r(()=>l[10]||(l[10]=[A("Monthly",-1)])),_:1,__:[10]})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),_(c(g),null,{default:r(()=>[_(c(U),null,{default:r(()=>[_(c(C),null,{default:r(()=>[A(D(xe.value),1)]),_:1})]),_:1}),_(c(m),null,{default:r(()=>[S("p",null,[S("strong",null,D(Ue.value),1),_(c(V),{icon:c(R),id:"dau-info",color:"medium",style:{"margin-left":"6px",cursor:"help"}},null,8,["icon"]),_(c(T),{trigger:"dau-info","trigger-action":"click"},{default:r(()=>[_(c(h),{class:"ion-padding"},{default:r(()=>[S("span",{innerHTML:Ce.value},null,8,Y)]),_:1})]),_:1}),A(" : "+D(a.value),1)]),S("p",null,[l[11]||(l[11]=S("strong",null,"Total Events:",-1)),A(" "+D(N.value),1)])]),_:1})]),_:1}),_(c(g),null,{default:r(()=>[_(c(U),null,{default:r(()=>[_(c(C),null,{default:r(()=>l[12]||(l[12]=[A("ðŸ”¥ Most Used Features",-1)])),_:1,__:[12]})]),_:1}),_(c(m),null,{default:r(()=>[S("div",Z,[ge.value&&ge.value.labels.length?(v(),i(c(X),{key:0,data:ge.value,options:we},null,8,["data"])):L("",!0)]),_(c(b),{class:"ion-margin-top"},{default:r(()=>[(v(!0),q(H,null,W(ve.value?ie.value:ie.value.slice(0,5),(e,l)=>(v(),i(c(k),{key:e.activity_type+"-"+l},{default:r(()=>[_(c(w),null,{default:r(()=>[A(D(e.activity_type),1)]),_:2},1024),_(c(j),{slot:"end",color:"primary"},{default:r(()=>[A(D(e.count),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),ie.value.length>5?(v(),q("div",ee,[_(c(B),{fill:"clear",color:"carrot",size:"small",onClick:l[2]||(l[2]=e=>ve.value=!ve.value)},{default:r(()=>[A(D(ve.value?"Show Less":"View More"),1)]),_:1})])):L("",!0)]),_:1})]),_:1}),_(c(g),null,{default:r(()=>[_(c(U),null,{default:r(()=>[_(c(C),null,{default:r(()=>l[13]||(l[13]=[A("ðŸ¥˜ Most Viewed Products",-1)])),_:1,__:[13]})]),_:1}),_(c(m),null,{default:r(()=>[S("div",le,[me.value&&me.value.labels&&me.value.labels.length?(v(),i(c(X),{key:0,data:me.value,options:we},null,8,["data"])):L("",!0)]),_(c(b),{class:"ion-margin-top"},{default:r(()=>[(v(!0),q(H,null,W(_e.value?re.value:re.value.slice(0,5),(e,l)=>(v(),i(c(k),{key:e.barcode+"-"+l},{default:r(()=>[_(c(w),null,{default:r(()=>[A(D(e.product_name),1)]),_:2},1024),_(c(j),{slot:"end",color:"success"},{default:r(()=>[A(D(e.count),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),re.value.length>5?(v(),q("div",ae,[_(c(B),{fill:"clear",color:"carrot",size:"small",onClick:l[3]||(l[3]=e=>_e.value=!_e.value)},{default:r(()=>[A(D(_e.value?"Show Less":"View More"),1)]),_:1})])):L("",!0)]),_:1})]),_:1}),_(c(g),null,{default:r(()=>[_(c(U),null,{default:r(()=>[_(c(C),null,{default:r(()=>l[14]||(l[14]=[A("ðŸ•Œ Most Viewed Locations",-1)])),_:1,__:[14]})]),_:1}),_(c(m),null,{default:r(()=>[S("div",te,[be.value&&be.value.labels.length>0?(v(),i(c(X),{key:0,data:be.value,options:we},null,8,["data"])):L("",!0)]),_(c(b),{class:"ion-margin-top"},{default:r(()=>[(v(!0),q(H,null,W(fe.value?ce.value:ce.value.slice(0,5),(e,l)=>(v(),i(c(k),{key:e.place_id+"-"+l},{default:r(()=>[_(c(w),null,{default:r(()=>[A(D(e.place_name),1)]),_:2},1024),_(c(j),{slot:"end",color:"tertiary"},{default:r(()=>[A(D(e.count),1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),ce.value.length>5?(v(),q("div",ue,[_(c(B),{fill:"clear",color:"carrot",size:"small",onClick:l[4]||(l[4]=e=>fe.value=!fe.value)},{default:r(()=>[A(D(fe.value?"Show Less":"View More"),1)]),_:1})])):L("",!0)]),_:1})]),_:1}),_(c(g),null,{default:r(()=>[_(c(U),null,{default:r(()=>[_(c(C),null,{default:r(()=>[A("â³ Activity by Hour ("+D(Me.value)+")",1)]),_:1})]),_:1}),_(c(m),null,{default:r(()=>[S("div",ne,[ke.value?(v(),i(c(X),{key:0,data:ke.value,options:Ae},null,8,["data"])):L("",!0)])]),_:1})]),_:1}),_(c(g),null,{default:r(()=>[_(c(U),null,{default:r(()=>[_(c(C),null,{default:r(()=>l[15]||(l[15]=[A("ðŸ§­ Top User Paths",-1)])),_:1,__:[15]})]),_:1}),_(c(m),null,{default:r(()=>[_(c(b),null,{default:r(()=>[(v(!0),q(H,null,W(pe.value?he.value:he.value.slice(0,5),(e,a)=>(v(),i(c(k),{key:e.path+"-"+a},{default:r(()=>[_(c(w),null,{default:r(()=>[S("strong",null,D(e.path),1),l[16]||(l[16]=S("br",null,null,-1)),S("small",null,D(e.steps)+" steps",1)]),_:2,__:[16]},1024),_(c(j),{slot:"end",color:"warning"},{default:r(()=>[A(D(e.users)+" users ",1)]),_:2},1024)]),_:2},1024))),128))]),_:1}),he.value.length>5?(v(),q("div",oe,[_(c(B),{fill:"clear",color:"carrot",size:"small",onClick:l[5]||(l[5]=e=>pe.value=!pe.value)},{default:r(()=>[A(D(pe.value?"Show Less":"View More"),1)]),_:1})])):L("",!0)]),_:1})]),_:1}),_(c(g),null,{default:r(()=>[_(c(U),null,{default:r(()=>[_(c(C),null,{default:r(()=>l[17]||(l[17]=[A("ðŸ” Recent Searches",-1)])),_:1,__:[17]})]),_:1}),_(c(m),null,{default:r(()=>[_(c(b),null,{default:r(()=>[(v(!0),q(H,null,W(ye.value?de.value:de.value.slice(0,5),e=>(v(),i(c(k),{key:e.id},{default:r(()=>[_(c(w),null,{default:r(()=>{var l;return[A(D((null===(l=e.activity_detail)||void 0===l?void 0:l.query)||"-"),1)]}),_:2},1024)]),_:2},1024))),128))]),_:1}),de.value.length>5?(v(),q("div",se,[_(c(B),{fill:"clear",color:"carrot",size:"small",onClick:l[6]||(l[6]=e=>ye.value=!ye.value)},{default:r(()=>[A(D(ye.value?"Show Less":"View More"),1)]),_:1})])):L("",!0)]),_:1})]),_:1})]),_:1})]),_:1}))}}),[["__scopeId","data-v-0715dc45"]]))}}});
