import{d as e,r as a,a2 as t,a3 as l,a4 as n,a5 as s,o as i,s as o,a6 as d,c as u,w as r,u as c,B as h,b as p,e as m,O as f,ad as w,P as g,i as x,an as _,S as y,j as v,k as b,ae as N,af as k,cd as I,H as T,J as j,D as C,W as S,G as B,N as L,E as V,p as $,t as A,ce as M,cf as z,cg as R,aB as q,ch as D,bi as E,bj as G,l as H,bd as J,y as O,_ as P}from"./index-D9IhqqAc.js";import"./html5-qrcode-D_4nuB1t.js";const U={style:{display:"flex","align-items":"center",width:"100%",gap:"8px"}},W=["onClick"],F=["src"],K={class:"news-summary"},Q=P(e({__name:"NewsListView",setup(e){const P=h(),Q=a(!0),X=a([]),Y=a([]),Z=a(""),ee=a(!1);let ae=0;async function loadInitialNews(){Q.value=!0,ae=0,X.value=[],Y.value=[],ee.value=!1,await fetchNewsBatch(),Q.value=!1}async function fetchNewsBatch(){const{data:e,error:a}=await o.from("news").select("id, title, header_image, content, created_at").order("created_at",{ascending:!1}).range(ae,ae+5-1);if(!a&&e){const a=e.map(e=>({id:e.id,title:truncateText(e.title,12),summary:generateSummary(e.content,e.title,20),thumbnail:e.header_image||"https://placehold.co/600x400",created_at:e.created_at}));X.value.push(...a),Y.value=X.value,ae+=5,a.length<5&&(ee.value=!0)}}async function loadMore(e){await fetchNewsBatch(),e.target.complete()}async function refreshNews(e){await loadInitialNews(),e.detail.complete()}function truncateText(e,a=10){const t=e.trim().split(/\s+/);return t.slice(0,a).join(" ")+(t.length>a?"…":"")}function generateSummary(e,a,t=20){const l=e.replace(/<[^>]+>/g,"").trim().split(/\r?\n/).map(e=>e.trim()).filter(Boolean).filter(e=>!e.includes(a)).join(" ").split(/\s+/);return l.slice(0,t).join(" ")+(l.length>t?"…":"")}function handleSearch(){}t.extend(l),t.extend(n),t.extend(s),i(async()=>{await loadInitialNews()});const te=d(()=>Z.value?Y.value.filter(e=>e.title.toLowerCase().includes(Z.value.toLowerCase())||e.summary.toLowerCase().includes(Z.value.toLowerCase())):Y.value);function goToAddNews(){P.push("/news/add")}return(e,a)=>(p(),u(c(O),null,{default:r(()=>[m(c(f),null,{default:r(()=>[m(w,{title:e.$t("news.title"),"show-back":"",icon:"none","back-route":"/home"},null,8,["title"]),m(c(g),{style:{padding:"8px"}},{default:r(()=>[x("div",U,[m(c(_),{placeholder:e.$t("news.placeholder"),debounce:800,modelValue:Z.value,"onUpdate:modelValue":a[0]||(a[0]=e=>Z.value=e),onIonInput:handleSearch,class:"rounded",style:{flex:"1"}},null,8,["placeholder","modelValue"])])]),_:1})]),_:1}),m(c(y),{class:"ion-padding"},{default:r(()=>[m(c(N),{style:{"margin-top":"15px"},slot:"fixed",onIonRefresh:refreshNews},{default:r(()=>[m(c(k),{"pulling-icon":c(I),pullingText:e.$t("search.pullToRefresh"),refreshingSpinner:"circles"},null,8,["pulling-icon","pullingText"])]),_:1}),Q.value?(p(),v(T,{key:0},j(5,e=>m(c(C),{key:"skeleton-"+e},{default:r(()=>[m(c(S),{animated:"",style:{width:"100%",height:"140px","border-radius":"8px","margin-bottom":"8px"}}),m(c(B),null,{default:r(()=>[m(c(S),{animated:"",style:{width:"70%",height:"18px","margin-bottom":"6px"}}),m(c(S),{animated:"",style:{width:"40%",height:"14px"}})]),_:1}),m(c(L),null,{default:r(()=>[m(c(S),{animated:"",style:{width:"100%",height:"12px","margin-bottom":"4px"}}),m(c(S),{animated:"",style:{width:"80%",height:"12px"}})]),_:1})]),_:2},1024)),64)):(p(!0),v(T,{key:1},j(te.value,(e,a)=>(p(),v("div",{key:a,onClick:a=>function openNews(e){P.push("/news/".concat(e.id))}(e),class:"news-card"},[m(c(C),null,{default:r(()=>[x("img",{src:e.thumbnail,alt:"news-thumbnail",class:"news-thumbnail"},null,8,F),m(c(B),null,{default:r(()=>[m(c(V),null,{default:r(()=>[$(A(e.title),1)]),_:2},1024),m(c(M),null,{default:r(()=>{return[$(A((a=e.created_at,a?t.utc(a).tz("Asia/Taipei").fromNow():"")),1)];var a}),_:2},1024)]),_:2},1024),m(c(L),null,{default:r(()=>[x("p",K,A(e.summary),1)]),_:2},1024)]),_:2},1024)],8,W))),128)),m(c(z),{ref:"infiniteScroll",onIonInfinite:loadMore,threshold:"100px"},{default:r(()=>[m(c(R),{"loading-spinner":"bubbles","loading-text":e.$t("news.loadingMoreNews")},null,8,["loading-text"])]),_:1},512),c(q)||c(D)?(p(),u(c(E),{key:2,vertical:"bottom",horizontal:"end",slot:"fixed"},{default:r(()=>[m(c(G),{color:"carrot",onClick:goToAddNews},{default:r(()=>[m(c(H),{icon:c(J)},null,8,["icon"])]),_:1})]),_:1})):b("",!0)]),_:1})]),_:1}))}}),[["__scopeId","data-v-ecc78a6a"]]);export{Q as default};
