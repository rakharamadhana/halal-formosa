import{d as e,r as l,a6 as a,o as t,C as n,c as o,w as i,u as r,s,bm as c,a8 as u,B as d,b as p,e as _,O as m,ad as v,v as g,k as f,aj as h,l as y,aJ as x,n as b,p as k,bn as w,bo as C,S as z,j as q,i as I,bp as S,bq as P,br as j,t as A,ah as D,H as M,J as O,F as T,aS as E,aR as H,bs as R,ai as V,bt as F,aT as L,bu as B,bv as J,W as N,V as W,y as G,bw as U}from"./index-D9IhqqAc.js";import{Z}from"./zoom-oVw40Yze.js";import"./html5-qrcode-D_4nuB1t.js";const $={key:0},K=["src"],Q={class:"ion-padding-horizontal ion-margin-top"},X={class:"font-bold text-xl"},Y={key:0,class:"ion-margin-bottom"},ee=["onClick"],le={class:"gold-cert-content"},ae={class:"gold-cert-left"},te=["src"],ne={class:"gold-cert-text"},oe={class:"gold-cert-name"},ie={style:{"white-space":"pre-line"}},re={class:"rounded-xl overflow-hidden ion-margin-vertical shadow-md"},se=["src"],ce={class:"ion-margin-vertical"},ue={key:0},de={key:1,class:"text-gray-400"},pe={key:1},_e={class:"swiper-zoom-container"},me=["src"],ve=e({__name:"PlaceDetailsView",setup(e){const ve=l([]),ge=l(!1),fe=c(),he=d(),ye=l(null),xe=l(!1),be=[P,Z],ke=l(!1);function openImageModal(){ye.value&&u.log("explore_detail_open_image",{id:ye.value.id,name:ye.value.name}),ke.value=!0}function closeImageModal(){ke.value=!1}const we=l(!0),Ce=a(()=>{var e;if(!(null==(e=ye.value)?void 0:e.opening_hours))return{};const l={mon:"Mon",tue:"Tue",wed:"Wed",thu:"Thu",fri:"Fri",sat:"Sat",sun:"Sun"},a={};return["mon","tue","wed","thu","fri","sat","sun"].forEach(e=>{var t,n;const o=e;(null==(n=null==(t=ye.value)?void 0:t.opening_hours)?void 0:n[o])&&(a[l[o]]=ye.value.opening_hours[o])}),a}),loadPlace=async()=>{var e,l;we.value=!0;const{data:a,error:t}=await s.from("locations").select("\n    id,\n    name,\n    lat,\n    lng,\n    image,\n    address,\n    description,\n    created_by,\n    phone,\n    instagram,\n    line_id,\n    price_range,\n    opening_hours,\n    location_types(name)\n  ").eq("id",fe.params.id).maybeSingle();if(t)console.error(t);else{if(a){const t=Array.isArray(a.location_types)?a.location_types[0]:a.location_types;ye.value={id:a.id,name:a.name,image:a.image,type:null!=(e=null==t?void 0:t.name)?e:"Halal Location",lat:a.lat,lng:a.lng,address:a.address,description:a.description,phone:a.phone,instagram:a.instagram,line_id:a.line_id,price_range:a.price_range,opening_hours:a.opening_hours,location_types:null!=t?t:null},await async function fetchLocationCertifications(e){ge.value=!0;const{data:l,error:a}=await s.from("location_certifications").select("\n    certified_at,\n    proof_url,\n    partners:partner_id (\n      id,\n      name,\n      logo_url,\n      partner_tier,\n      verified\n    )\n  ").eq("location_id",e).eq("status","active");!a&&l&&(ve.value=l.map(e=>{var l,a;const t=Array.isArray(e.partners)?e.partners[0]:e.partners;return t?{certified_at:null!=(l=e.certified_at)?l:null,proof_url:null!=(a=e.proof_url)?a:null,partner:t}:null}).filter(e=>null!==e).filter(e=>"gold"===e.partner.partner_tier));ge.value=!1}(a.id);const{data:{user:n}}=await s.auth.getUser();if(n){const{data:e}=await s.from("user_roles").select("role").eq("user_id",n.id).single();n.id!==a.created_by&&"admin"!==(null==e?void 0:e.role)&&"contributor"!==(null==e?void 0:e.role)||(xe.value=!0)}await u.log("explore_place_detail_view",{id:a.id,name:a.name,type:null!=(l=null==t?void 0:t.name)?l:null})}we.value=!1}};t(loadPlace),n(loadPlace);const logInstagram=()=>{ye.value&&u.log("explore_detail_instagram",{id:ye.value.id,instagram:ye.value.instagram})};const share=async()=>{ye.value&&(await u.log("explore_detail_share",{id:ye.value.id,name:ye.value.name}),await U.share({title:ye.value.name,text:"".concat(ye.value.name," (").concat(ye.value.type,")\nðŸ“ https://maps.google.com/?q=").concat(ye.value.lat,",").concat(ye.value.lng,"\n\nShared via Halal Formosa ðŸ•Œ"),dialogTitle:"Share place"}))},logOpenMaps=()=>{ye.value&&u.log("explore_detail_open_maps",{id:ye.value.id,name:ye.value.name})},logCall=()=>{ye.value&&u.log("explore_detail_call",{id:ye.value.id,phone:ye.value.phone})},editItem=()=>{ye.value&&(u.log("explore_detail_edit",{id:ye.value.id,name:ye.value.name}),he.push("/place/".concat(ye.value.id,"/edit")))},reportItem=()=>{ye.value&&(u.log("explore_detail_report",{id:ye.value.id,name:ye.value.name}),he.push("/place/".concat(ye.value.id,"/report")))},logLine=()=>{ye.value&&u.log("explore_detail_line",{id:ye.value.id,line_id:ye.value.line_id})};return(e,l)=>(p(),o(r(G),null,{default:i(()=>[_(r(m),null,{default:i(()=>[_(v,{title:e.$t("explore.details.title"),"show-back":"",useRouterBack:!0,backRoute:"/explore",icon:r(g)},{actions:i(()=>[xe.value?(p(),o(r(h),{key:0,button:"",onClick:editItem,lines:"none"},{default:i(()=>[_(r(y),{icon:r(x),slot:"start"},null,8,["icon"]),_(r(b),null,{default:i(()=>l[1]||(l[1]=[k("Edit",-1)])),_:1,__:[1]})]),_:1})):f("",!0),_(r(h),{button:"",onClick:reportItem,lines:"none"},{default:i(()=>[_(r(y),{icon:r(w),slot:"start"},null,8,["icon"]),_(r(b),null,{default:i(()=>l[2]||(l[2]=[k("Report",-1)])),_:1,__:[2]})]),_:1}),_(r(h),{button:"",onClick:share,lines:"none"},{default:i(()=>[_(r(y),{icon:r(C),slot:"start"},null,8,["icon"]),_(r(b),null,{default:i(()=>l[3]||(l[3]=[k("Share",-1)])),_:1,__:[3]})]),_:1})]),_:1},8,["title","icon"])]),_:1}),_(r(z),null,{default:i(()=>[!we.value&&ye.value?(p(),q("div",$,[ye.value.image?(p(),o(r(S),{key:0,modules:be,zoom:!0,"slides-per-view":1,pagination:{clickable:!0},class:"place-swiper"},{default:i(()=>[_(r(j),null,{default:i(()=>{var e;return[I("img",{src:(null==(e=ye.value)?void 0:e.image)||"https://placehold.co/200x100",alt:"Place image",style:{width:"100%",height:"100%","object-fit":"cover",cursor:"pointer"},onClick:openImageModal},null,8,K)]}),_:1})]),_:1})):f("",!0),I("div",Q,[I("h2",X,A(ye.value.name),1),_(r(D),{color:"carrot",class:"capitalize"},{default:i(()=>[k(A(ye.value.type),1)]),_:1}),!ge.value&&ve.value.length?(p(),q("div",Y,[l[6]||(l[6]=I("p",null,[I("strong",null,[I("small",null,"Certified by")])],-1)),(p(!0),q(M,null,O(ve.value,e=>(p(),q("div",{key:e.partner.id,class:"gold-cert-card",role:"button",tabindex:"0",onClick:l=>function goToPartner(e){u.log("partner_click",{partner_id:e,source:"location_detail"}),he.push("/partner/".concat(e))}(e.partner.id)},[l[5]||(l[5]=I("div",{class:"gold-glow"},null,-1)),I("div",le,[I("div",ae,[e.partner.logo_url?(p(),q("img",{key:0,src:e.partner.logo_url,alt:"logo",class:"gold-cert-logo"},null,8,te)):f("",!0),I("div",ne,[I("div",oe,A(e.partner.name),1),l[4]||(l[4]=I("div",{class:"gold-cert-sub"}," Gold Partner Â· Verified ",-1))])]),e.proof_url?(p(),o(r(T),{key:0,fill:"clear",size:"small",color:"carrot",onClick:l[0]||(l[0]=E(()=>{},["stop"])),href:e.proof_url,target:"_blank","aria-label":"View certificate"},{default:i(()=>[_(r(y),{slot:"icon-only",icon:r(H)},null,8,["icon"])]),_:2},1032,["href"])):f("",!0)])],8,ee))),128))])):f("",!0),ye.value.description?(p(),o(r(h),{key:1,lines:"none"},{default:i(()=>[_(r(y),{icon:r(H),slot:"start",color:"carrot"},null,8,["icon"]),_(r(b),null,{default:i(()=>[l[7]||(l[7]=I("p",{class:"text-sm text-gray-500"},"Description",-1)),I("p",ie,A(ye.value.description),1)]),_:1,__:[7]})]),_:1})):f("",!0),_(r(h),{lines:"none"},{default:i(()=>[_(r(y),{icon:r(R),slot:"start",color:"carrot"},null,8,["icon"]),_(r(b),null,{default:i(()=>[l[8]||(l[8]=I("p",{class:"text-sm text-gray-500"},"Address",-1)),I("p",null,A(ye.value.address||"No address available"),1)]),_:1,__:[8]}),_(r(T),{fill:"clear",size:"small",color:"carrot",onClick:logOpenMaps,href:"https://www.google.com/maps/search/?api=1&query=".concat(ye.value.lat,",").concat(ye.value.lng),target:"_blank"},{default:i(()=>l[9]||(l[9]=[k(" Open ",-1)])),_:1,__:[9]},8,["href"])]),_:1}),I("div",re,[I("iframe",{src:"https://maps.google.com/maps?q=".concat(ye.value.lat,",").concat(ye.value.lng,"&z=16&output=embed"),width:"100%",height:"200",style:{border:"0"},loading:"lazy",referrerpolicy:"no-referrer-when-downgrade"},null,8,se)]),I("div",ce,[ye.value.opening_hours?(p(),q(M,{key:0},[l[10]||(l[10]=I("h3",{class:"font-bold text-lg ion-margin-top"},"Opening Hours",-1)),_(r(V),null,{default:i(()=>[(p(!0),q(M,null,O(Ce.value,(e,l)=>(p(),o(r(h),{key:l},{default:i(()=>[_(r(b),{class:"capitalize"},{default:i(()=>[k(A(l),1)]),_:2},1024),_(r(b),{slot:"end",class:"ion-text-right"},{default:i(()=>[e.active?(p(),q("span",ue,A(e.open)+" â€“ "+A(e.close),1)):(p(),q("span",de,"Closed"))]),_:2},1024)]),_:2},1024))),128))]),_:1})],64)):f("",!0),ye.value.phone||ye.value.instagram||ye.value.line_id?(p(),q(M,{key:1},[l[17]||(l[17]=I("h3",{class:"font-bold text-lg ion-margin-top"},"Additional Details",-1)),ye.value.phone?(p(),o(r(h),{key:0,lines:"none"},{default:i(()=>[_(r(y),{icon:r(F),slot:"start",color:"carrot"},null,8,["icon"]),_(r(b),null,{default:i(()=>[l[11]||(l[11]=I("p",{class:"text-sm text-gray-500"},"Phone",-1)),I("p",null,A(ye.value.phone),1)]),_:1,__:[11]}),_(r(T),{fill:"clear",color:"carrot",onClick:logCall,href:"tel:".concat(ye.value.phone)},{default:i(()=>l[12]||(l[12]=[k(" Call ",-1)])),_:1,__:[12]},8,["href"])]),_:1})):f("",!0),ye.value.instagram?(p(),o(r(h),{key:1,lines:"none"},{default:i(()=>[_(r(y),{icon:r(L),slot:"start",color:"carrot"},null,8,["icon"]),_(r(b),null,{default:i(()=>[l[13]||(l[13]=I("p",{class:"text-sm text-gray-500"},"Instagram",-1)),I("p",null,"@"+A(ye.value.instagram.replace("@","")),1)]),_:1,__:[13]}),_(r(T),{fill:"clear",size:"small",onClick:logInstagram,href:"https://instagram.com/".concat(ye.value.instagram.replace("@","")),target:"_blank"},{default:i(()=>l[14]||(l[14]=[k(" Open ",-1)])),_:1,__:[14]},8,["href"])]),_:1})):f("",!0),ye.value.line_id?(p(),o(r(h),{key:2,lines:"none"},{default:i(()=>[_(r(y),{icon:r(B),slot:"start",color:"carrot"},null,8,["icon"]),_(r(b),null,{default:i(()=>[l[15]||(l[15]=I("p",{class:"text-sm text-gray-500"},"LINE ID",-1)),I("p",null,A(ye.value.line_id),1)]),_:1,__:[15]}),_(r(T),{fill:"clear",size:"small",onClick:logLine,href:"line://ti/p/~".concat(ye.value.line_id)},{default:i(()=>l[16]||(l[16]=[k(" Open ",-1)])),_:1,__:[16]},8,["href"])]),_:1})):f("",!0)],64)):f("",!0),ye.value.price_range?(p(),o(r(h),{key:2,lines:"none"},{default:i(()=>[_(r(y),{icon:r(J),slot:"start",color:"carrot"},null,8,["icon"]),_(r(b),null,{default:i(()=>[l[18]||(l[18]=I("p",{class:"text-sm text-gray-500"},"Estimated Price",-1)),I("p",null,A(ye.value.price_range),1)]),_:1,__:[18]})]),_:1})):f("",!0)])])])):(p(),q("div",pe,[_(r(N),{animated:"",style:{width:"100%",height:"300px","margin-bottom":"12px"}}),_(r(N),{animated:"",style:{width:"80%",height:"20px","margin-bottom":"8px"}}),_(r(N),{animated:"",style:{width:"60%",height:"16px","margin-bottom":"8px"}})]))]),_:1}),_(r(W),{"is-open":ke.value,onDidDismiss:closeImageModal},{default:i(()=>[_(r(z),{fullscreen:""},{default:i(()=>[_(r(T),{fill:"solid",color:"carrot",class:"image-modal-close-btn",onClick:closeImageModal},{default:i(()=>l[19]||(l[19]=[k(" âœ• ",-1)])),_:1,__:[19]}),_(r(S),{modules:[r(Z)],zoom:!0,"slides-per-view":1,class:"fullscreen-swiper"},{default:i(()=>[_(r(j),null,{default:i(()=>{var e;return[I("div",_e,[I("img",{src:(null==(e=ye.value)?void 0:e.image)||"https://placehold.co/200x100",alt:"Place Image"},null,8,me)])]}),_:1})]),_:1},8,["modules"])]),_:1})]),_:1},8,["is-open"])]),_:1}))}});export{ve as default};
