System.register(["./index-legacy-DryGZUwD.js","./html5-qrcode-legacy-D5DtuMLO.js"],function(e,l){"use strict";var a,t,o,r,i,n,u,d,c,s,y,v,f,p,m,g,k,_,b,h,w,x,C,R,z,V,q,S,E,P,H,I,N,U,j,L,A,M,D,F;return{setters:[e=>{a=e.d,t=e.bm,o=e.r,r=e.a6,i=e.o,n=e.c,u=e.w,d=e.u,c=e.s,s=e.b,y=e.e,v=e.O,f=e.P,p=e.Q,m=e.p,g=e.t,k=e.R,_=e.b1,b=e.k,h=e.F,w=e.S,x=e.D,C=e.G,R=e.E,z=e.N,V=e.j,q=e.H,S=e.J,E=e.aj,P=e.n,H=e.by,I=e.aq,N=e.ar,U=e.ah,j=e.ai,L=e.i,A=e.ao,M=e.ba,D=e.y,F=e._},null],execute:function(){var l=document.createElement("style");l.textContent=".center-spinner[data-v-c62d634c]{display:block;margin:2rem auto}.meta[data-v-c62d634c]{font-size:.85rem;color:var(--ion-color-medium)}.highlight-row[data-v-c62d634c]{display:flex;align-items:center;gap:8px;flex-wrap:wrap}ion-chip[data-v-c62d634c]{--padding-start: 8px;--padding-end: 8px}\n",document.head.appendChild(l);const K={product_categories:{label:"Product Categories",pk:"id",fields:[{key:"name",label:"Name",type:"text",required:!0}]},ingredient_highlights:{label:"Ingredient Highlights",pk:"id",fields:[{key:"keyword",label:"Keyword (EN)",type:"text",required:!0},{key:"keyword_zh",label:"Keyword (ZH)",type:"text"},{key:"color",label:"Status",type:"select",required:!0,options:[{value:"primary",label:"Muslim-friendly"},{value:"warning",label:"Syubhah"},{value:"danger",label:"Haram"}]}]},location_types:{label:"Location Types",pk:"id",fields:[{key:"name",label:"Name",type:"text",required:!0},{key:"emoji",label:"Emoji",type:"text",required:!1},{key:"color",label:"Color (Hex)",type:"text",required:!1},{key:"icon",label:"Ionicon Key",type:"text",required:!1},{key:"is_active",label:"Active",type:"select",options:[{value:!0,label:"Active"},{value:!1,label:"Inactive"}]}]},stores:{label:"Stores",pk:"id",fields:[{key:"name",label:"Store Name",type:"text",required:!0},{key:"website",label:"Website",type:"url"},{key:"logo_url",label:"Logo URL",type:"url"},{key:"sort_order",label:"Sort Order",type:"number"}]},category_rules:{label:"Category Rules",pk:"id",fields:[{key:"keyword",label:"Keyword",type:"text",required:!0},{key:"category_id",label:"Category",type:"select",relation:{table:"product_categories",value:"id",label:"name"}}]}},$={key:0,style:{color:"red"}},O={class:"highlight-row"},W={key:0,class:"meta"},G={key:0,class:"meta"},J={key:0,style:{display:"flex","justify-content":"center",gap:"12px",margin:"1rem 0"}};e("default",F(a({__name:"AdminMasterDataEditor",setup(e){const l=t().params.table,a=K[l];if(!a)throw new Error("Invalid master data table");const F=o([]),Q=o({}),T=o({}),Z=o(null),B=o(!1),X=o(!1),Y=o(1),ee=o(0);async function fetchRows(){B.value=!0;const e=10*(Y.value-1),t=e+10-1,{data:o,count:r,error:i}=await c.from(l).select("*",{count:"exact"}).order(a.pk,{ascending:!0}).range(e,t);i||(F.value=o||[],ee.value=r||0),B.value=!1}async function save(){X.value=!0;const e={...T.value};"ingredient_highlights"===l&&e.color&&(e.color=function toCssColor(e){return e.startsWith("--ion-color-")?e:`--ion-color-${e}`}(e.color)),Z.value?await c.from(l).update(e).eq(a.pk,Z.value):await c.from(l).insert(e),resetForm(),Y.value=1,await fetchRows(),X.value=!1}function resetForm(){Z.value=null,T.value={}}const le=r(()=>Math.ceil(ee.value/10));function nextPage(){Y.value<le.value&&(Y.value++,fetchRows())}function prevPage(){Y.value>1&&(Y.value--,fetchRows())}function displayPrimary(e){return e.name||e.keyword||e.id}function displaySecondary(e){if(e.keyword_zh)return e.keyword_zh;if(e.website)return e.website;if(e.category_id&&Q.value.category_id){const l=Q.value.category_id.find(l=>l.id===e.category_id);return(null==l?void 0:l.name)||""}return""}function getHighlightLabel(e){switch(e){case"--ion-color-primary":return"Muslim-friendly";case"--ion-color-warning":return"Syubhah";case"--ion-color-danger":return"Haram";default:return e}}function normalizeIonColor(e){return e?e.replace("--ion-color-",""):"medium"}function getRelationValue(e){var l;return null===(l=e.relation)||void 0===l?void 0:l.value}function getRelationLabel(e){var l;return null===(l=e.relation)||void 0===l?void 0:l.label}return i(async()=>{await async function fetchRelations(){for(const e of a.fields)if(e.relation){const{table:l,value:a,label:t}=e.relation,{data:o}=await c.from(l).select(`${a}, ${t}`).order(t);Q.value[e.key]=o||[]}}(),await fetchRows()}),(e,t)=>(s(),n(d(D),null,{default:u(()=>[y(d(v),null,{default:u(()=>[y(d(f),null,{default:u(()=>[y(d(p),null,{default:u(()=>{var e;return[m(g((null===(e=d(a))||void 0===e?void 0:e.label)||"Master Data"),1)]}),_:1}),y(d(k),{slot:"start"},{default:u(()=>[y(d(_),{"default-href":"/admin/master-data"})]),_:1}),y(d(k),{slot:"end"},{default:u(()=>[Z.value?(s(),n(d(h),{key:0,color:"medium",size:"small",onClick:resetForm},{default:u(()=>t[0]||(t[0]=[m(" Cancel Edit ",-1)])),_:1,__:[0]})):b("",!0)]),_:1})]),_:1})]),_:1}),y(d(w),{class:"ion-padding"},{default:u(()=>[d(a)?(s(),n(d(x),{key:0},{default:u(()=>[y(d(C),null,{default:u(()=>[y(d(R),null,{default:u(()=>[m(g(Z.value?"Edit":"Add New")+" "+g(d(a).label),1)]),_:1})]),_:1}),y(d(z),null,{default:u(()=>[(s(!0),V(q,null,S(d(a).fields,e=>(s(),n(d(E),{key:e.key,lines:"full"},{default:u(()=>{return[y(d(P),{position:"stacked"},{default:u(()=>[m(g(e.label)+" ",1),e.required?(s(),V("span",$,"*")):b("",!0)]),_:2},1024),["text","url","number"].includes(e.type)?(s(),n(d(H),{key:0,modelValue:T.value[e.key],"onUpdate:modelValue":l=>T.value[e.key]=l,type:(l=e.type,"number"===l?"number":"url"===l?"url":"text"),placeholder:e.label},null,8,["modelValue","onUpdate:modelValue","type","placeholder"])):"select"===e.type&&e.options?(s(),n(d(I),{key:1,modelValue:T.value[e.key],"onUpdate:modelValue":l=>T.value[e.key]=l,interface:"popover"},{default:u(()=>[(s(!0),V(q,null,S(e.options,e=>(s(),n(d(N),{key:e.value,value:e.value},{default:u(()=>[m(g(e.label),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):b("",!0),"color"===e.key&&T.value.color?(s(),n(d(U),{key:2,color:T.value.color,style:{"margin-top":"8px"}},{default:u(()=>{var l;return[m(g(null===(l=e.options)||void 0===l||null===(l=l.find(e=>e.value===T.value.color))||void 0===l?void 0:l.label),1)]}),_:2},1032,["color"])):"select"===e.type&&e.relation?(s(),n(d(I),{key:3,modelValue:T.value[e.key],"onUpdate:modelValue":l=>T.value[e.key]=l,interface:"popover"},{default:u(()=>[(s(!0),V(q,null,S(Q.value[e.key],l=>(s(),n(d(N),{key:l[getRelationValue(e)],value:l[getRelationValue(e)]},{default:u(()=>[m(g(l[getRelationLabel(e)]),1)]),_:2},1032,["value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])):b("",!0)];var l}),_:2},1024))),128)),y(d(h),{expand:"block",color:"carrot",style:{"margin-top":"1rem"},disabled:X.value,onClick:save},{default:u(()=>[m(g(Z.value?"Update":"Add"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})):b("",!0),F.value.length?(s(),n(d(x),{key:1},{default:u(()=>[y(d(C),null,{default:u(()=>[y(d(R),null,{default:u(()=>[m("Existing "+g(d(a).label),1)]),_:1})]),_:1}),y(d(z),null,{default:u(()=>[y(d(j),null,{default:u(()=>[(s(!0),V(q,null,S(F.value,e=>(s(),n(d(E),{key:e[d(a).pk],lines:"full"},{default:u(()=>[y(d(P),null,{default:u(()=>["ingredient_highlights"===d(l)?(s(),V(q,{key:0},[L("div",O,[L("strong",null,g(e.keyword),1)]),e.keyword_zh?(s(),V("div",W,g(e.keyword_zh),1)):b("",!0),e.color?(s(),n(d(U),{key:1,color:normalizeIonColor(e.color),size:"small"},{default:u(()=>[m(g(getHighlightLabel(e.color)),1)]),_:2},1032,["color"])):b("",!0)],64)):(s(),V(q,{key:1},[L("strong",null,g(displayPrimary(e)),1),displaySecondary(e)?(s(),V("div",G,g(displaySecondary(e)),1)):b("",!0)],64))]),_:2},1024),y(d(k),{slot:"end"},{default:u(()=>[y(d(h),{size:"small",fill:"clear",color:"primary",onClick:t=>function editRow(e){Z.value=e[a.pk];const t={...e};"ingredient_highlights"===l&&t.color&&(t.color=normalizeIonColor(t.color)),T.value=t}(e)},{default:u(()=>t[1]||(t[1]=[m(" Edit ",-1)])),_:2,__:[1]},1032,["onClick"]),y(d(h),{size:"small",fill:"clear",color:"danger",onClick:t=>async function remove(e){confirm("Are you sure you want to delete this item?")&&(await c.from(l).delete().eq(a.pk,e),1===F.value.length&&Y.value>1&&Y.value--,await fetchRows())}(e[d(a).pk])},{default:u(()=>t[2]||(t[2]=[m(" Delete ",-1)])),_:2,__:[2]},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})]),_:1}),ee.value>10?(s(),V("div",J,[y(d(h),{size:"small",fill:"outline",disabled:1===Y.value,onClick:prevPage},{default:u(()=>t[3]||(t[3]=[m(" Previous ",-1)])),_:1,__:[3]},8,["disabled"]),y(d(A),{style:{"align-self":"center"}},{default:u(()=>[m(" Page "+g(Y.value)+" of "+g(le.value),1)]),_:1}),y(d(h),{size:"small",fill:"outline",disabled:Y.value>=le.value,onClick:nextPage},{default:u(()=>t[4]||(t[4]=[m(" Next ",-1)])),_:1,__:[4]},8,["disabled"])])):b("",!0)]),_:1})):b("",!0),F.value.length||B.value?b("",!0):(s(),n(d(A),{key:2,color:"medium"},{default:u(()=>t[5]||(t[5]=[L("p",{style:{"text-align":"center","margin-top":"2rem"}}," No data yet. ",-1)])),_:1,__:[5]})),B.value?(s(),n(d(M),{key:3,class:"center-spinner"})):b("",!0)]),_:1})]),_:1}))}}),[["__scopeId","data-v-c62d634c"]]))}}});
