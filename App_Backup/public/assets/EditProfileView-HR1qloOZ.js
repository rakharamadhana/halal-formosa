import{d as e,a6 as l,aY as a,r as t,aZ as o,a_ as i,s as n,B as d,aD as u,a$ as r,aF as s,b0 as f,c,w as p,u as m,b as _,e as v,O as h,P as b,Q as g,p as y,t as P,R as $,b1 as k,S as w,k as C,D as x,N as V,i as F,ai as j,aj as D,n as N,aK as U,b2 as q,V as E,b3 as L,b4 as O,aE as T,ao as A,j as B,W as G,H as M,F as z,an as H,J as I,aq as J,aG as K,ar as Q,b5 as R,aL as S,b6 as W,b7 as Y,y as Z,b8 as X,b9 as ee}from"./index-D9IhqqAc.js";import{u as le}from"./useNotifier-BmoHZOF2.js";import"./html5-qrcode-D_4nuB1t.js";const ae={style:{"margin-top":"6px"}},te=["src"],oe=["src"],ie={style:{margin:"0","padding-left":"1rem","font-size":"0.9rem"}},ne=e({__name:"EditProfileView",setup(e){const{notifyEvent:ne}=le(),de=d(),ue=l(()=>!a.value);let re=null;const se=t(!1),fe=t(!1),ce=t(""),pe=t(null),me=t(!0),_e=l(()=>o.value.filter(e=>e.name.common.toLowerCase().includes(ce.value.toLowerCase())));async function saveProfile(){var e,l,a,t,i;if(!re)return;await X(re);const{data:d,error:u}=await n.from("user_profiles").select("\n      display_name,\n      bio,\n      date_of_birth,\n      nationality,\n      profile_completed_notified\n    ").eq("id",re).single();if(u||!d)return console.warn("Failed to reload profile after save",u),void de.back();if(!!d.bio&&!!d.date_of_birth&&!!d.nationality&&!d.profile_completed_notified){const u=null!=(l=null==(e=o.value.find(e=>e.cca2===d.nationality))?void 0:e.name.common)?l:d.nationality,r=["A user has completed their profile and is now active.","","ðŸ“§ Email: ".concat(null!=(t=null==(a=ee.value)?void 0:a.email)?t:"unknown"),"ðŸ‘¤ Name: ".concat(d.display_name||"Not provided"),"ðŸŽ‚ Date of Birth: ".concat(d.date_of_birth),"ðŸŒ Nationality: ".concat(u)].join("\n");ne("user_activated","ðŸŽ‰ User Activated",r,void 0,{user_id:re,email:null==(i=ee.value)?void 0:i.email,name:d.display_name,date_of_birth:d.date_of_birth,nationality:u},["discord"]).catch(console.error),await n.from("user_profiles").update({profile_completed_notified:!0}).eq("id",re)}de.replace("/profile")}return i(async()=>{const{data:e}=await n.auth.getUser();(null==e?void 0:e.user)?(re=e.user.id,await u(re),o.value.length||await r(),s.value&&(pe.value=o.value.find(e=>e.cca2===s.value)||null),me.value=!1):de.push("/login")}),f((e,l,t)=>{se.value||a.value?t():t(!1)}),(e,l)=>(_(),c(m(Z),null,{default:p(()=>[v(m(h),null,{default:p(()=>[v(m(b),null,{default:p(()=>[v(m(g),null,{default:p(()=>[y(P(e.$t("profile.editProfile.title")),1)]),_:1}),v(m($),{slot:"start"},{default:p(()=>[v(m(k),{"default-href":"/profile",disabled:!se.value&&!m(a)},null,8,["disabled"])]),_:1})]),_:1})]),_:1}),v(m(w),{class:"ion-padding"},{default:p(()=>[ue.value?(_(),c(m(x),{key:0,color:"warning",class:"ion-margin-bottom"},{default:p(()=>[v(m(V),null,{default:p(()=>[F("strong",null,P(e.$t("profile.editProfile.mustCompleteTitle")),1),F("p",ae,P(e.$t("profile.editProfile.mustCompleteDesc")),1)]),_:1})]),_:1})):C("",!0),v(m(j),null,{default:p(()=>[v(m(D),null,{default:p(()=>[v(m(N),null,{default:p(()=>[y(P(e.$t("profile.editProfile.dob")),1)]),_:1}),v(m(U),{slot:"end"},{default:p(()=>[v(m(q),{datetime:"dobPicker"})]),_:1}),v(m(E),{"keep-contents-mounted":"true"},{default:p(()=>[v(m(L),{id:"dobPicker",color:"carrot",modelValue:m(T),"onUpdate:modelValue":l[0]||(l[0]=e=>O(T)?T.value=e:null),presentation:"date","show-default-buttons":!0,"done-text":e.$t("common.ok"),"cancel-text":e.$t("common.cancel")},null,8,["modelValue","done-text","cancel-text"])]),_:1})]),_:1}),v(m(D),{button:"",onClick:l[1]||(l[1]=e=>fe.value=!0)},{default:p(()=>[v(m(N),null,{default:p(()=>[y(P(e.$t("profile.editProfile.nationality")),1)]),_:1}),v(m(A),{slot:"end",style:{color:"var(--ion-color-dark)"}},{default:p(()=>[m(o).length?pe.value?(_(),B(M,{key:1},[F("img",{src:pe.value.flags.png,style:{width:"24px",height:"16px","margin-right":"8px"},alt:"Country Flag"},null,8,te),y(" "+P(pe.value.name.common),1)],64)):(_(),B(M,{key:2},[y(P(e.$t("profile.editProfile.selectCountry")),1)],64)):(_(),c(m(G),{key:0,animated:"",style:{width:"100px",height:"16px"}}))]),_:1})]),_:1}),v(m(E),{"is-open":fe.value,onDidDismiss:l[4]||(l[4]=e=>fe.value=!1)},{default:p(()=>[v(m(h),null,{default:p(()=>[v(m(b),null,{default:p(()=>[v(m(g),null,{default:p(()=>[y(P(e.$t("profile.editProfile.selectNationality")),1)]),_:1}),v(m($),{slot:"end"},{default:p(()=>[v(m(z),{onClick:l[2]||(l[2]=e=>fe.value=!1)},{default:p(()=>[y(P(e.$t("common.close")),1)]),_:1})]),_:1})]),_:1}),v(m(b),null,{default:p(()=>[v(m(H),{modelValue:ce.value,"onUpdate:modelValue":l[3]||(l[3]=e=>ce.value=e),placeholder:e.$t("profile.editProfile.searchCountry")},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),v(m(w),null,{default:p(()=>[v(m(j),null,{default:p(()=>[(_(!0),B(M,null,I(_e.value,e=>(_(),c(m(D),{key:e.cca2,button:"",onClick:l=>function selectCountry(e){s.value=e.cca2,pe.value=e,fe.value=!1}(e)},{default:p(()=>[F("img",{src:e.flags.png,style:{width:"24px",height:"16px","margin-right":"8px"},alt:"Country Flag"},null,8,oe),v(m(N),null,{default:p(()=>[y(P(e.name.common),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1},8,["is-open"]),v(m(D),null,{default:p(()=>[v(m(N),null,{default:p(()=>[y(P(e.$t("profile.editProfile.gender")),1)]),_:1}),v(m(J),{modelValue:m(K),"onUpdate:modelValue":l[5]||(l[5]=e=>O(K)?K.value=e:null),interface:"popover",slot:"end",placeholder:e.$t("profile.editProfile.selectGender")},{default:p(()=>[v(m(Q),{value:"Male"},{default:p(()=>[y(P(e.$t("profile.editProfile.genderMale")),1)]),_:1}),v(m(Q),{value:"Female"},{default:p(()=>[y(P(e.$t("profile.editProfile.genderFemale")),1)]),_:1}),v(m(Q),{value:"Other"},{default:p(()=>[y(P(e.$t("profile.editProfile.genderOther")),1)]),_:1})]),_:1},8,["modelValue","placeholder"])]),_:1}),v(m(D),null,{default:p(()=>[v(m(N),{position:"stacked"},{default:p(()=>[y(P(e.$t("profile.editProfile.bio")),1)]),_:1}),v(m(R),{modelValue:m(S),"onUpdate:modelValue":l[6]||(l[6]=e=>O(S)?S.value=e:null),"auto-grow":"",placeholder:e.$t("profile.editProfile.bioPlaceholder")},null,8,["modelValue","placeholder"])]),_:1})]),_:1}),v(m(D),{lines:"none"},{default:p(()=>[v(m(W),{checked:m(Y),onIonChange:l[7]||(l[7]=e=>Y.value=e.detail.checked),slot:"start"},null,8,["checked"]),v(m(N),null,{default:p(()=>[y(P(e.$t("profile.editProfile.consentTitle"))+" ",1),F("ul",ie,[F("li",null,P(e.$t("profile.editProfile.consentContent1")),1),F("li",null,P(e.$t("profile.editProfile.consentContent2")),1)])]),_:1})]),_:1}),v(m(z),{expand:"block",color:"carrot",onClick:saveProfile,disabled:!m(a)},{default:p(()=>[y(P(ue.value?e.$t("profile.editProfile.completeToContinue"):e.$t("profile.editProfile.save")),1)]),_:1},8,["disabled"])]),_:1})]),_:1}))}});export{ne as default};
