System.register(["./index-legacy-DryGZUwD.js","./zoom-legacy-C7S6DULt.js","./html5-qrcode-legacy-D5DtuMLO.js"],function(e,l){"use strict";var a,t,n,i,o,r,s,u,c,d,p,_,g,m,v,f,h,y,x,b,w,k,C,z,$,q,I,S,j,P,A,D,M,E,O,T,H,R,V,F,L,B,J,N,W,G,U,Z,K;return{setters:[e=>{a=e.d,t=e.r,n=e.a6,i=e.o,o=e.C,r=e.c,s=e.w,u=e.u,c=e.s,d=e.bm,p=e.a8,_=e.B,g=e.b,m=e.e,v=e.O,f=e.ad,h=e.v,y=e.k,x=e.aj,b=e.l,w=e.aJ,k=e.n,C=e.p,z=e.bn,$=e.bo,q=e.S,I=e.j,S=e.i,j=e.bp,P=e.bq,A=e.br,D=e.t,M=e.ah,E=e.H,O=e.J,T=e.F,H=e.aS,R=e.aR,V=e.bs,F=e.ai,L=e.bt,B=e.aT,J=e.bu,N=e.bv,W=e.W,G=e.V,U=e.y,Z=e.bw},e=>{K=e.Z},null],execute:function(){var l=document.createElement("style");l.textContent=".place-swiper{margin:0!important;padding:0!important;width:100%;height:300px;border-radius:0}.fullscreen-swiper,.fullscreen-swiper .swiper-slide,.fullscreen-swiper .swiper-zoom-container{width:100%;height:100%}.fullscreen-swiper .swiper-slide{display:flex;justify-content:center;align-items:center;background:#000}.fullscreen-swiper img{max-width:100%;max-height:100%;object-fit:contain}.image-modal-close-btn{position:absolute;top:calc(env(safe-area-inset-top,0px) + 60px);right:16px;z-index:9999}iframe{border-radius:4px}\n",document.head.appendChild(l);const Q={key:0},X=["src"],Y={class:"ion-padding-horizontal ion-margin-top"},ee={class:"font-bold text-xl"},le={key:0,class:"ion-margin-bottom"},ae=["onClick"],te={class:"gold-cert-content"},ne={class:"gold-cert-left"},ie=["src"],oe={class:"gold-cert-text"},re={class:"gold-cert-name"},se={style:{"white-space":"pre-line"}},ue={class:"rounded-xl overflow-hidden ion-margin-vertical shadow-md"},ce=["src"],de={class:"ion-margin-vertical"},pe={key:0},_e={key:1,class:"text-gray-400"},ge={key:1},me={class:"swiper-zoom-container"},ve=["src"];e("default",a({__name:"PlaceDetailsView",setup(e){const l=t([]),a=t(!1),fe=d(),he=_(),ye=t(null),xe=t(!1),be=[P,K],we=t(!1);function openImageModal(){ye.value&&p.log("explore_detail_open_image",{id:ye.value.id,name:ye.value.name}),we.value=!0}function closeImageModal(){we.value=!1}const ke=t(!0),Ce=n(()=>{var e;if(null===(e=ye.value)||void 0===e||!e.opening_hours)return{};const l={mon:"Mon",tue:"Tue",wed:"Wed",thu:"Thu",fri:"Fri",sat:"Sat",sun:"Sun"},a={};return["mon","tue","wed","thu","fri","sat","sun"].forEach(e=>{var t;const n=e;null!==(t=ye.value)&&void 0!==t&&null!==(t=t.opening_hours)&&void 0!==t&&t[n]&&(a[l[n]]=ye.value.opening_hours[n])}),a}),loadPlace=async()=>{ke.value=!0;const{data:e,error:t}=await c.from("locations").select("\n    id,\n    name,\n    lat,\n    lng,\n    image,\n    address,\n    description,\n    created_by,\n    phone,\n    instagram,\n    line_id,\n    price_range,\n    opening_hours,\n    location_types(name)\n  ").eq("id",fe.params.id).maybeSingle();if(t)console.error(t);else{if(e){var n,i;const t=Array.isArray(e.location_types)?e.location_types[0]:e.location_types;ye.value={id:e.id,name:e.name,image:e.image,type:null!==(n=null==t?void 0:t.name)&&void 0!==n?n:"Halal Location",lat:e.lat,lng:e.lng,address:e.address,description:e.description,phone:e.phone,instagram:e.instagram,line_id:e.line_id,price_range:e.price_range,opening_hours:e.opening_hours,location_types:null!=t?t:null},await async function fetchLocationCertifications(e){a.value=!0;const{data:t,error:n}=await c.from("location_certifications").select("\n    certified_at,\n    proof_url,\n    partners:partner_id (\n      id,\n      name,\n      logo_url,\n      partner_tier,\n      verified\n    )\n  ").eq("location_id",e).eq("status","active");!n&&t&&(l.value=t.map(e=>{var l,a;const t=Array.isArray(e.partners)?e.partners[0]:e.partners;return t?{certified_at:null!==(l=e.certified_at)&&void 0!==l?l:null,proof_url:null!==(a=e.proof_url)&&void 0!==a?a:null,partner:t}:null}).filter(e=>null!==e).filter(e=>"gold"===e.partner.partner_tier)),a.value=!1}(e.id);const{data:{user:o}}=await c.auth.getUser();if(o){const{data:l}=await c.from("user_roles").select("role").eq("user_id",o.id).single();o.id!==e.created_by&&"admin"!==(null==l?void 0:l.role)&&"contributor"!==(null==l?void 0:l.role)||(xe.value=!0)}await p.log("explore_place_detail_view",{id:e.id,name:e.name,type:null!==(i=null==t?void 0:t.name)&&void 0!==i?i:null})}ke.value=!1}};i(loadPlace),o(loadPlace);const logInstagram=()=>{ye.value&&p.log("explore_detail_instagram",{id:ye.value.id,instagram:ye.value.instagram})},share=async()=>{ye.value&&(await p.log("explore_detail_share",{id:ye.value.id,name:ye.value.name}),await Z.share({title:ye.value.name,text:`${ye.value.name} (${ye.value.type})\nðŸ“ https://maps.google.com/?q=${ye.value.lat},${ye.value.lng}\n\nShared via Halal Formosa ðŸ•Œ`,dialogTitle:"Share place"}))},logOpenMaps=()=>{ye.value&&p.log("explore_detail_open_maps",{id:ye.value.id,name:ye.value.name})},logCall=()=>{ye.value&&p.log("explore_detail_call",{id:ye.value.id,phone:ye.value.phone})},editItem=()=>{ye.value&&(p.log("explore_detail_edit",{id:ye.value.id,name:ye.value.name}),he.push(`/place/${ye.value.id}/edit`))},reportItem=()=>{ye.value&&(p.log("explore_detail_report",{id:ye.value.id,name:ye.value.name}),he.push(`/place/${ye.value.id}/report`))},logLine=()=>{ye.value&&p.log("explore_detail_line",{id:ye.value.id,line_id:ye.value.line_id})};return(e,t)=>(g(),r(u(U),null,{default:s(()=>[m(u(v),null,{default:s(()=>[m(f,{title:e.$t("explore.details.title"),"show-back":"",useRouterBack:!0,backRoute:"/explore",icon:u(h)},{actions:s(()=>[xe.value?(g(),r(u(x),{key:0,button:"",onClick:editItem,lines:"none"},{default:s(()=>[m(u(b),{icon:u(w),slot:"start"},null,8,["icon"]),m(u(k),null,{default:s(()=>t[1]||(t[1]=[C("Edit",-1)])),_:1,__:[1]})]),_:1})):y("",!0),m(u(x),{button:"",onClick:reportItem,lines:"none"},{default:s(()=>[m(u(b),{icon:u(z),slot:"start"},null,8,["icon"]),m(u(k),null,{default:s(()=>t[2]||(t[2]=[C("Report",-1)])),_:1,__:[2]})]),_:1}),m(u(x),{button:"",onClick:share,lines:"none"},{default:s(()=>[m(u(b),{icon:u($),slot:"start"},null,8,["icon"]),m(u(k),null,{default:s(()=>t[3]||(t[3]=[C("Share",-1)])),_:1,__:[3]})]),_:1})]),_:1},8,["title","icon"])]),_:1}),m(u(q),null,{default:s(()=>[!ke.value&&ye.value?(g(),I("div",Q,[ye.value.image?(g(),r(u(j),{key:0,modules:be,zoom:!0,"slides-per-view":1,pagination:{clickable:!0},class:"place-swiper"},{default:s(()=>[m(u(A),null,{default:s(()=>{var e;return[S("img",{src:(null===(e=ye.value)||void 0===e?void 0:e.image)||"https://placehold.co/200x100",alt:"Place image",style:{width:"100%",height:"100%","object-fit":"cover",cursor:"pointer"},onClick:openImageModal},null,8,X)]}),_:1})]),_:1})):y("",!0),S("div",Y,[S("h2",ee,D(ye.value.name),1),m(u(M),{color:"carrot",class:"capitalize"},{default:s(()=>[C(D(ye.value.type),1)]),_:1}),!a.value&&l.value.length?(g(),I("div",le,[t[6]||(t[6]=S("p",null,[S("strong",null,[S("small",null,"Certified by")])],-1)),(g(!0),I(E,null,O(l.value,e=>(g(),I("div",{key:e.partner.id,class:"gold-cert-card",role:"button",tabindex:"0",onClick:l=>function goToPartner(e){p.log("partner_click",{partner_id:e,source:"location_detail"}),he.push(`/partner/${e}`)}(e.partner.id)},[t[5]||(t[5]=S("div",{class:"gold-glow"},null,-1)),S("div",te,[S("div",ne,[e.partner.logo_url?(g(),I("img",{key:0,src:e.partner.logo_url,alt:"logo",class:"gold-cert-logo"},null,8,ie)):y("",!0),S("div",oe,[S("div",re,D(e.partner.name),1),t[4]||(t[4]=S("div",{class:"gold-cert-sub"}," Gold Partner Â· Verified ",-1))])]),e.proof_url?(g(),r(u(T),{key:0,fill:"clear",size:"small",color:"carrot",onClick:t[0]||(t[0]=H(()=>{},["stop"])),href:e.proof_url,target:"_blank","aria-label":"View certificate"},{default:s(()=>[m(u(b),{slot:"icon-only",icon:u(R)},null,8,["icon"])]),_:2},1032,["href"])):y("",!0)])],8,ae))),128))])):y("",!0),ye.value.description?(g(),r(u(x),{key:1,lines:"none"},{default:s(()=>[m(u(b),{icon:u(R),slot:"start",color:"carrot"},null,8,["icon"]),m(u(k),null,{default:s(()=>[t[7]||(t[7]=S("p",{class:"text-sm text-gray-500"},"Description",-1)),S("p",se,D(ye.value.description),1)]),_:1,__:[7]})]),_:1})):y("",!0),m(u(x),{lines:"none"},{default:s(()=>[m(u(b),{icon:u(V),slot:"start",color:"carrot"},null,8,["icon"]),m(u(k),null,{default:s(()=>[t[8]||(t[8]=S("p",{class:"text-sm text-gray-500"},"Address",-1)),S("p",null,D(ye.value.address||"No address available"),1)]),_:1,__:[8]}),m(u(T),{fill:"clear",size:"small",color:"carrot",onClick:logOpenMaps,href:`https://www.google.com/maps/search/?api=1&query=${ye.value.lat},${ye.value.lng}`,target:"_blank"},{default:s(()=>t[9]||(t[9]=[C(" Open ",-1)])),_:1,__:[9]},8,["href"])]),_:1}),S("div",ue,[S("iframe",{src:`https://maps.google.com/maps?q=${ye.value.lat},${ye.value.lng}&z=16&output=embed`,width:"100%",height:"200",style:{border:"0"},loading:"lazy",referrerpolicy:"no-referrer-when-downgrade"},null,8,ce)]),S("div",de,[ye.value.opening_hours?(g(),I(E,{key:0},[t[10]||(t[10]=S("h3",{class:"font-bold text-lg ion-margin-top"},"Opening Hours",-1)),m(u(F),null,{default:s(()=>[(g(!0),I(E,null,O(Ce.value,(e,l)=>(g(),r(u(x),{key:l},{default:s(()=>[m(u(k),{class:"capitalize"},{default:s(()=>[C(D(l),1)]),_:2},1024),m(u(k),{slot:"end",class:"ion-text-right"},{default:s(()=>[e.active?(g(),I("span",pe,D(e.open)+" â€“ "+D(e.close),1)):(g(),I("span",_e,"Closed"))]),_:2},1024)]),_:2},1024))),128))]),_:1})],64)):y("",!0),ye.value.phone||ye.value.instagram||ye.value.line_id?(g(),I(E,{key:1},[t[17]||(t[17]=S("h3",{class:"font-bold text-lg ion-margin-top"},"Additional Details",-1)),ye.value.phone?(g(),r(u(x),{key:0,lines:"none"},{default:s(()=>[m(u(b),{icon:u(L),slot:"start",color:"carrot"},null,8,["icon"]),m(u(k),null,{default:s(()=>[t[11]||(t[11]=S("p",{class:"text-sm text-gray-500"},"Phone",-1)),S("p",null,D(ye.value.phone),1)]),_:1,__:[11]}),m(u(T),{fill:"clear",color:"carrot",onClick:logCall,href:`tel:${ye.value.phone}`},{default:s(()=>t[12]||(t[12]=[C(" Call ",-1)])),_:1,__:[12]},8,["href"])]),_:1})):y("",!0),ye.value.instagram?(g(),r(u(x),{key:1,lines:"none"},{default:s(()=>[m(u(b),{icon:u(B),slot:"start",color:"carrot"},null,8,["icon"]),m(u(k),null,{default:s(()=>[t[13]||(t[13]=S("p",{class:"text-sm text-gray-500"},"Instagram",-1)),S("p",null,"@"+D(ye.value.instagram.replace("@","")),1)]),_:1,__:[13]}),m(u(T),{fill:"clear",size:"small",onClick:logInstagram,href:`https://instagram.com/${ye.value.instagram.replace("@","")}`,target:"_blank"},{default:s(()=>t[14]||(t[14]=[C(" Open ",-1)])),_:1,__:[14]},8,["href"])]),_:1})):y("",!0),ye.value.line_id?(g(),r(u(x),{key:2,lines:"none"},{default:s(()=>[m(u(b),{icon:u(J),slot:"start",color:"carrot"},null,8,["icon"]),m(u(k),null,{default:s(()=>[t[15]||(t[15]=S("p",{class:"text-sm text-gray-500"},"LINE ID",-1)),S("p",null,D(ye.value.line_id),1)]),_:1,__:[15]}),m(u(T),{fill:"clear",size:"small",onClick:logLine,href:`line://ti/p/~${ye.value.line_id}`},{default:s(()=>t[16]||(t[16]=[C(" Open ",-1)])),_:1,__:[16]},8,["href"])]),_:1})):y("",!0)],64)):y("",!0),ye.value.price_range?(g(),r(u(x),{key:2,lines:"none"},{default:s(()=>[m(u(b),{icon:u(N),slot:"start",color:"carrot"},null,8,["icon"]),m(u(k),null,{default:s(()=>[t[18]||(t[18]=S("p",{class:"text-sm text-gray-500"},"Estimated Price",-1)),S("p",null,D(ye.value.price_range),1)]),_:1,__:[18]})]),_:1})):y("",!0)])])])):(g(),I("div",ge,[m(u(W),{animated:"",style:{width:"100%",height:"300px","margin-bottom":"12px"}}),m(u(W),{animated:"",style:{width:"80%",height:"20px","margin-bottom":"8px"}}),m(u(W),{animated:"",style:{width:"60%",height:"16px","margin-bottom":"8px"}})]))]),_:1}),m(u(G),{"is-open":we.value,onDidDismiss:closeImageModal},{default:s(()=>[m(u(q),{fullscreen:""},{default:s(()=>[m(u(T),{fill:"solid",color:"carrot",class:"image-modal-close-btn",onClick:closeImageModal},{default:s(()=>t[19]||(t[19]=[C(" âœ• ",-1)])),_:1,__:[19]}),m(u(j),{modules:[u(K)],zoom:!0,"slides-per-view":1,class:"fullscreen-swiper"},{default:s(()=>[m(u(A),null,{default:s(()=>{var e;return[S("div",me,[S("img",{src:(null===(e=ye.value)||void 0===e?void 0:e.image)||"https://placehold.co/200x100",alt:"Place Image"},null,8,ve)])]}),_:1})]),_:1},8,["modules"])]),_:1})]),_:1},8,["is-open"])]),_:1}))}}))}}});
