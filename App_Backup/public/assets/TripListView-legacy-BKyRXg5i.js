System.register(["./index-legacy-DryGZUwD.js","./index-legacy-D28wTZi4.js","./html5-qrcode-legacy-D5DtuMLO.js"],function(e,t){"use strict";var i,a,l,r,o,n,c,d,s,u,p,v,_,g,f,m,h,x,y,w,b,k,z,C,$,j,T,V,F,q,I,S,L,P,A,D,N,O,B,R,U,E,H,J,W,G,K,M,Q;return{setters:[e=>{i=e.d,a=e.r,l=e.A,r=e.a6,o=e.a7,n=e.o,c=e.a8,d=e.c,s=e.w,u=e.u,p=e.s,v=e.b,_=e.e,g=e.O,f=e.ad,m=e.x,h=e.P,x=e.an,y=e.i,w=e.F,b=e.ao,k=e.p,z=e.t,C=e.l,$=e.ap,j=e.aq,T=e.ar,V=e.as,F=e.at,q=e.au,I=e.av,S=e.j,L=e.k,P=e.v,A=e.H,D=e.J,N=e.ah,O=e.L,B=e.n,R=e.$,U=e.aw,E=e.S,H=e.D,J=e.W,W=e.N,G=e.ag,K=e.y,M=e._},e=>{Q=e.B},null],execute:function(){var t=document.createElement("style");t.textContent=".trip-card[data-v-4e4d552e]{position:relative;overflow:hidden;border-radius:14px;transition:transform .15s ease,box-shadow .15s ease}.trip-card[data-v-4e4d552e]:active{transform:scale(.98)}.trip-cover[data-v-4e4d552e]{width:100%;height:240px;object-fit:cover;border-top-left-radius:14px;border-top-right-radius:14px}.trip-title[data-v-4e4d552e]{margin:0 0 6px;font-size:16px;font-weight:600;line-height:1.3}.trip-provider[data-v-4e4d552e]{margin:2px 0 8px;font-size:12px;color:var(--ion-color-medium)}.trip-meta[data-v-4e4d552e]{margin:4px 0;font-size:13px;color:var(--ion-color-medium);display:flex;align-items:center;gap:6px;flex-wrap:wrap}.chip-row[data-v-4e4d552e]{display:flex;flex-wrap:wrap;gap:6px;margin-bottom:8px}.category-chip[data-v-4e4d552e]{font-size:12px}.category-chip.active[data-v-4e4d552e]{background:var(--ion-color-carrot);color:#fff;border-color:var(--ion-color-carrot)}.partner-badge[data-v-4e4d552e]{position:absolute;top:12px;left:12px;z-index:3;font-size:11px;font-weight:600;padding:4px 8px;border-radius:8px;backdrop-filter:blur(6px)}.filter-clear-row[data-v-4e4d552e]{display:flex;justify-content:flex-start;padding:6px 6px 10px}.clear-chip[data-v-4e4d552e]{--background: rgba(255, 255, 255, .08);--color: var(--ion-color-medium);border:1px dashed var(--ion-color-medium);border-radius:999px;font-weight:500;font-size:13px;padding:0 10px}.toolbar-search[data-v-4e4d552e]{padding:8px 12px}.toolbar-row[data-v-4e4d552e]{display:flex;align-items:center;justify-content:space-between;width:100%}.icon-inline[data-v-4e4d552e]{vertical-align:middle;margin-right:6px}ion-card-content[data-v-4e4d552e]{padding-top:12px}\n",document.head.appendChild(t);const X={class:"toolbar-row"},Y={class:"filter-section"},Z={class:"filter-title"},ee={class:"category-bar"},te={class:"filter-title"},ie={class:"category-bar"},ae={key:0,class:"filter-clear-row"},le=["src","alt"],re={class:"trip-title"},oe={class:"trip-provider"},ne={class:"chip-row"},ce={class:"trip-meta"},de={class:"trip-meta"};e("default",M(i({__name:"TripListView",setup(e){const t=a(!0),i=a(""),M=a(!1),se=a([]),ue=a("recent"),{t:pe}=l(),ve=r(()=>"views"===ue.value?pe("trip.sortViews"):pe("trip.sortRecent")),_e=a([{id:1,name:"trip.catCity",emoji:"ğŸ™ï¸"},{id:2,name:"trip.catNature",emoji:"ğŸŒ¿"},{id:3,name:"trip.catFamily",emoji:"ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦"}]),ge=a([]),fe=a([]),me=a(!0),he=a([]),xe=r(()=>{const e=he.value.filter(e=>{var t;const a=e.title.toLowerCase().includes(i.value.toLowerCase()),l=0===se.value.length||e.categories.some(e=>_e.value.filter(e=>se.value.includes(e.id)).map(e=>e.name).includes(e)),r=0===fe.value.length||(null===(t=e.trip_cities)||void 0===t?void 0:t.some(e=>fe.value.includes(e.cities.slug)));return a&&l&&r});return"views"===ue.value?[...e].sort((e,t)=>{var i,a;return(null!==(i=t.view_count)&&void 0!==i?i:0)-(null!==(a=e.view_count)&&void 0!==a?a:0)}):[...e].sort((e,t)=>{var i,a;return new Date(null!==(i=t.created_at)&&void 0!==i?i:"").getTime()-new Date(null!==(a=e.created_at)&&void 0!==a?a:"").getTime()})});function clearFilters(){c.log("trip_filter_clear",{categories:se.value,cities:fe.value}),se.value=[],fe.value=[]}let ye=null;function handleSearchInput(e){const t=e.target.value.trim();i.value=t,ye&&clearTimeout(ye),t.length>1&&(ye=window.setTimeout(()=>{c.log("trip_search",{query:t})},800))}return o(ue,e=>{c.log("trip_sort_change",{sort_by:e})}),n(()=>{c.log("trip_page_open",{source:"main_navigation"}),async function fetchTrips(){t.value=!0;const{data:e,error:i}=await p.from("trips").select("\n        id,\n        title,\n        title_zh,\n        duration,\n        cover_url,\n        external_url,\n        created_at,\n        view_count,\n        provider:partners (\n          id,\n          name,\n          partner_tier\n        ),\n        trip_cities (\n          city_id,\n          cities:city_id (\n            id,\n            slug,\n            name,\n            name_zh,\n            emoji\n          )\n        )\n      ").eq("is_active",!0);if(i)return console.error("[Trips]",i),void(t.value=!1);he.value=(null!=e?e:[]).map(e=>({id:e.id,title:e.title,title_zh:e.title_zh,cover:e.cover_url,duration:e.duration,categories:[],external_url:e.external_url,provider:Array.isArray(e.provider)?e.provider[0]:e.provider,created_at:e.created_at,view_count:e.view_count,trip_cities:e.trip_cities||[]})),t.value=!1}(),async function fetchCities(){me.value=!0;const{data:e,error:t}=await p.from("cities").select("id, slug, name, name_zh, emoji").order("sort_order",{ascending:!0});!t&&e&&(ge.value=e),me.value=!1}()}),(e,a)=>(v(),d(u(K),null,{default:s(()=>[_(u(g),null,{default:s(()=>[_(f,{title:e.$t("trip.title"),icon:u(m),showProfile:!0},null,8,["title","icon"]),_(u(h),{class:"toolbar-search"},{default:s(()=>[_(u(x),{modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=e=>i.value=e),placeholder:e.$t("trip.searchPlaceholder"),debounce:500,class:"rounded",onIonInput:handleSearchInput},null,8,["modelValue","placeholder"])]),_:1}),_(u(h),{class:"search-toolbar"},{default:s(()=>[y("div",X,[_(u(w),{fill:"clear",size:"small",class:"sort-button"},{default:s(()=>[_(u(b),{class:"toolbar-label ion-padding-horizontal"},{default:s(()=>[k(z(ve.value),1)]),_:1}),_(u(C),{icon:u($)},null,8,["icon"]),_(u(j),{modelValue:ue.value,"onUpdate:modelValue":a[1]||(a[1]=e=>ue.value=e),interface:"popover",class:"hidden-select","interface-options":{cssClass:"sort-popover"}},{default:s(()=>[_(u(T),{value:"recent"},{default:s(()=>[k(z(e.$t("trip.sortRecent")),1)]),_:1}),_(u(T),{value:"views"},{default:s(()=>[k(z(e.$t("trip.sortViews")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1}),_(u(w),{fill:"clear",size:"small",onClick:a[2]||(a[2]=e=>M.value=!M.value)},{default:s(()=>[_(u(b),{class:"toolbar-label ion-padding-horizontal"},{default:s(()=>[_(u(C),{icon:u(V),class:"icon-inline"},null,8,["icon"]),k(" "+z(e.$t("common.filters")),1)]),_:1}),_(u(C),{icon:M.value?u(F):u($)},null,8,["icon"])]),_:1})]),_(q,{name:"collapse"},{default:s(()=>[I(y("div",Y,[y("div",Z,[_(u(C),{icon:u(P)},null,8,["icon"]),k(" "+z(e.$t("trip.categories")),1)]),y("div",ee,[(v(!0),S(A,null,D(_e.value,t=>(v(),d(u(N),{key:t.id,class:O(["category-chip",{active:se.value.includes(t.id)}]),onClick:e=>function toggleCategory(e){const t=se.value.indexOf(e);-1===t?(se.value.push(e),c.log("trip_filter_category_add",{category_id:e})):(se.value.splice(t,1),c.log("trip_filter_category_remove",{category_id:e}))}(t.id)},{default:s(()=>[_(u(B),null,{default:s(()=>[k(z(t.emoji)+" "+z(e.$t(t.name)),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),y("div",te,[_(u(C),{icon:u(R)},null,8,["icon"]),k(" "+z(e.$t("trip.cities")),1)]),y("div",ie,[(v(!0),S(A,null,D(ge.value,t=>(v(),d(u(N),{key:t.slug,class:O(["category-chip",{active:fe.value.includes(t.slug)}]),onClick:e=>function toggleCity(e){const t=fe.value.indexOf(e);-1===t?(fe.value.push(e),c.log("trip_filter_city_add",{city_slug:e})):(fe.value.splice(t,1),c.log("trip_filter_city_remove",{city_slug:e}))}(t.slug)},{default:s(()=>[_(u(B),null,{default:s(()=>[k(z(t.emoji)+" "+z("zh-tw"===e.$i18n.locale?t.name_zh:t.name),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),se.value.length||fe.value.length?(v(),S("div",ae,[_(u(N),{class:"clear-chip",onClick:clearFilters},{default:s(()=>[k(" âœ• "+z(e.$t("common.clearFilters")),1)]),_:1})])):L("",!0)],512),[[U,M.value]])]),_:1})]),_:1})]),_:1}),_(u(E),{class:"ion-padding"},{default:s(()=>[t.value?(v(),S(A,{key:0},D(4,e=>_(u(H),{key:"skeleton-"+e},{default:s(()=>[_(u(J),{animated:"",style:{width:"100%",height:"140px","border-radius":"12px"}}),_(u(J),{animated:"",style:{width:"70%",height:"16px",margin:"10px"}})]),_:2},1024)),64)):0===xe.value.length?(v(),d(u(H),{key:1},{default:s(()=>[_(u(W),null,{default:s(()=>[k(" ğŸ§­ "+z(e.$t("trip.noTripsFound")),1)]),_:1})]),_:1})):(v(!0),S(A,{key:2},D(xe.value,t=>(v(),d(u(H),{key:t.id,class:"trip-card",onClick:e=>async function openTrip(e){var t,a,l;c.log("trip_click",{trip_id:e.id,trip_title:e.title,provider_id:null===(t=e.provider)||void 0===t?void 0:t.id,provider_name:null===(a=e.provider)||void 0===a?void 0:a.name,provider_tier:null===(l=e.provider)||void 0===l?void 0:l.partner_tier,current_sort:ue.value,active_categories:se.value,active_cities:fe.value,search_query:i.value||null}),await p.rpc("increment_trip_view",{p_trip_id:e.id}),await Q.open({url:e.external_url,windowName:"_self",toolbarColor:"#e67e22",presentationStyle:"fullscreen"})}(t)},{default:s(()=>{var i;return["gold"===(null===(i=t.provider)||void 0===i?void 0:i.partner_tier)?(v(),d(u(G),{key:0,color:"warning",class:"partner-badge"},{default:s(()=>[k(z(e.$t("partner.goldPartner")),1)]),_:1})):L("",!0),y("img",{src:t.cover,alt:t.title,class:"trip-cover"},null,8,le),_(u(W),null,{default:s(()=>{var i,a,l;return[y("h3",re,z("zh-tw"===e.$i18n.locale&&t.title_zh||t.title),1),y("p",oe,[k(z(e.$t("trip.providedBy"))+" ",1),y("strong",null,z(null===(i=t.provider)||void 0===i?void 0:i.name),1)]),y("div",ne,[(v(!0),S(A,null,D(t.categories,e=>(v(),d(u(N),{key:e,color:"primary"},{default:s(()=>[k(z(e),1)]),_:2},1024))),128))]),y("p",ce," ğŸ“ "+z((null!==(a=t.trip_cities)&&void 0!==a?a:[]).filter(e=>e.cities).map(t=>"zh-tw"===e.$i18n.locale?t.cities.name_zh:t.cities.name).join(" + "))+" Â· ğŸ•’ "+z(t.duration),1),y("p",de," ğŸ‘ï¸ "+z(null!==(l=t.view_count)&&void 0!==l?l:0)+" "+z(e.$t("common.views")),1)]}),_:2},1024)]}),_:2},1032,["onClick"]))),128))]),_:1})]),_:1}))}}),[["__scopeId","data-v-4e4d552e"]]))}}});
