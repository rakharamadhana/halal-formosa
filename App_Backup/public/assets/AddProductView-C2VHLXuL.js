import{d as e,bO as a,r as t,bP as l,a7 as r,o,s as i,bQ as d,bR as n,c as u,w as s,u as c,b as p,e as v,O as m,ad as g,bd as f,S as _,i as h,V as b,P as y,Q as k,p as w,t as P,R as V,F as C,j as S,k as N,bS as I,ba as E,aS as B,bT as D,aj as A,L as U,by as $,ao as x,l as F,K as L,bU as q,bV as H,Z as R,aK as M,bh as j,bW as O,n as T,ah as z,aq as G,H as K,J as Q,ar as W,a9 as X,b5 as Y,bz as Z,bA as J,bX as ee,bY as ae,U as te,bZ as le,b_ as re,bL as oe,bC as ie,y as de,bN as ne,bD as ue,b$ as se,bE as ce,bF as pe,c0 as ve,c1 as me,c2 as ge,c3 as fe,c4 as _e,c5 as he,c6 as be,ac as ye,c7 as ke,bH as we,c8 as Pe,am as Ve,a8 as Ce,_ as Se}from"./index-D9IhqqAc.js";import{H as Html5QrcodeSupportedFormats,b as Html5Qrcode}from"./html5-qrcode-D_4nuB1t.js";import{u as Ne}from"./useNotifier-BmoHZOF2.js";class BarcodeValidator{static calculateEANCheckDigit(e){const a=e.split("").map(Number);let t=0;for(let r=a.length-1,o=1;r>=0;r--,o++)t+=a[r]*(o%2==1?3:1);const l=t%10;return 0===l?0:10-l}static validateEANCheckDigit(e,a){if(!/^\d+$/.test(e))return!1;if(e.length!==a)return!1;return this.calculateEANCheckDigit(e.slice(0,-1))===Number(e.slice(-1))}static calculateLuhnCheckDigit(e){const a=e.split("").map(Number).reverse();let t=0;for(let l=0;l<a.length;l++){let e=a[l];l%2==0&&(e*=2,e>9&&(e-=9)),t+=e}return(10-t%10)%10}static validateLuhnCheckDigit(e,a){if(!/^\d+$/.test(e))return!1;if(e.length!==a)return!1;return this.calculateLuhnCheckDigit(e.slice(0,-1))===Number(e.slice(-1))}static calculateISBNCheckDigit(e){if(13===e.length)return this.calculateEANCheckDigit(e);{let a=0;for(let l=0;l<9;l++)a+=(10-l)*Number(e[l]);const t=(11-a%11)%11;return 10===t?"X":t}}static validateISBN10(e){if(!/^\d{9}(\d|X)$/.test(e))return!1;const a=this.calculateISBNCheckDigit(e.slice(0,-1)),t=e.slice(-1);return String(a)===t}static isValidEAN8(e){return this.validateEANCheckDigit(e,8)}static isValidEAN13(e){return this.validateEANCheckDigit(e,13)}static isValidEAN14(e){return this.validateEANCheckDigit(e,14)}static isValidUPCA(e){return this.validateEANCheckDigit(e,12)}static isValidUPCE(e){return/^\d{6,8}$/.test(e)}static isValidISBN(e){const a=e.replace(/-/g,"");return 10===a.length?this.validateISBN10(a):13===a.length&&this.validateEANCheckDigit(a,13)}static isValidIMEI(e){return!!/^\d+$/.test(e)&&(14===e.length||16===e.length||15===e.length&&this.validateLuhnCheckDigit(e,15))}static isValidGSIN(e){return this.validateEANCheckDigit(e,17)}static isValidSSCC(e){return this.validateEANCheckDigit(e,18)}static isValidGLN(e){return this.validateEANCheckDigit(e,13)}static isValidASIN(e){return/^B\d{2}\w{7}$/.test(e)||/^\d{9}(\d|X)$/.test(e)}}const Ie={key:0,class:"ion-text-center ion-padding"},Ee={class:"form-container"},Be={slot:"label"},De={key:2,class:"ion-padding"},Ae={key:3,id:"reader"},Ue={slot:"label"},$e={slot:"label"},xe={slot:"label"},Fe={slot:"label"},Le={slot:"content"},qe={key:7,class:"ion-padding-horizontal ion-margin-top"},He={key:0,class:"ion-margin-top"},Re={key:0,class:"ion-padding-top"},Me={slot:"label"},je={class:"quick-scroll-container ion-margin-horizontal"},Oe={key:8,style:{padding:"0 16px 16px"}},Te=["src"],ze={key:9,style:{padding:"0 16px 16px"}},Ge=["src"],Ke=!1,Qe=Se(e({__name:"AddProductView",props:{editProduct:{}},emits:["updated","close"],setup(e,{emit:Se}){const{notifyEvent:Qe}=Ne(),{awardAndCelebrate:We}=Ve(),{errorMsg:Xe,setError:Ye}=a(),Ze=t([]),Je=t(!1),{resizeImage:ea}=ke(),aa=t(null),ta=t(!1),la="Halal certified by ",ra="Muslim-friendly ingredients, OK.",oa="Syubhah ingredients found.",ia="Haram ingredients found.",da={Halal:"success","Muslim-friendly":"primary",Syubhah:"warning",Haram:"danger"};const na=e,{allHighlights:ua,blacklistPatterns:sa,fetchHighlightsWithCache:ca,incrementUsageCount:pa}=d(),{cropperRef:va,cropperSrc:ma,showCropper:ga,croppedPreviewUrl:fa,ocrLoading:_a,openCropper:ha,confirmCrop:ba,closeCropper:ya,ingredientHighlights:ka,ingredientsText:wa,autoStatus:Pa,productName:Va,recheckHighlightsSmart:Ca}=l({allHighlights:ua,blacklistPatterns:sa,fetchHighlightsWithCache:ca,incrementUsageCount:pa,setError:Ye,setBackFile:e=>{$a.value=e,Fa.value&&URL.revokeObjectURL(Fa.value),Fa.value=URL.createObjectURL(e)}}),Sa=t(null);r([Pa,Va,wa],([e,a,t])=>{e&&(Na.value.status=e),a&&!Na.value.name.trim()&&(Na.value.name=a),t&&(Na.value.ingredients=t)}),o(async()=>{var e,a,t,l,r;const[o,d]=await Promise.all([i.from("ingredient_highlights").select("keyword, keyword_zh, color"),i.from("ingredient_blacklist").select("pattern").eq("is_active",!0)]);if(!o.error&&o.data&&(ua.value=o.data),!d.error&&d.data&&(sa.value=d.data.map(e=>new RegExp(e.pattern,"i"))),na.editProduct){Na.value={barcode:na.editProduct.barcode,name:na.editProduct.name,status:na.editProduct.status,product_category_id:null!=(e=na.editProduct.product_category_id)?e:null,ingredients:null!=(a=na.editProduct.ingredients)?a:"",description:null!=(t=na.editProduct.description)?t:"",store_ids:[]},xa.value=null!=(l=na.editProduct.photo_front_url)?l:null,Fa.value=null!=(r=na.editProduct.photo_back_url)?r:null;const{data:o}=await i.from("product_stores").select("store_id").eq("product_id",na.editProduct.id);o&&(Na.value.store_ids=o.map(e=>e.store_id))}await(async()=>{const{data:e,error:a}=await i.from("stores").select("id, name, logo_url, sort_order").order("sort_order",{ascending:!0});!a&&e&&(Ze.value=e.map(e=>({...e,id:String(e.id)})))})(),await ca(!0),await fetchCategoryRules(),await fetchCategories()});const Na=t({barcode:"",name:"",status:"Muslim-friendly",product_category_id:null,ingredients:"",description:"",store_ids:[]}),Ia=t({}),Ea={Halal:"Halal certified.","Muslim-friendly":"Muslim-friendly ingredients, OK.",Syubhah:"Syubhah ingredients found.",Haram:"Haram ingredients found."};r(()=>Na.value.description,(e,a)=>{!Aa.value&&e!==a&&Ta.value&&(Da.value=!0)}),r([Pa,Va,wa],([e,a])=>{var t,l;if(e&&(Na.value.status=e,Ba.value=!0,console.log("âš¡ AutoStatus applied:",e),Ta.value=!0,(null==(t=Na.value.description)?void 0:t.trim())||(Na.value.description=null!=(l=Ea[e])?l:"")),a&&!Na.value.name.trim()&&(Na.value.name=a,console.log("ðŸ· AutoProductName applied:",a)),Na.value.name&&!Na.value.product_category_id){const e=Na.value.name.toLowerCase();for(const a in Ia.value)if(e.includes(a)){Na.value.product_category_id=Ia.value[a],console.log('ðŸ“‚ AutoCategory applied: "'.concat(Na.value.product_category_id,'" (matched "').concat(a,'")'));break}}}),r(()=>Na.value.status,e=>{var a;e&&(za.value||Ta.value&&(Da.value||(Aa.value=!0,Na.value.description=null!=(a=Ea[e])?a:"",ye(()=>{Aa.value=!1}))))}),r(()=>Na.value.barcode,async e=>{if(!e)return Ka.value=null,Qa.value="",void(Sa.value=null);const a=validateBarcode(e);if(!a.isValid)return Ka.value=!1,void(Qa.value=a.message);if(!na.editProduct){const a=await async function checkBarcodeExists(e){const{data:a}=await i.from("products").select("id, name, status, photo_front_url").eq("barcode",e).maybeSingle();return a||null}(e);if(a)return Ka.value=!1,Qa.value="âš ï¸ Product already exists",void(Sa.value={id:a.id,name:a.name,status:a.status,photo_front_url:a.photo_front_url});Sa.value=null}Ka.value=!0,Qa.value=a.message});const Ba=t(!1),Da=t(!1),Aa=t(!1),Ua=t(null),$a=t(null),xa=t(null),Fa=t(null),La=t(!1),qa=t(!1),Ha=t(!1),Ra=t(!1),Ma=t(""),ja=t(!1),Oa=t(""),Ta=t(!1),za=t(!1),Ga=t(null),Ka=t(null),Qa=t(""),Wa=t(null),Xa=t([]),Ya=Se;function onProductNameInput(e){const a=e.target;console.log("âœï¸ Product name typed:",a.value)}function handleIngredientsInput(e){const a=e.target;console.log("ðŸ¥¬ Ingredients input:",a.value)}async function recheckHighlights(){Je.value=!0;try{await Ca()}finally{Je.value=!1}}function handleBack(){na.editProduct?Ya("close"):window.history.length>1?ne.back():ne.push("/search")}const fetchCategories=async()=>{const{data:e,error:a}=await i.from("product_categories").select("id, name").order("name");!a&&e&&(Xa.value=e)},fetchCategoryRules=async()=>{const{data:e,error:a}=await i.from("category_rules").select("keyword, category_id");!a&&e&&(Ia.value=e.reduce((e,a)=>(e[a.keyword.toLowerCase()]=a.category_id,e),{}))};function applyQuickDescription(e){Na.value.description=e}async function scanIngredientsWithCamera(){const e=await ue.getPhoto({quality:90,allowEditing:!1,resultType:pe.Uri,source:ce.Camera,direction:se.Rear}),a=await fetch(e.webPath).then(e=>e.blob()),t=new File([a],"ingredients-".concat(Date.now(),".jpg"),{type:"image/jpeg"});Ga.value=t,ha(t)}function scanIngredientsFromGallery(){const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{const a=e.target;a.files&&a.files[0]&&(Ga.value=a.files[0],ha(a.files[0]))},e.click()}const Za=t([]),Ja=t(null);async function startBarcodeScan(){if(ja.value)return Wa.value&&(await Wa.value.stop(),document.getElementById("reader").innerHTML="",Wa.value=null),void(ja.value=!1);ja.value=!0;try{if(X.isNativePlatform()){const e=await ge.scanBarcode({hint:be.ALL,scanInstructions:"Align the barcode within the frame",cameraDirection:he.BACK,scanOrientation:_e.ADAPTIVE,android:{scanningLibrary:fe.MLKIT}});(null==e?void 0:e.ScanResult)&&(await ve.impact({style:me.Medium}),Na.value.barcode=e.ScanResult),ja.value=!1}else{await ye();if(!document.getElementById("reader"))return console.error("âŒ #reader container not found"),void(ja.value=!1);const e=new Html5Qrcode("reader",{verbose:!1});Wa.value=e;const a={fps:15,qrbox:{width:300,height:150},formatsToSupport:[Html5QrcodeSupportedFormats.EAN_13,Html5QrcodeSupportedFormats.EAN_8,Html5QrcodeSupportedFormats.UPC_A,Html5QrcodeSupportedFormats.UPC_E]},t=await Html5Qrcode.getCameras();if(!t||!t.length)return console.error("âŒ No cameras found"),void(ja.value=!1);const l=t.find(e=>/back|rear|environment/i.test(e.label)),r=l?l.id:t[0].id;if(await async function loadCameras(){var e;try{const a=await Html5Qrcode.getCameras();Za.value=a.map(e=>({id:e.id,label:e.label||"Camera ".concat(e.id)}));const t=a.find(e=>/back|rear|environment/i.test(e.label));Ja.value=t?t.id:(null==(e=a[0])?void 0:e.id)||null}catch(a){console.error("âŒ Failed to get cameras:",a)}}(),!Ja.value)return console.error("âŒ No camera available"),void(ja.value=!1);await e.start(r,a,async a=>{console.log("âœ… Web barcode detected:",a),await ve.impact({style:me.Medium}),Na.value.barcode=a,Ta.value=!0,await ye(),aa.value&&(aa.value.$el.value=a),await e.stop(),document.getElementById("reader").innerHTML="",Wa.value=null,ja.value=!1},e=>{console.log(e)})}}catch(e){console.error("âŒ Barcode scan failed:",e),ja.value=!1}}async function takeFrontPicture(){try{const e=await ue.getPhoto({quality:90,allowEditing:!1,resultType:pe.Uri,source:ce.Camera,direction:se.Rear});Ke,xa.value=e.webPath||null,Ua.value=await ea(e.webPath||"")}catch(e){console.error("Error taking front photo:",e),Ye("âŒ Failed to capture front image.")}}async function takeBackPicture(){try{const e=await ue.getPhoto({quality:90,allowEditing:!1,resultType:pe.Uri,source:ce.Camera,direction:se.Rear});Ke,Fa.value=e.webPath||null,$a.value=await ea(e.webPath||"")}catch(e){console.error("Error taking back photo:",e),Ye("âŒ Failed to capture back image.")}}function uploadFrontFromGallery(){const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{const a=e.target;if(a.files&&a.files[0]){const e=a.files[0],t=new FileReader;t.onload=async()=>{xa.value=t.result,Ua.value=await ea(t.result)},t.readAsDataURL(e)}},e.click()}function uploadBackFromGallery(){const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{const a=e.target;if(a.files&&a.files[0]){const e=a.files[0],t=new FileReader;t.onload=async()=>{Fa.value=t.result,$a.value=await ea(t.result)},t.readAsDataURL(e)}},e.click()}function validateBarcode(e){const a=e.replace(/-/g,"");return BarcodeValidator.isValidEAN8(a)||BarcodeValidator.isValidEAN13(a)||BarcodeValidator.isValidEAN14(a)||BarcodeValidator.isValidUPCA(a)||BarcodeValidator.isValidUPCE(a)||BarcodeValidator.isValidISBN(a)||BarcodeValidator.isValidIMEI(a)||BarcodeValidator.isValidGSIN(a)||BarcodeValidator.isValidSSCC(a)||BarcodeValidator.isValidGLN(a)||BarcodeValidator.isValidASIN(a)?{isValid:!0,message:"âœ… Valid barcode"}:{isValid:!1,message:"âŒ Invalid barcode"}}async function saveProductStores(e,a,t){try{if(a.length>0){const l=a.map(a=>({product_id:e,store_id:a,added_by:t})),{error:r}=await i.from("product_stores").upsert(l,{onConflict:"product_id,store_id"});if(r)throw r;const{error:o}=await i.from("product_stores").delete().eq("product_id",e).not("store_id","in","(".concat(a.join(","),")"));if(o)throw o}else await i.from("product_stores").delete().eq("product_id",e);console.log("âœ… Stores synced safely:",a)}catch(l){throw console.error("âŒ Failed to save product_stores:",l),l}}async function handleSubmit(){var e,a;const t=["admin","contributor"].includes(we.value||"user");La.value=!0,Xe.value="",Ra.value=!1;try{const{data:{user:l}}=await i.auth.getUser();if(!l)return Ye("You must be logged in to submit a product."),void(La.value=!1);const{data:r}=await i.from("user_roles").select("role").eq("user_id",l.id).single();Pe(l.id,(null==r?void 0:r.role)||"user");const{barcode:o}=Na.value,d=validateBarcode(Na.value.barcode);if(!d.isValid)return Ye(d.message),void(La.value=!1);if(!Na.value.name.trim())return Ye("Product name is required.");if(!Na.value.status)return Ye("Product status is required.");if(!Na.value.ingredients.trim())return Ye("Ingredients are required.");if(!Na.value.product_category_id)return Ye("Product category is required.");if(!Na.value.description.trim())return Ye("Description is required.");if(!na.editProduct&&!Ua.value)return Ye("Front image is required.");if(!na.editProduct&&!$a.value)return Ye("Back image is required.");const{store_ids:n,...u}=Na.value;let s=(null==(e=na.editProduct)?void 0:e.photo_front_url)||"",c=(null==(a=na.editProduct)?void 0:a.photo_back_url)||"";if(Ua.value){const{error:e}=await i.storage.from("product-images").upload("".concat(o,"/front.jpg"),Ua.value,{upsert:!0});if(e)return console.log(e),void Ye("âŒ Failed to upload front image.");const{data:a}=i.storage.from("product-images").getPublicUrl("".concat(o,"/front.jpg"));s=a.publicUrl,console.log("Front image uploaded:",s)}if($a.value){const{error:e}=await i.storage.from("product-images").upload("".concat(o,"/back.jpg"),$a.value,{upsert:!0});if(e)return console.log(e),void Ye("âŒ Failed to upload back image.");const{data:a}=i.storage.from("product-images").getPublicUrl("".concat(o,"/back.jpg"));c=a.publicUrl,console.log("Back image uploaded:",c)}if(na.editProduct)await i.from("products").update({...u,photo_front_url:s,photo_back_url:c,updated_at:(new Date).toISOString(),updated_by:l.id,approved:!!t||na.editProduct.approved,approved_by:t?l.id:na.editProduct.approved_by,approved_at:t?(new Date).toISOString():na.editProduct.approved_at}).eq("id",na.editProduct.id),await saveProductStores(na.editProduct.id,n,l.id),Ma.value="âœ… Product updated successfully!",await Qe("update_product","âœï¸ Product Updated","".concat(Na.value.name," (").concat(Na.value.status,")\nBarcode: ").concat(Na.value.barcode),s||c,{barcode:Na.value.barcode,status:Na.value.status,isNative:!0}),Ya("updated");else{const{data:e,error:a}=await i.from("products").insert([{...u,barcode:o,photo_front_url:s,photo_back_url:c,added_by:l.id,approved:t,approved_by:t?l.id:null,approved_at:t?(new Date).toISOString():null,created_at:(new Date).toISOString()}]).select("id").single();if(a||!e)throw a||new Error("âŒ Failed to create product, no data returned");await saveProductStores(e.id,n,l.id),Ma.value=t?"âœ… Product published successfully!":"âœ… Product submitted and awaiting approval.",t&&await Qe("new_product","ðŸ†• New Product Published!","".concat(Na.value.name," (").concat(Na.value.status,")\nBarcode: ").concat(Na.value.barcode),s||c,{barcode:Na.value.barcode,status:Na.value.status,isNative:!0}),Na.value={barcode:"",name:"",status:"Muslim-friendly",product_category_id:null,ingredients:"",description:"",store_ids:[]},Ua.value=null,$a.value=null,xa.value=null,Fa.value=null,ka.value=[],Ka.value=null,Qa.value="",await We("add_product",1e4),await Ce.log("add_product_success",{barcode:o,name:Na.value.name,status:Na.value.status})}qa.value=!0}catch(l){console.error("Submission error:",l),Ye(l.message||"An unexpected error occurred.")}finally{La.value=!1}}return n(()=>{ma.value&&URL.revokeObjectURL(ma.value),fa.value&&URL.revokeObjectURL(fa.value)}),(e,a)=>(p(),u(c(de),null,{default:s(()=>[v(c(m),null,{default:s(()=>[v(g,{title:na.editProduct?e.$t("addProduct.editTitle"):e.$t("addProduct.title"),icon:c(f),showProfile:!0,"show-back":"",useRouterBack:!1,onBack:handleBack},null,8,["title","icon"])]),_:1}),v(c(_),{class:"ion-padding"},{default:s(()=>[v(c(b),{"is-open":c(ga),onDidDismiss:c(ya)},{default:s(()=>[v(c(m),null,{default:s(()=>[v(c(y),null,{default:s(()=>[v(c(k),null,{default:s(()=>[w(P(e.$t("addProduct.cropIngredients")),1)]),_:1}),v(c(V),{slot:"end"},{default:s(()=>[v(c(C),{onClick:c(ba)},{default:s(()=>[w(P(e.$t("addProduct.done")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),v(c(_),null,{default:s(()=>[v(c(I),{ref_key:"cropperRef",ref:va,class:"cropper",src:c(ma),"stencil-props":{aspectRatio:null}},null,8,["src"]),c(_a)?(p(),S("div",Ie,[v(c(E),{name:"crescent",color:"primary"}),h("p",null,P(e.$t("addProduct.processingOcr")),1)])):N("",!0)]),_:1})]),_:1},8,["is-open","onDidDismiss"]),h("form",{onSubmit:B(handleSubmit,["prevent"])},[h("div",Ee,[v(c(D),null,{default:s(()=>[v(c(A),{class:U({"barcode-valid":!0===Ka.value,"barcode-invalid":!1===Ka.value})},{default:s(()=>[v(c($),{ref_key:"barcodeInput",ref:aa,modelValue:Na.value.barcode,"onUpdate:modelValue":a[0]||(a[0]=e=>Na.value.barcode=e),required:"",type:"tel",inputmode:"numeric",pattern:"[0-9]*",maxlength:14,minlength:8,"clear-input":"","label-placement":"floating",placeholder:e.$t("addProduct.barcodePlaceholder")},{default:s(()=>[h("div",Be,[w(P(e.$t("addProduct.barcode"))+" ",1),v(c(x),{color:"danger"},{default:s(()=>a[18]||(a[18]=[w("*",-1)])),_:1,__:[18]})])]),_:1},8,["modelValue","placeholder"]),null!==Ka.value?(p(),u(c(F),{key:0,icon:Ka.value?c(L):c(q),color:Ka.value?"success":"danger",slot:"end",style:{"font-size":"20px"}},null,8,["icon","color"])):N("",!0),v(c(C),{color:"carrot",slot:"end",size:"default",onClick:startBarcodeScan},{default:s(()=>[v(c(F),{icon:ja.value?c(H):c(R)},null,8,["icon"])]),_:1})]),_:1},8,["class"]),Qa.value?(p(),u(c(M),{key:0,color:Ka.value?"success":"danger",class:"ion-padding-start"},{default:s(()=>[w(P(Qa.value),1)]),_:1},8,["color"])):N("",!0),Sa.value?(p(),u(c(A),{key:1,lines:"none",class:"detected-product"},{default:s(()=>[v(c(j),{slot:"start"},{default:s(()=>[v(c(O),{src:Sa.value.photo_front_url||"/placeholder-product.png"},null,8,["src"])]),_:1}),v(c(T),null,{default:s(()=>{return[h("h3",null,P(Sa.value.name),1),v(c(z),{size:"small",class:U("chip-".concat((e=Sa.value.status,null!=(a=da[null!=e?e:""])?a:"medium")))},{default:s(()=>[w(P(Sa.value.status),1)]),_:1},8,["class"])];var e,a}),_:1})]),_:1})):N("",!0),ja.value&&Za.value.length>1?(p(),S("div",De,[v(c(A),null,{default:s(()=>[v(c(T),null,{default:s(()=>a[19]||(a[19]=[w("Camera",-1)])),_:1,__:[19]}),v(c(G),{modelValue:Ja.value,"onUpdate:modelValue":a[1]||(a[1]=e=>Ja.value=e),onIonChange:a[2]||(a[2]=e=>async function switchCamera(e){if(Wa.value)try{await Wa.value.stop(),document.getElementById("reader").innerHTML="";const a={fps:15,qrbox:{width:300,height:150},formatsToSupport:[Html5QrcodeSupportedFormats.EAN_13,Html5QrcodeSupportedFormats.EAN_8,Html5QrcodeSupportedFormats.UPC_A,Html5QrcodeSupportedFormats.UPC_E]};await Wa.value.start(e,a,async e=>{var a;console.log("âœ… Web barcode detected:",e),Na.value.barcode=e,Ta.value=!0,await ve.impact({style:me.Medium}),await(null==(a=Wa.value)?void 0:a.stop()),document.getElementById("reader").innerHTML="",Wa.value=null,ja.value=!1},e=>{console.log("ðŸ“¡ Scan error:",e)}),Ja.value=e}catch(a){console.error("âŒ Failed to switch camera:",a)}}(e.detail.value))},{default:s(()=>[(p(!0),S(K,null,Q(Za.value,e=>(p(),u(c(W),{key:e.id,value:e.id},{default:s(()=>[w(P(e.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})])):N("",!0),ja.value&&!c(X).isNativePlatform()?(p(),S("div",Ae)):N("",!0),v(c(A),null,{default:s(()=>[v(c($),{modelValue:Na.value.name,"onUpdate:modelValue":a[3]||(a[3]=e=>Na.value.name=e),required:"","clear-input":"","label-placement":"floating",placeholder:e.$t("addProduct.productNamePlaceholder"),onInput:onProductNameInput},{default:s(()=>[h("div",Ue,[w(P(e.$t("addProduct.productName"))+" ",1),v(c(x),{color:"danger"},{default:s(()=>a[20]||(a[20]=[w("*",-1)])),_:1,__:[20]})])]),_:1},8,["modelValue","placeholder"])]),_:1}),v(c(A),null,{default:s(()=>[v(c(G),{modelValue:Na.value.status,"onUpdate:modelValue":a[4]||(a[4]=e=>Na.value.status=e),interface:"popover",required:""},{default:s(()=>[h("div",$e,[w(P(e.$t("addProduct.status"))+" ",1),v(c(x),{color:"danger"},{default:s(()=>a[21]||(a[21]=[w("*",-1)])),_:1,__:[21]})]),v(c(W),{value:"Halal"},{default:s(()=>[w(P(e.$t("addProduct.halal")),1)]),_:1}),v(c(W),{value:"Muslim-friendly"},{default:s(()=>[w(P(e.$t("addProduct.muslimFriendly")),1)]),_:1}),v(c(W),{value:"Syubhah"},{default:s(()=>[w(P(e.$t("addProduct.syubhah")),1)]),_:1}),v(c(W),{value:"Haram"},{default:s(()=>[w(P(e.$t("addProduct.haram")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1}),v(c(A),null,{default:s(()=>[v(c(G),{modelValue:Na.value.product_category_id,"onUpdate:modelValue":a[5]||(a[5]=e=>Na.value.product_category_id=e),modelModifiers:{number:!0},interface:"popover",required:""},{default:s(()=>[h("div",xe,[w(P(e.$t("addProduct.category"))+" ",1),v(c(x),{color:"danger"},{default:s(()=>a[22]||(a[22]=[w("*",-1)])),_:1,__:[22]})]),(p(!0),S(K,null,Q(Xa.value,e=>(p(),u(c(W),{key:e.id,value:e.id},{default:s(()=>[w(P(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),v(c(A),null,{default:s(()=>[v(c(Y),{modelValue:Na.value.ingredients,"onUpdate:modelValue":a[6]||(a[6]=e=>Na.value.ingredients=e),"label-placement":"floating",placeholder:e.$t("addProduct.ingredientsPlaceholder"),"auto-grow":!0,onInput:handleIngredientsInput,onBlur:recheckHighlights,required:""},{default:s(()=>[h("div",Fe,[w(P(e.$t("addProduct.ingredients"))+" ",1),v(c(x),{color:"danger"},{default:s(()=>a[23]||(a[23]=[w("*",-1)])),_:1,__:[23]})])]),_:1},8,["modelValue","placeholder"]),v(c(V),{slot:"end"},{default:s(()=>[v(c(C),{onClick:scanIngredientsWithCamera,disabled:c(_a)},{default:s(()=>[v(c(F),{icon:c(Z)},null,8,["icon"])]),_:1},8,["disabled"]),v(c(C),{onClick:scanIngredientsFromGallery,disabled:c(_a)},{default:s(()=>[v(c(F),{icon:c(J)},null,8,["icon"])]),_:1},8,["disabled"])]),_:1})]),_:1}),Oa.value?(p(),u(c(ee),{key:4,class:"ion-margin-top ion-margin-horizontal"},{default:s(()=>[v(c(ae),{value:"rawOcr"},{default:s(()=>[v(c(A),{slot:"header",style:{"background-color":"transparent"}},{default:s(()=>[v(c(T),null,{default:s(()=>[w(P(e.$t("addProduct.detectedText")),1)]),_:1})]),_:1}),h("div",Le,[v(c(Y),{modelValue:Oa.value,"onUpdate:modelValue":a[7]||(a[7]=e=>Oa.value=e),readonly:"",style:{width:"100%",background:"var(--ion-background-color-step-50)","border-bottom-left-radius":"8px","border-bottom-right-radius":"8px",padding:"8px","--padding":"8px","min-height":"100px"}},null,8,["modelValue"])])]),_:1})]),_:1})):N("",!0),c(_a)?(p(),u(c(te),{key:5,type:"indeterminate",color:"primary",style:{"margin-top":"10px"}})):N("",!0),Je.value?(p(),u(c(te),{key:6,type:"indeterminate",color:"primary"})):N("",!0),c(ka).length?(p(),S("div",qe,[(p(!0),S(K,null,Q(c(ka).filter(e=>"primary"!==c(le)(e.color)),(e,a)=>(p(),u(c(z),{key:a,class:U(["ion-margin-end ion-margin-bottom",["chip-"+c(le)(e.color)]])},{default:s(()=>[w(P(e.keyword)+" ",1),e.matchedVariant?(p(),S(K,{key:0},[w("("+P(e.matchedVariant)+")",1)],64)):N("",!0),w(" â€” "+P(c(re)(c(le)(e.color))),1)]),_:2},1032,["class"]))),128)),c(ka).some(e=>"primary"===c(le)(e.color))?(p(),S("div",He,[v(c(C),{fill:"outline",expand:"block",size:"small",color:"primary",onClick:a[8]||(a[8]=e=>ta.value=!ta.value)},{default:s(()=>[w(P(ta.value?"Hide Muslim-Friendly Ingredients":"Show Muslim-Friendly Ingredients"),1)]),_:1}),ta.value?(p(),S("div",Re,[(p(!0),S(K,null,Q(c(ka).filter(e=>"primary"===c(le)(e.color)),(e,a)=>(p(),u(c(z),{key:a,class:U(["ion-margin-end ion-margin-bottom",["chip-"+c(le)(e.color)]])},{default:s(()=>[w(P(e.keyword)+" ",1),e.matchedVariant?(p(),S(K,{key:0},[w("("+P(e.matchedVariant)+")",1)],64)):N("",!0),w(" â€” "+P(c(re)(c(le)(e.color))),1)]),_:2},1032,["class"]))),128))])):N("",!0)])):N("",!0)])):N("",!0),v(c(A),{lines:"none"},{default:s(()=>[v(c(T),{position:"stacked"},{default:s(()=>[w(P(e.$t("addProduct.stores"))+" ",1),v(c(x),{color:"danger"},{default:s(()=>a[24]||(a[24]=[w("*",-1)])),_:1,__:[24]})]),_:1}),v(oe,{stores:Ze.value,mode:"select",modelValue:Na.value.store_ids,"onUpdate:modelValue":a[9]||(a[9]=e=>Na.value.store_ids=e)},null,8,["stores","modelValue"])]),_:1}),v(c(A),null,{default:s(()=>[v(c(Y),{modelValue:Na.value.description,"onUpdate:modelValue":a[10]||(a[10]=e=>Na.value.description=e),"label-placement":"floating",placeholder:e.$t("addProduct.descriptionPlaceholder"),"auto-grow":!0,required:""},{default:s(()=>[h("div",Me,[w(P(e.$t("addProduct.description"))+" ",1),v(c(x),{color:"danger"},{default:s(()=>a[25]||(a[25]=[w("*",-1)])),_:1,__:[25]})])]),_:1},8,["modelValue","placeholder"])]),_:1}),h("div",je,[v(c(C),{size:"small",fill:"outline",color:"success",onClick:a[11]||(a[11]=e=>applyQuickDescription(la))},{default:s(()=>a[26]||(a[26]=[w(" Halal by ",-1)])),_:1,__:[26]}),v(c(C),{size:"small",fill:"outline",color:"primary",onClick:a[12]||(a[12]=e=>applyQuickDescription(ra))},{default:s(()=>a[27]||(a[27]=[w(" Muslim-friendly OK ",-1)])),_:1,__:[27]}),v(c(C),{size:"small",fill:"outline",color:"warning",onClick:a[13]||(a[13]=e=>applyQuickDescription(oa))},{default:s(()=>a[28]||(a[28]=[w(" Syubhah found ",-1)])),_:1,__:[28]}),v(c(C),{size:"small",fill:"outline",color:"danger",onClick:a[14]||(a[14]=e=>applyQuickDescription(ia))},{default:s(()=>a[29]||(a[29]=[w(" Haram found ",-1)])),_:1,__:[29]})]),v(c(A),null,{default:s(()=>[v(c(T),null,{default:s(()=>[w(P(e.$t("addProduct.frontImage"))+" ",1),v(c(x),{color:"danger"},{default:s(()=>a[30]||(a[30]=[w("*",-1)])),_:1,__:[30]})]),_:1}),v(c(V),{slot:"end"},{default:s(()=>[v(c(C),{onClick:takeFrontPicture,fill:"clear"},{default:s(()=>[v(c(F),{icon:c(Z)},null,8,["icon"])]),_:1}),v(c(C),{onClick:uploadFrontFromGallery,fill:"clear"},{default:s(()=>[v(c(F),{icon:c(J)},null,8,["icon"])]),_:1})]),_:1})]),_:1}),xa.value?(p(),S("div",Oe,[h("img",{src:xa.value,alt:"Front Preview",style:{"max-width":"100%","border-radius":"8px"}},null,8,Te)])):N("",!0),v(c(A),{style:{"--inner-border-width":"0"}},{default:s(()=>[v(c(T),null,{default:s(()=>[w(P(e.$t("addProduct.backImage"))+" ",1),v(c(x),{color:"danger"},{default:s(()=>a[31]||(a[31]=[w("*",-1)])),_:1,__:[31]})]),_:1}),v(c(V),{slot:"end"},{default:s(()=>[v(c(C),{onClick:takeBackPicture,fill:"clear"},{default:s(()=>[v(c(F),{icon:c(Z)},null,8,["icon"])]),_:1}),v(c(C),{onClick:uploadBackFromGallery,fill:"clear"},{default:s(()=>[v(c(F),{icon:c(J)},null,8,["icon"])]),_:1})]),_:1})]),_:1}),Fa.value?(p(),S("div",ze,[h("img",{src:Fa.value,alt:"Back Preview",style:{"max-width":"100%","border-radius":"8px"}},null,8,Ge)])):N("",!0)]),_:1})]),v(c(C),{expand:"block",type:"submit",class:"ion-margin-top",color:"carrot",disabled:La.value},{default:s(()=>[w(P(La.value?e.$t("addProduct.submitting"):na.editProduct?e.$t("addProduct.update"):e.$t("addProduct.submit")),1)]),_:1},8,["disabled"]),La.value?(p(),u(c(E),{key:0,id:"spinner",name:"dots",class:"ion-text-center ion-margin-top"})):N("",!0),v(c(ie),{"is-open":qa.value,message:e.$t("addProduct.submitSuccess"),duration:1500,color:"success",position:"bottom",onDidDismiss:a[15]||(a[15]=e=>qa.value=!1),style:{"margin-bottom":"100px"}},null,8,["is-open","message"]),v(c(ie),{"is-open":Ha.value,message:e.$t("addProduct.ocrSuccess"),duration:2e3,color:"success",position:"bottom",onDidDismiss:a[16]||(a[16]=e=>Ha.value=!1)},null,8,["is-open","message"]),v(c(ie),{"is-open":!!c(Xe),message:c(Xe),color:"danger",position:"bottom",duration:2500,onDidDismiss:a[17]||(a[17]=e=>Xe.value="")},null,8,["is-open","message"])],32)]),_:1})]),_:1}))}}),[["__scopeId","data-v-1527d5fc"]]);export{Qe as default};
