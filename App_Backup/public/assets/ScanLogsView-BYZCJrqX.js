import{d as a,a2 as l,a3 as e,a4 as s,a5 as u,r as t,o as n,c as o,w as r,u as d,s as _,b as i,e as c,O as f,ad as v,aM as g,S as p,ae as m,af as h,ai as y,j as w,H as k,J as x,aj as b,k as S,ak as T,i as C,n as R,t as D,p as L,ao as N,ag as M,V as I,P as O,Q as U,R as j,F as A,D as E,G as H,E as P,N as V,aK as z,b5 as J,cf as q,cg as B,y as F,_ as G}from"./index-D9IhqqAc.js";import"./html5-qrcode-D_4nuB1t.js";const K=["src"],Q={class:"log-user"},W={class:"log-product"},X={class:"log-action"},Y={class:"log-time"},Z={class:"log-time"},$=G(a({__name:"ScanLogsView",setup(a){l.extend(e),l.extend(s),l.extend(u);const G=t([]),$=t(!1),aa=t(!1),la=t(!1),ea=t(null);function closeModal(){la.value=!1,ea.value=null}function handleRefresh(a){fetchLogs(!0).then(()=>{a.target.complete()})}function fromNowToTaipei(a){return a?l.utc(a).tz("Asia/Taipei").fromNow():""}async function fetchLogs(a=!1){a&&(G.value=[],aa.value=!1);const l=G.value.length,{data:e,error:s}=await _.from("ingredient_scan_logs").select("\n      *,\n      user_profiles: user_id (\n        display_name,\n        avatar_url,\n        email\n      )\n    ").order("created_at",{ascending:!1}).range(l,l+15-1);s?console.error("‚ùå Error fetching logs:",s):((!e||e.length<15)&&(aa.value=!0),G.value.push(...e.map(a=>{var l,e,s;return{...a,display_name:null==(l=a.user_profiles)?void 0:l.display_name,email:null==(e=a.user_profiles)?void 0:e.email,avatar_url:null==(s=a.user_profiles)?void 0:s.avatar_url}})))}async function loadMore(a){$.value||aa.value||($.value=!0,await fetchLogs(),$.value=!1),a.target.complete()}return n(()=>fetchLogs(!0)),(a,l)=>(i(),o(d(F),null,{default:r(()=>[c(d(f),null,{default:r(()=>[c(v,{title:"Ingredient Scan Logs",icon:d(g),showBack:!0},null,8,["icon"])]),_:1}),c(d(p),{class:"ion-padding"},{default:r(()=>[c(d(m),{slot:"fixed",onIonRefresh:handleRefresh},{default:r(()=>[c(d(h))]),_:1}),c(d(y),null,{default:r(()=>[(i(!0),w(k,null,x(G.value,a=>(i(),o(d(b),{key:a.id,button:"",detail:"",onClick:l=>function openDetails(a){ea.value=a,la.value=!0}(a)},{default:r(()=>[a.avatar_url?(i(),o(d(T),{key:0,slot:"start"},{default:r(()=>[C("img",{src:a.avatar_url,alt:"User Avatar"},null,8,K)]),_:2},1024)):S("",!0),c(d(R),{class:"log-label"},{default:r(()=>[C("h2",Q,D(a.full_name||a.display_name||a.email||"Unknown User"),1),C("p",W,[l[0]||(l[0]=L(" üõí ",-1)),C("strong",null,D(a.product_name||"Unknown Product"),1)]),C("div",X,[c(d(N),{color:"dark"},{default:r(()=>[C("strong",null,"Status: "+D(a.auto_status||"N/A"),1)]),_:2},1024),c(d(M),{color:"camera"===a.source?"primary":"secondary"},{default:r(()=>[L(D(a.source),1)]),_:2},1032,["color"])]),C("p",Y,D(fromNowToTaipei(a.created_at)),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1}),c(d(I),{"is-open":la.value,onDidDismiss:closeModal},{default:r(()=>[c(d(f),null,{default:r(()=>[c(d(O),null,{default:r(()=>[c(d(U),null,{default:r(()=>l[1]||(l[1]=[L("Scan Details",-1)])),_:1,__:[1]}),c(d(j),{slot:"end"},{default:r(()=>[c(d(A),{onClick:closeModal},{default:r(()=>l[2]||(l[2]=[L("Close",-1)])),_:1,__:[2]})]),_:1})]),_:1})]),_:1}),c(d(p),{class:"ion-padding"},{default:r(()=>[ea.value?(i(),o(d(E),{key:0},{default:r(()=>[c(d(H),null,{default:r(()=>[c(d(P),null,{default:r(()=>[L(D(ea.value.product_name||"Unknown Product"),1)]),_:1}),C("p",Z,D(fromNowToTaipei(ea.value.created_at)),1)]),_:1}),c(d(V),null,{default:r(()=>[c(d(y),{lines:"none"},{default:r(()=>[c(d(b),null,{default:r(()=>[c(d(R),null,{default:r(()=>l[3]||(l[3]=[L("Status",-1)])),_:1,__:[3]}),c(d(M),{color:"Haram"===ea.value.auto_status?"danger":"Syubhah"===ea.value.auto_status?"warning":"Halal"===ea.value.auto_status?"success":"primary"},{default:r(()=>[L(D(ea.value.auto_status),1)]),_:1},8,["color"])]),_:1}),c(d(b),null,{default:r(()=>[c(d(R),null,{default:r(()=>l[4]||(l[4]=[L("Source",-1)])),_:1,__:[4]}),c(d(z),{slot:"end"},{default:r(()=>[L(D(ea.value.source),1)]),_:1})]),_:1}),c(d(b),null,{default:r(()=>[c(d(R),null,{default:r(()=>l[5]||(l[5]=[L("Device",-1)])),_:1,__:[5]}),c(d(z),{slot:"end"},{default:r(()=>[L(D(ea.value.device_model)+" ("+D(ea.value.platform)+") ",1)]),_:1})]),_:1}),ea.value.processing_time_ms?(i(),o(d(b),{key:0},{default:r(()=>[c(d(R),null,{default:r(()=>l[6]||(l[6]=[L("Processing Time",-1)])),_:1,__:[6]}),c(d(z),{slot:"end"},{default:r(()=>[L(D(ea.value.processing_time_ms)+" ms",1)]),_:1})]),_:1})):S("",!0),ea.value.error_message?(i(),o(d(b),{key:1},{default:r(()=>[c(d(R),null,{default:r(()=>l[7]||(l[7]=[L("Error",-1)])),_:1,__:[7]}),c(d(z),{slot:"end",color:"danger"},{default:r(()=>[L(D(ea.value.error_message),1)]),_:1})]),_:1})):S("",!0),c(d(b),null,{default:r(()=>[c(d(R),null,{default:r(()=>l[8]||(l[8]=[L("App Version",-1)])),_:1,__:[8]}),c(d(z),{slot:"end"},{default:r(()=>[L(D(ea.value.app_version),1)]),_:1})]),_:1})]),_:1}),l[9]||(l[9]=C("h1",{style:{"margin-top":"16px"}},"OCR Chinese",-1)),c(d(J),{readonly:"","auto-grow":!0,class:"copy-area",value:ea.value.ingredients_text_zh||"‚Äî"},null,8,["value"]),l[10]||(l[10]=C("h1",null,"OCR English",-1)),c(d(J),{readonly:"","auto-grow":!0,class:"copy-area",value:ea.value.ingredients_text_en||"‚Äî"},null,8,["value"]),l[11]||(l[11]=C("h1",null,"Detected Highlights",-1)),c(d(J),{readonly:"","auto-grow":!0,class:"copy-area mono",value:JSON.stringify(ea.value.highlight_summary,null,2)},null,8,["value"]),l[12]||(l[12]=C("h1",null,"Raw OCR Text",-1)),c(d(J),{readonly:"","auto-grow":!0,class:"copy-area mono",value:ea.value.ocr_raw||"‚Äî"},null,8,["value"])]),_:1,__:[9,10,11,12]})]),_:1})):S("",!0)]),_:1})]),_:1},8,["is-open"]),c(d(q),{threshold:"100px",onIonInfinite:loadMore,disabled:aa.value},{default:r(()=>[c(d(B),{"loading-spinner":"bubbles","loading-text":"Loading more logs..."})]),_:1},8,["disabled"])]),_:1})]),_:1}))}}),[["__scopeId","data-v-d4e6c8b4"]]);export{$ as default};
