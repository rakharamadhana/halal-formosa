import{d as a,r as t,a2 as s,a3 as e,a4 as l,a5 as r,o,c as n,w as i,u as c,s as u,b as d,e as _,O as g,ad as f,aM as p,S as m,ai as v,j as w,H as y,J as k,aj as h,k as x,ak as b,i as j,n as A,t as L,ao as B,ag as C,p as E,aB as F,F as P,y as U,am as q}from"./index-D9IhqqAc.js";import"./html5-qrcode-D_4nuB1t.js";const z=["src"],H={class:"log-user"},J={class:"log-action"},M={class:"log-time"},N=a({__name:"PointsLogsView",setup(a){const N=t([]);s.extend(e),s.extend(l),s.extend(r);const{currentPoints:O}=q();return o(async function fetchLogs(){const{data:a,error:t}=await u.rpc("get_point_logs_with_users",{limit_count:15});t?(console.error("Error fetching point logs:",t),N.value=[]):N.value=a||[]}),(a,t)=>(d(),n(c(U),null,{default:i(()=>[_(c(g),null,{default:i(()=>[_(f,{title:a.$t("points.title"),icon:c(p),showBack:!0},null,8,["title","icon"])]),_:1}),_(c(m),{class:"ion-padding"},{default:i(()=>[_(c(v),null,{default:i(()=>[(d(!0),w(y,null,k(N.value,a=>(d(),n(c(h),{key:a.id},{default:i(()=>[a.avatar_url?(d(),n(c(b),{key:0,slot:"start"},{default:i(()=>[j("img",{src:a.avatar_url,alt:"User Avatar"},null,8,z)]),_:2},1024)):x("",!0),_(c(A),{class:"log-label"},{default:i(()=>{return[j("h2",H,L(a.full_name||a.display_name||a.email),1),j("div",J,[_(c(B),{color:"dark"},{default:i(()=>[j("strong",null,"ðŸŽ¯ "+L(a.label),1)]),_:2},1024),_(c(C),{color:"primary",class:"log-badge"},{default:i(()=>[E(" +"+L(a.points)+" pts ",1)]),_:2},1024)]),j("p",M,L((t=a.created_at,t?s.utc(t).tz("Asia/Taipei").fromNow():"")),1)];var t}),_:2},1024),c(F)?(d(),n(c(P),{key:1,color:"danger",fill:"clear",slot:"end",onClick:t=>async function retractLog(a){if(!confirm("Are you sure you want to retract this log?"))return;const{error:t,data:s}=await u.rpc("retract_point_log",{log_id:a});if(t)console.error("âŒ Error retracting log:",t),alert("Failed to retract log: "+t.message);else{N.value=N.value.filter(t=>t.id!==a);const{data:{user:t}}=await u.auth.getUser();t&&(null==s?void 0:s.user_id)===t.id&&(O.value=s.new_points)}}(a.id)},{default:i(()=>t[0]||(t[0]=[E(" Retract ",-1)])),_:2,__:[0]},1032,["onClick"])):x("",!0)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}))}});export{N as default};
