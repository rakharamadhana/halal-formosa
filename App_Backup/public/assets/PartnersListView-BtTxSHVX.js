import{d as e,r as a,a6 as l,o as s,a8 as t,c as r,w as n,u as o,s as c,B as i,b as u,e as d,O as p,ad as m,P as _,an as v,F as f,l as g,as as h,ao as y,p as k,t as C,at as x,ap as w,au as b,av as P,i as I,c9 as q,j as L,H as R,J as S,ah as V,L as $,n as j,aw as z,S as F,k as U,D as B,W as N,ag as O,y as A,_ as D}from"./index-D9IhqqAc.js";import"./html5-qrcode-D_4nuB1t.js";const E={class:"filter-section"},H={class:"filter-title"},J={class:"category-bar"},T={class:"discover-grid"},W=["src","alt"],G={class:"chip-row"},K={class:"discover-name"},M={key:1,class:"text-center text-sm text-gray-500 mt-8"},Q=D(e({__name:"PartnersListView",setup(e){const D=i(),Q=a(!0),X=a([]),Y=a(""),Z=a(!1),ee={gold:3,silver:2,bronze:1},ae=a([]);async function fetchCategories(){const{data:e,error:a}=await c.from("partner_scopes").select("id, name, slug, icon, color").eq("is_active",!0).order("name");a?console.error("[Scopes]",a):ae.value=null!=e?e:[]}async function fetchPartners(){const{data:e,error:a}=await c.from("partners").select("\n      id,\n      name,\n      logo_url,\n      partner_tier,\n      partners_scopes (\n        scope_id,\n        partner_scopes (\n          id,\n          name\n        )\n      )\n    ").eq("is_active",!0);a?console.error("[Partners]",a):le.value=(null!=e?e:[]).map(e=>{var a,l;return{id:e.id,name:e.name,logo:e.logo_url,tier:e.partner_tier,scopeIds:(null!=(a=e.partners_scopes)?a:[]).map(e=>e.scope_id),scopes:(null!=(l=e.partners_scopes)?l:[]).map(e=>e.partner_scopes.name)}})}const le=a([]),se=l(()=>le.value.filter(e=>{const a=e.name.toLowerCase().includes(Y.value.toLowerCase());if(!X.value.length)return a;const l=e.scopeIds.some(e=>X.value.includes(e));return a&&l}).sort((e,a)=>{var l,s,t,r;const n=null!=(s=ee[null!=(l=e.tier)?l:""])?s:0,o=null!=(r=ee[null!=(t=a.tier)?t:""])?r:0;return n!==o?o-n:e.name.localeCompare(a.name)}));function handleSearchInput(e){const a=e.target.value.trim();Y.value=a,a.length>1&&t.log("partner_search",{query:a})}function clearFilters(){t.log("partner_filter_clear",{cleared_categories:X.value}),X.value=[]}return s(async()=>{t.log("partners_page_open"),Q.value=!0,await Promise.all([fetchCategories(),fetchPartners()]),Q.value=!1}),(e,a)=>(u(),r(o(A),null,{default:n(()=>[d(o(p),null,{default:n(()=>[d(m,{title:e.$t("partner.title"),showBack:!0,backRoute:"/home",icon:"none"},null,8,["title"]),d(o(_),{style:{padding:"8px"}},{default:n(()=>[d(o(v),{modelValue:Y.value,"onUpdate:modelValue":a[0]||(a[0]=e=>Y.value=e),placeholder:e.$t("partner.searchPlaceholder"),debounce:500,class:"rounded",onIonInput:handleSearchInput},null,8,["modelValue","placeholder"])]),_:1}),d(o(_),{class:"search-toolbar"},{default:n(()=>[d(o(f),{fill:"clear",size:"small",onClick:a[1]||(a[1]=e=>Z.value=!Z.value)},{default:n(()=>[d(o(g),{icon:o(h)},null,8,["icon"]),d(o(y),{class:"toolbar-label"},{default:n(()=>[k(" Â  "+C(e.$t("common.filters")),1)]),_:1}),d(o(g),{icon:Z.value?o(x):o(w)},null,8,["icon"])]),_:1}),d(b,{name:"collapse"},{default:n(()=>[P(I("div",E,[I("div",H,[d(o(g),{icon:o(q)},null,8,["icon"]),k(" "+C(e.$t("partner.categories")),1)]),I("div",J,[(u(!0),L(R,null,S(ae.value,e=>(u(),r(o(V),{key:e.id,class:$(["category-chip",{active:X.value.includes(e.id)}]),onClick:a=>function toggleCategory(e){const a=X.value.indexOf(e);-1===a?(X.value.push(e),t.log("partner_filter_add",{category_id:e})):(X.value.splice(a,1),t.log("partner_filter_remove",{category_id:e}))}(e.id)},{default:n(()=>[d(o(j),null,{default:n(()=>[k(C(e.name),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))])],512),[[z,Z.value]])]),_:1})]),_:1})]),_:1}),d(o(F),{class:"ion-padding"},{default:n(()=>[X.value.length?(u(),r(o(f),{key:0,size:"small",fill:"clear",color:"medium",onClick:clearFilters},{default:n(()=>a[2]||(a[2]=[k(" Clear filters ",-1)])),_:1,__:[2]})):U("",!0),I("div",T,[Q.value?(u(),L(R,{key:0},S(4,e=>d(o(B),{key:"skeleton-"+e,class:"discover-item"},{default:n(()=>[d(o(N),{animated:"",style:{width:"100%",height:"140px","border-radius":"12px"}}),d(o(N),{animated:"",style:{width:"80%",height:"16px",margin:"8px auto"}})]),_:2},1024)),64)):(u(!0),L(R,{key:1},S(se.value,e=>(u(),r(o(B),{key:e.id,class:$(["discover-item",e.tier]),onClick:a=>function openPartner(e){t.log("partner_click",{source:"partners_page",partner_id:e.id,partner_name:e.name,partner_tier:e.tier,active_categories:X.value,search_query:Y.value||null}),D.push("/partner/".concat(e.id))}(e)},{default:n(()=>[e.tier?(u(),r(o(O),{key:0,class:$(["tier-badge",e.tier])},{default:n(()=>[k(C(e.tier.toUpperCase())+" PARTNER ",1)]),_:2},1032,["class"])):U("",!0),I("img",{src:e.logo||"https://placehold.co/300x300?text=".concat(encodeURIComponent(e.name)),alt:e.name,class:"discover-img"},null,8,W),d(o(j),{class:"discover-label"},{default:n(()=>[I("div",G,[(u(!0),L(R,null,S(e.scopes.slice(0,2),e=>(u(),r(o(V),{key:e,color:"primary"},{default:n(()=>[k(C(e),1)]),_:2},1024))),128)),e.scopes.length>2?(u(),r(o(V),{key:0,color:"medium",class:"more-chip"},{default:n(()=>[k(" +"+C(e.scopes.length-2),1)]),_:2},1024)):U("",!0)]),I("p",K,C(e.name),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),Q.value||0!==se.value.length?U("",!0):(u(),L("p",M," No partner found "))]),_:1})]),_:1}))}}),[["__scopeId","data-v-85143cd5"]]);export{Q as default};
