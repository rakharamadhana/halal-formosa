import{d as a,r as e,bm as l,o as u,s as t,c as s,w as o,u as n,B as r,b as d,e as c,O as i,P as v,Q as p,p as m,S as _,k as f,D as b,G as g,E as k,t as y,N as w,aj as R,n as x,by as h,b5 as C,F as D,bC as P,y as S}from"./index-D9IhqqAc.js";import"./html5-qrcode-D_4nuB1t.js";const V=a({__name:"ReportView",setup(a){const V=l(),j=r(),q=e(!1),B=e(""),E=e("success"),F=V.params.barcode,O=e(null),T=e(""),U=e(null);const G=e(!1);async function submitReport(){var a,e;if(!O.value||!T.value.trim())return;G.value=!0;const{error:l}=await t.from("product_reports").insert([{barcode:O.value.barcode,description:T.value.trim(),created_at:(new Date).toISOString(),reported_by:null!=(e=null==(a=U.value)?void 0:a.id)?e:null}]);G.value=!1,l?(B.value="Failed to submit report.",E.value="danger"):(B.value="Report submitted!",E.value="success",setTimeout(()=>j.back(),1e3)),q.value=!0}return u(async()=>{const{data:{user:a}}=await t.auth.getUser();U.value=a,F&&async function fetchProduct(){const{data:a,error:e}=await t.from("products").select("*").eq("barcode",F).single();e?(B.value="âŒ Product not found.",E.value="danger",q.value=!0,setTimeout(()=>j.back(),1500)):O.value=a}()}),(a,e)=>(d(),s(n(S),null,{default:o(()=>[c(n(i),null,{default:o(()=>[c(n(v),null,{default:o(()=>[c(n(p),null,{default:o(()=>e[3]||(e[3]=[m("Report Product",-1)])),_:1,__:[3]})]),_:1})]),_:1}),c(n(_),{class:"ion-padding"},{default:o(()=>[O.value?(d(),s(n(b),{key:0},{default:o(()=>[c(n(g),null,{default:o(()=>[c(n(k),null,{default:o(()=>[m(y(O.value.name),1)]),_:1})]),_:1}),c(n(w),null,{default:o(()=>[c(n(R),null,{default:o(()=>[c(n(x),{position:"stacked"},{default:o(()=>e[4]||(e[4]=[m("Barcode",-1)])),_:1,__:[4]}),c(n(h),{value:O.value.barcode,readonly:""},null,8,["value"])]),_:1}),c(n(R),null,{default:o(()=>[c(n(C),{label:"Reason","label-placement":"floating",modelValue:T.value,"onUpdate:modelValue":e[0]||(e[0]=a=>T.value=a),"auto-grow":"",placeholder:"Explain the issue"},null,8,["modelValue"])]),_:1}),c(n(D),{expand:"block",color:"danger",onClick:submitReport,disabled:!T.value.trim()||G.value},{default:o(()=>e[5]||(e[5]=[m(" Submit Report ",-1)])),_:1,__:[5]},8,["disabled"]),c(n(D),{expand:"block",fill:"clear",onClick:e[1]||(e[1]=a=>n(j).back())},{default:o(()=>e[6]||(e[6]=[m(" Cancel ",-1)])),_:1,__:[6]})]),_:1})]),_:1})):f("",!0),c(n(P),{"is-open":q.value,message:B.value,color:E.value,duration:"2000",onDidDismiss:e[2]||(e[2]=a=>q.value=!1),style:{transform:"translateY(-55px)"}},null,8,["is-open","message","color"])]),_:1})]),_:1}))}});export{V as default};
