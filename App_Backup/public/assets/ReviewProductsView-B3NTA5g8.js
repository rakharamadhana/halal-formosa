import{d as e,r as a,a6 as l,o as t,s as o,c as i,w as n,u as r,b as s,e as u,O as d,ad as c,aM as p,S as v,j as m,ai as f,H as g,J as _,aj as h,bh as w,W as y,n as k,i as b,t as $,ao as M,p as V,V as C,P as x,Q as P,R as I,F as H,k as j,by as z,aq as L,ar as S,ah as q,L as A,b5 as U,bp as D,bq as T,br as O,y as R,cv as E}from"./index-D9IhqqAc.js";import{Z as F}from"./zoom-oVw40Yze.js";import"./html5-qrcode-D_4nuB1t.js";const N={key:0},B=["src","alt"],J={class:"ion-margin-top ion-padding-horizontal"},Q={style:{margin:"0","padding-left":"1.2rem"}},W=["innerHTML"],Z={key:0,class:"ion-margin-top"},G={key:1,class:"ion-margin-top ingredient-legend"},K={class:"ion-margin-top ion-padding-horizontal"},X=["src","alt"],Y=["src","alt"],ee={style:{"margin-top":"20px",display:"flex",gap:"12px"}},ae={class:"swiper-zoom-container"},le=["src","alt"],te={class:"swiper-zoom-container"},oe=["src","alt"],ie=e({__name:"ReviewProductsView",setup(e){const ie=a([]),ne=[T,F],re=a([]),se=a(!1),ue=a(null),de=a(!1),ce=a(0),pe=a({}),ve=a(!1),me=a(!0),fe=l(()=>{if(!ue.value||!ue.value.ingredients)return[];if("Halal"===ue.value.status)return ue.value.ingredients.split(",").map(e=>({html:e.trim(),highlighted:!1})).filter(e=>e.html.length>0);const e=ue.value.ingredients.split(",").map(e=>e.trim()).filter(e=>e.length>0),a=Object.keys(pe.value).sort((e,a)=>a.length-e.length),l=e.map(e=>{const l=e.toLowerCase(),t=a.find(e=>l.includes(e.toLowerCase()));if(t){const a=pe.value[t];return{html:'<span style="font-weight:600;color:var('.concat(a,');">').concat(e,"</span>"),highlighted:!0}}return{html:e,highlighted:!1}});return l.sort((e,a)=>Number(a.highlighted)-Number(e.highlighted)),l}),ge=l(()=>ve.value?fe.value:fe.value.slice(0,5)),_e=l(()=>{const e=new Set;return fe.value.forEach(a=>{if(a.highlighted){const l=a.html.match(/var\((--ion-color-[^)]+)\)/);l&&e.add(l[1])}}),Array.from(e)}),he={"--ion-color-success":"Halal","--ion-color-primary":"Muslim-friendly","--ion-color-warning":"Syubhah","--ion-color-danger":"Haram"};function colorToChipClass(e){switch(e){case"--ion-color-success":return"chip-success";case"--ion-color-primary":return"chip-primary";case"--ion-color-warning":return"chip-warning";case"--ion-color-danger":return"chip-danger";default:return"chip-medium"}}function openImageModal(e){ce.value=e,de.value=!0}function closeImageModal(){de.value=!1}async function loadPendingProducts(){me.value=!0;const{data:e,error:a}=await o.from("products").select("*").eq("approved",!1).order("created_at",{ascending:!1});!a&&e&&(re.value=e),me.value=!1}function closeModal(){ue.value=null,se.value=!1}return t(async()=>{const{data:e,error:a}=await o.from("ingredient_highlights").select("keyword, color");!a&&e&&(pe.value=Object.fromEntries(e.map(e=>[e.keyword,e.color]))),await loadPendingProducts(),await async function loadCategories(){const{data:e,error:a}=await o.from("product_categories").select("id, name");!a&&e&&(ie.value=e)}()}),(e,a)=>(s(),i(r(R),null,{default:n(()=>[u(r(d),null,{default:n(()=>[u(c,{title:e.$t("review.title"),icon:r(p),showBack:!0,backRoute:"/search"},null,8,["title","icon"])]),_:1}),u(r(v),{class:"ion-padding"},{default:n(()=>[me.value?(s(),m("div",N,[u(r(f),null,{default:n(()=>[(s(),m(g,null,_(5,e=>u(r(h),{key:e},{default:n(()=>[u(r(w),{slot:"start"},{default:n(()=>[u(r(y),{animated:"",style:{width:"64px",height:"64px","border-radius":"8px"}})]),_:1}),u(r(k),null,{default:n(()=>[b("h2",null,[u(r(y),{animated:"",style:{width:"60%",height:"16px"}})]),b("p",null,[u(r(y),{animated:"",style:{width:"40%",height:"14px"}})])]),_:1})]),_:2},1024)),64))]),_:1})])):re.value.length?(s(),i(r(f),{key:1},{default:n(()=>[(s(!0),m(g,null,_(re.value,a=>(s(),i(r(h),{key:a.id,button:"",detail:"",onClick:e=>function openProductModal(e){ue.value=E({...e}),se.value=!0}(a)},{default:n(()=>[u(r(w),{slot:"start"},{default:n(()=>[b("img",{src:a.photo_front_url,alt:e.$t("review.imageAlt")},null,8,B)]),_:2},1024),u(r(k),null,{default:n(()=>[b("h2",null,$(a.name),1),b("p",null,$(a.barcode),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):(s(),i(r(M),{key:2,color:"medium"},{default:n(()=>[V($(e.$t("review.noPending")),1)]),_:1})),u(r(C),{"is-open":se.value,onDidDismiss:closeModal},{default:n(()=>[u(r(d),null,{default:n(()=>[u(r(x),null,{default:n(()=>[u(r(P),null,{default:n(()=>[V($(e.$t("review.modalTitle")),1)]),_:1}),u(r(I),{slot:"end"},{default:n(()=>[u(r(H),{onClick:closeModal},{default:n(()=>[V($(e.$t("review.close")),1)]),_:1})]),_:1})]),_:1})]),_:1}),u(r(v),{class:"ion-padding"},{default:n(()=>[ue.value?(s(),i(r(f),{key:0},{default:n(()=>[u(r(h),null,{default:n(()=>[u(r(k),{position:"stacked"},{default:n(()=>[V($(e.$t("review.barcode")),1)]),_:1}),u(r(z),{modelValue:ue.value.barcode,"onUpdate:modelValue":a[0]||(a[0]=e=>ue.value.barcode=e),readonly:""},null,8,["modelValue"])]),_:1}),u(r(h),null,{default:n(()=>[u(r(k),{position:"stacked"},{default:n(()=>[V($(e.$t("review.name")),1)]),_:1}),u(r(z),{modelValue:ue.value.name,"onUpdate:modelValue":a[1]||(a[1]=e=>ue.value.name=e)},null,8,["modelValue"])]),_:1}),u(r(h),null,{default:n(()=>[u(r(k),{position:"stacked"},{default:n(()=>[V($(e.$t("review.status")),1)]),_:1}),u(r(L),{modelValue:ue.value.status,"onUpdate:modelValue":a[2]||(a[2]=e=>ue.value.status=e),interface:"popover"},{default:n(()=>[u(r(S),{value:"Halal"},{default:n(()=>[V($(e.$t("review.statusHalal")),1)]),_:1}),u(r(S),{value:"Muslim-friendly"},{default:n(()=>[V($(e.$t("review.statusMuslimFriendly")),1)]),_:1}),u(r(S),{value:"Syubhah"},{default:n(()=>[V($(e.$t("review.statusSyubhah")),1)]),_:1}),u(r(S),{value:"Haram"},{default:n(()=>[V($(e.$t("review.statusHaram")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1}),u(r(h),null,{default:n(()=>[u(r(k),{position:"stacked"},{default:n(()=>[V($(e.$t("review.category")),1)]),_:1}),u(r(L),{modelValue:ue.value.product_category_id,"onUpdate:modelValue":a[3]||(a[3]=e=>ue.value.product_category_id=e),interface:"popover"},{default:n(()=>[(s(!0),m(g,null,_(ie.value,e=>(s(),i(r(S),{key:e.id,value:e.id},{default:n(()=>[V($(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),b("div",J,[u(r(k),{class:"ion-padding-bottom"},{default:n(()=>[b("strong",null,$(e.$t("review.ingredients")),1)]),_:1}),b("ul",Q,[(s(!0),m(g,null,_(ge.value,(e,a)=>(s(),m("li",{key:a,innerHTML:e.html},null,8,W))),128))]),fe.value.length>5?(s(),m("div",Z,[u(r(H),{fill:"clear",size:"small",onClick:a[4]||(a[4]=e=>ve.value=!ve.value)},{default:n(()=>[V($(ve.value?e.$t("review.viewLess"):e.$t("review.viewMore")),1)]),_:1})])):j("",!0),_e.value.length?(s(),m("div",G,[b("p",null,[b("strong",null,$(e.$t("review.colorLegend")),1)]),(s(!0),m(g,null,_(_e.value,a=>(s(),i(r(q),{key:a,class:A(colorToChipClass(a))},{default:n(()=>[V($(e.$t(he[a])),1)]),_:2},1032,["class"]))),128))])):j("",!0)]),u(r(h),null,{default:n(()=>[u(r(k),{position:"stacked"},{default:n(()=>[V($(e.$t("review.description")),1)]),_:1}),u(r(U),{modelValue:ue.value.description,"onUpdate:modelValue":a[5]||(a[5]=e=>ue.value.description=e),"auto-grow":""},null,8,["modelValue"])]),_:1}),b("div",K,[u(r(k),{class:"ion-padding-bottom"},{default:n(()=>[b("strong",null,$(e.$t("review.images")),1)]),_:1}),u(r(D),{modules:ne,"slides-per-view":1,class:"preview-swiper"},{default:n(()=>[ue.value.photo_front_url?(s(),i(r(O),{key:0},{default:n(()=>[b("img",{src:ue.value.photo_front_url,alt:e.$t("review.frontImageAlt"),style:{width:"100%",cursor:"pointer"},onClick:a[6]||(a[6]=e=>openImageModal(0))},null,8,X)]),_:1})):j("",!0),ue.value.photo_back_url?(s(),i(r(O),{key:1},{default:n(()=>[b("img",{src:ue.value.photo_back_url,alt:e.$t("review.backImageAlt"),style:{width:"100%",cursor:"pointer"},onClick:a[7]||(a[7]=e=>openImageModal(1))},null,8,Y)]),_:1})):j("",!0)]),_:1})]),b("div",ee,[u(r(H),{expand:"block",color:"success",onClick:a[8]||(a[8]=e=>async function approveProduct(e){const{data:a}=await o.auth.getUser(),l=null==a?void 0:a.user;if(!l)return;const{error:t}=await o.from("products").update({name:e.name,status:e.status,product_category_id:e.product_category_id,ingredients:e.ingredients,description:e.description,approved:!0,approved_by:l.id,approved_at:(new Date).toISOString()}).eq("id",e.id);t||(loadPendingProducts(),closeModal())}(ue.value))},{default:n(()=>[V($(e.$t("review.approve")),1)]),_:1}),u(r(H),{expand:"block",color:"danger",onClick:a[9]||(a[9]=e=>async function rejectProduct(e){const{error:a}=await o.from("products").delete().eq("id",e);a||(loadPendingProducts(),closeModal())}(ue.value.id))},{default:n(()=>[V($(e.$t("review.reject")),1)]),_:1})])]),_:1})):j("",!0)]),_:1}),u(r(C),{"is-open":de.value,onDidDismiss:closeImageModal},{default:n(()=>[u(r(v),{fullscreen:""},{default:n(()=>[u(r(H),{fill:"solid",color:"carrot",style:{position:"absolute",top:"16px",right:"16px","z-index":"9999"},onClick:closeImageModal},{default:n(()=>a[10]||(a[10]=[V(" âœ• ",-1)])),_:1,__:[10]}),ue.value?(s(),i(r(D),{key:0,modules:ne,zoom:!0,"slides-per-view":1,pagination:{clickable:!0},"initial-slide":ce.value,class:"fullscreen-swiper"},{default:n(()=>[ue.value.photo_front_url?(s(),i(r(O),{key:0},{default:n(()=>[b("div",ae,[b("img",{src:ue.value.photo_front_url,alt:e.$t("review.frontImageAlt")},null,8,le)])]),_:1})):j("",!0),ue.value.photo_back_url?(s(),i(r(O),{key:1},{default:n(()=>[b("div",te,[b("img",{src:ue.value.photo_back_url,alt:e.$t("review.backImageAlt")},null,8,oe)])]),_:1})):j("",!0)]),_:1},8,["initial-slide"])):j("",!0)]),_:1})]),_:1},8,["is-open"])]),_:1},8,["is-open"])]),_:1})]),_:1}))}});export{ie as default};
