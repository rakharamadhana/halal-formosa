import{d as a,j as e,b as n,i as t,k as s,X as i,H as l,J as o,L as r,_ as c,r as u,ca as d,bR as p,a6 as v,C as g,c as m,w as b,u as f,B as h,e as w,O as y,ad as M,S as k,t as q,ba as _,y as P}from"./index-D9IhqqAc.js";import"./html5-qrcode-D_4nuB1t.js";const C={class:"compass-wrapper"},E=c(a({__name:"CompassDial",props:{rotation:{},qibla:{},aligned:{type:Boolean}},setup:a=>(a,c)=>(n(),e("div",C,[t("div",{class:"dial",style:i({transform:"rotate(".concat(-a.rotation,"deg)")})},[null!==a.qibla?(n(),e("div",{key:0,class:"kaaba-arm",style:i({transform:"rotate(".concat(a.qibla,"deg)")})},c[0]||(c[0]=[t("div",{class:"kaaba"},"ðŸ•‹",-1)]),4)):s("",!0),(n(),e(l,null,o(12,a=>t("span",{key:a,class:"tick major",style:i({transform:"rotate(".concat(30*(a-1),"deg)")})},null,4)),64)),c[1]||(c[1]=t("span",{class:"label n"},"N",-1)),c[2]||(c[2]=t("span",{class:"label e"},"E",-1)),c[3]||(c[3]=t("span",{class:"label s"},"S",-1)),c[4]||(c[4]=t("span",{class:"label w"},"W",-1))],4),t("div",{class:r(["needle",{aligned:a.aligned}])},null,2),c[5]||(c[5]=t("div",{class:"center-dot"},null,-1))]))}),[["__scopeId","data-v-40212f8c"]]),Q=.12;function shortestAngleDiff(a,e){return((e-a)%360+540)%360-180}function useQiblaCompass(){const a=u(!1),e=u(!1),n=u(0),t=u(0),s=u(!1);let i=null,l=!1,o=0,r=0,c=0,v=0;function cleanup(){i&&(window.removeEventListener("deviceorientation",i),window.removeEventListener("deviceorientationabsolute",i),i=null)}return d(cleanup),p(cleanup),{loading:a,hasCompass:e,qiblaBearing:n,compassRotation:t,aligned:s,start:async function start(u,d){if(i&&cleanup(),a.value=!0,l=!1,n.value=function calculateQiblaBearing(a,e){const toRad=a=>a*Math.PI/180,n=toRad(a),t=toRad(21.422487),s=toRad(39.826206-e),i=Math.sin(s),l=Math.cos(n)*Math.tan(t)-Math.sin(n)*Math.cos(s);return(180*Math.atan2(i,l)/Math.PI+360)%360}(u,d),!(await async function requestPermission(){const a=window.DeviceOrientationEvent;if("function"==typeof(null==a?void 0:a.requestPermission))try{return"granted"===await a.requestPermission()}catch(e){return!1}return!0}()))return void(a.value=!1);i=i=>{let u=null;if(null!=i.webkitCompassHeading?u=i.webkitCompassHeading:null!=i.alpha&&(u=360-i.alpha),null===u)return;const d=u*Math.PI/180,p=Math.cos(d),g=Math.sin(d);if(!l)return o=p,r=g,c=u,v=u,l=!0,a.value=!1,void(e.value=!0);o=.88*o+p*Q,r=.88*r+g*Q;const m=(180*Math.atan2(r,o)/Math.PI+360)%360,b=shortestAngleDiff(v,m);c+=b,v=m,t.value=c;const f=Math.abs(shortestAngleDiff(m,n.value));s.value=f<=5};const p="ondeviceorientationabsolute"in window?"deviceorientationabsolute":"deviceorientation";i&&window.addEventListener(p,i,!0)}}}const B={class:"compass-container"},D={class:"info"},I={key:0,class:"bearing"},S={key:1,class:"loading-row"},x={key:2,class:"aligned-text"},A=c(a({__name:"QiblaFinderView",setup(a){h();const{loading:i,hasCompass:l,qiblaBearing:o,compassRotation:r,aligned:c,start:start}=useQiblaCompass(),u=v(()=>{const a=o.value;if(null==a)return"";const e=Math.round(a);return 0===e?"0Â° N":e<90?"".concat(e,"Â° NE"):90===e?"90Â° E":e<180?"".concat(180-e,"Â° SE"):180===e?"180Â° S":e<270?"".concat(e-180,"Â° SW"):270===e?"270Â° W":"".concat(360-e,"Â° NW")});return g(()=>{i.value=!0,navigator.geolocation.getCurrentPosition(a=>{start(a.coords.latitude,a.coords.longitude)},a=>{console.error("GPS Error:",a),i.value=!1},{enableHighAccuracy:!1,timeout:5e3,maximumAge:6e4})}),(a,d)=>(n(),m(f(P),null,{default:b(()=>[w(f(y),null,{default:b(()=>[w(M,{title:"Find Qibla",icon:"none",showBack:!0})]),_:1}),w(f(k),{class:"ion-padding qibla-page"},{default:b(()=>[t("div",B,[w(E,{rotation:f(l)?f(r):0,qibla:f(l)?f(o):null,aligned:f(c)&&f(l)},null,8,["rotation","qibla","aligned"]),t("div",D,[d[1]||(d[1]=t("h2",null,"Qibla Direction",-1)),f(l)&&!f(i)?(n(),e("p",I,q(f(o).toFixed(0))+"Â° â€¢ "+q(u.value)+" from True North ",1)):(n(),e("div",S,[w(f(_),{name:"crescent"}),d[0]||(d[0]=t("span",null,"Preparing compassâ€¦",-1))])),f(c)&&f(l)?(n(),e("p",x," You are facing Qibla ")):s("",!0)])])]),_:1})]),_:1}))}}),[["__scopeId","data-v-7e4532a6"]]);export{A as default};
