System.register(["./index-legacy-DryGZUwD.js","./zoom-legacy-C7S6DULt.js","./html5-qrcode-legacy-D5DtuMLO.js"],function(e,l){"use strict";var a,t,o,i,n,r,u,d,s,c,p,v,g,m,f,h,_,w,y,k,b,$,x,M,C,V,P,j,I,H,z,S,L,q,A,U,D,T,O,E,R,F,N,B;return{setters:[e=>{a=e.d,t=e.r,o=e.a6,i=e.o,n=e.s,r=e.c,u=e.w,d=e.u,s=e.b,c=e.e,p=e.O,v=e.ad,g=e.aM,m=e.S,f=e.j,h=e.ai,_=e.H,w=e.J,y=e.aj,k=e.bh,b=e.W,$=e.n,x=e.i,M=e.t,C=e.ao,V=e.p,P=e.V,j=e.P,I=e.Q,H=e.R,z=e.F,S=e.k,L=e.by,q=e.aq,A=e.ar,U=e.ah,D=e.L,T=e.b5,O=e.bp,E=e.bq,R=e.br,F=e.y,N=e.cv},e=>{B=e.Z},null],execute:function(){var l=document.createElement("style");l.textContent=".preview-swiper{margin-top:5px;width:100%;height:180px}.preview-swiper img{width:100%;height:100%;object-fit:cover}.fullscreen-swiper{width:100%;height:100%;background:#000}.fullscreen-swiper img{width:100%;height:auto;max-height:100%;object-fit:contain}\n",document.head.appendChild(l);const J={key:0},Q=["src","alt"],W={class:"ion-margin-top ion-padding-horizontal"},Z={style:{margin:"0","padding-left":"1.2rem"}},G=["innerHTML"],K={key:0,class:"ion-margin-top"},X={key:1,class:"ion-margin-top ingredient-legend"},Y={class:"ion-margin-top ion-padding-horizontal"},ee=["src","alt"],le=["src","alt"],ae={style:{"margin-top":"20px",display:"flex",gap:"12px"}},te={class:"swiper-zoom-container"},oe=["src","alt"],ie={class:"swiper-zoom-container"},ne=["src","alt"];e("default",a({__name:"ReviewProductsView",setup(e){const l=t([]),a=[E,B],re=t([]),ue=t(!1),de=t(null),se=t(!1),ce=t(0),pe=t({}),ve=t(!1),ge=t(!0),me=o(()=>{if(!de.value||!de.value.ingredients)return[];if("Halal"===de.value.status)return de.value.ingredients.split(",").map(e=>({html:e.trim(),highlighted:!1})).filter(e=>e.html.length>0);const e=de.value.ingredients.split(",").map(e=>e.trim()).filter(e=>e.length>0),l=Object.keys(pe.value).sort((e,l)=>l.length-e.length),a=e.map(e=>{const a=e.toLowerCase(),t=l.find(e=>a.includes(e.toLowerCase()));return t?{html:`<span style="font-weight:600;color:var(${pe.value[t]});">${e}</span>`,highlighted:!0}:{html:e,highlighted:!1}});return a.sort((e,l)=>Number(l.highlighted)-Number(e.highlighted)),a}),fe=o(()=>ve.value?me.value:me.value.slice(0,5)),he=o(()=>{const e=new Set;return me.value.forEach(l=>{if(l.highlighted){const a=l.html.match(/var\((--ion-color-[^)]+)\)/);a&&e.add(a[1])}}),Array.from(e)}),_e={"--ion-color-success":"Halal","--ion-color-primary":"Muslim-friendly","--ion-color-warning":"Syubhah","--ion-color-danger":"Haram"};function colorToChipClass(e){switch(e){case"--ion-color-success":return"chip-success";case"--ion-color-primary":return"chip-primary";case"--ion-color-warning":return"chip-warning";case"--ion-color-danger":return"chip-danger";default:return"chip-medium"}}function openImageModal(e){ce.value=e,se.value=!0}function closeImageModal(){se.value=!1}async function loadPendingProducts(){ge.value=!0;const{data:e,error:l}=await n.from("products").select("*").eq("approved",!1).order("created_at",{ascending:!1});!l&&e&&(re.value=e),ge.value=!1}function closeModal(){de.value=null,ue.value=!1}return i(async()=>{const{data:e,error:a}=await n.from("ingredient_highlights").select("keyword, color");!a&&e&&(pe.value=Object.fromEntries(e.map(e=>[e.keyword,e.color]))),await loadPendingProducts(),await async function loadCategories(){const{data:e,error:a}=await n.from("product_categories").select("id, name");!a&&e&&(l.value=e)}()}),(e,t)=>(s(),r(d(F),null,{default:u(()=>[c(d(p),null,{default:u(()=>[c(v,{title:e.$t("review.title"),icon:d(g),showBack:!0,backRoute:"/search"},null,8,["title","icon"])]),_:1}),c(d(m),{class:"ion-padding"},{default:u(()=>[ge.value?(s(),f("div",J,[c(d(h),null,{default:u(()=>[(s(),f(_,null,w(5,e=>c(d(y),{key:e},{default:u(()=>[c(d(k),{slot:"start"},{default:u(()=>[c(d(b),{animated:"",style:{width:"64px",height:"64px","border-radius":"8px"}})]),_:1}),c(d($),null,{default:u(()=>[x("h2",null,[c(d(b),{animated:"",style:{width:"60%",height:"16px"}})]),x("p",null,[c(d(b),{animated:"",style:{width:"40%",height:"14px"}})])]),_:1})]),_:2},1024)),64))]),_:1})])):re.value.length?(s(),r(d(h),{key:1},{default:u(()=>[(s(!0),f(_,null,w(re.value,l=>(s(),r(d(y),{key:l.id,button:"",detail:"",onClick:e=>function openProductModal(e){de.value=N({...e}),ue.value=!0}(l)},{default:u(()=>[c(d(k),{slot:"start"},{default:u(()=>[x("img",{src:l.photo_front_url,alt:e.$t("review.imageAlt")},null,8,Q)]),_:2},1024),c(d($),null,{default:u(()=>[x("h2",null,M(l.name),1),x("p",null,M(l.barcode),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):(s(),r(d(C),{key:2,color:"medium"},{default:u(()=>[V(M(e.$t("review.noPending")),1)]),_:1})),c(d(P),{"is-open":ue.value,onDidDismiss:closeModal},{default:u(()=>[c(d(p),null,{default:u(()=>[c(d(j),null,{default:u(()=>[c(d(I),null,{default:u(()=>[V(M(e.$t("review.modalTitle")),1)]),_:1}),c(d(H),{slot:"end"},{default:u(()=>[c(d(z),{onClick:closeModal},{default:u(()=>[V(M(e.$t("review.close")),1)]),_:1})]),_:1})]),_:1})]),_:1}),c(d(m),{class:"ion-padding"},{default:u(()=>[de.value?(s(),r(d(h),{key:0},{default:u(()=>[c(d(y),null,{default:u(()=>[c(d($),{position:"stacked"},{default:u(()=>[V(M(e.$t("review.barcode")),1)]),_:1}),c(d(L),{modelValue:de.value.barcode,"onUpdate:modelValue":t[0]||(t[0]=e=>de.value.barcode=e),readonly:""},null,8,["modelValue"])]),_:1}),c(d(y),null,{default:u(()=>[c(d($),{position:"stacked"},{default:u(()=>[V(M(e.$t("review.name")),1)]),_:1}),c(d(L),{modelValue:de.value.name,"onUpdate:modelValue":t[1]||(t[1]=e=>de.value.name=e)},null,8,["modelValue"])]),_:1}),c(d(y),null,{default:u(()=>[c(d($),{position:"stacked"},{default:u(()=>[V(M(e.$t("review.status")),1)]),_:1}),c(d(q),{modelValue:de.value.status,"onUpdate:modelValue":t[2]||(t[2]=e=>de.value.status=e),interface:"popover"},{default:u(()=>[c(d(A),{value:"Halal"},{default:u(()=>[V(M(e.$t("review.statusHalal")),1)]),_:1}),c(d(A),{value:"Muslim-friendly"},{default:u(()=>[V(M(e.$t("review.statusMuslimFriendly")),1)]),_:1}),c(d(A),{value:"Syubhah"},{default:u(()=>[V(M(e.$t("review.statusSyubhah")),1)]),_:1}),c(d(A),{value:"Haram"},{default:u(()=>[V(M(e.$t("review.statusHaram")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1}),c(d(y),null,{default:u(()=>[c(d($),{position:"stacked"},{default:u(()=>[V(M(e.$t("review.category")),1)]),_:1}),c(d(q),{modelValue:de.value.product_category_id,"onUpdate:modelValue":t[3]||(t[3]=e=>de.value.product_category_id=e),interface:"popover"},{default:u(()=>[(s(!0),f(_,null,w(l.value,e=>(s(),r(d(A),{key:e.id,value:e.id},{default:u(()=>[V(M(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),x("div",W,[c(d($),{class:"ion-padding-bottom"},{default:u(()=>[x("strong",null,M(e.$t("review.ingredients")),1)]),_:1}),x("ul",Z,[(s(!0),f(_,null,w(fe.value,(e,l)=>(s(),f("li",{key:l,innerHTML:e.html},null,8,G))),128))]),me.value.length>5?(s(),f("div",K,[c(d(z),{fill:"clear",size:"small",onClick:t[4]||(t[4]=e=>ve.value=!ve.value)},{default:u(()=>[V(M(ve.value?e.$t("review.viewLess"):e.$t("review.viewMore")),1)]),_:1})])):S("",!0),he.value.length?(s(),f("div",X,[x("p",null,[x("strong",null,M(e.$t("review.colorLegend")),1)]),(s(!0),f(_,null,w(he.value,l=>(s(),r(d(U),{key:l,class:D(colorToChipClass(l))},{default:u(()=>[V(M(e.$t(_e[l])),1)]),_:2},1032,["class"]))),128))])):S("",!0)]),c(d(y),null,{default:u(()=>[c(d($),{position:"stacked"},{default:u(()=>[V(M(e.$t("review.description")),1)]),_:1}),c(d(T),{modelValue:de.value.description,"onUpdate:modelValue":t[5]||(t[5]=e=>de.value.description=e),"auto-grow":""},null,8,["modelValue"])]),_:1}),x("div",Y,[c(d($),{class:"ion-padding-bottom"},{default:u(()=>[x("strong",null,M(e.$t("review.images")),1)]),_:1}),c(d(O),{modules:a,"slides-per-view":1,class:"preview-swiper"},{default:u(()=>[de.value.photo_front_url?(s(),r(d(R),{key:0},{default:u(()=>[x("img",{src:de.value.photo_front_url,alt:e.$t("review.frontImageAlt"),style:{width:"100%",cursor:"pointer"},onClick:t[6]||(t[6]=e=>openImageModal(0))},null,8,ee)]),_:1})):S("",!0),de.value.photo_back_url?(s(),r(d(R),{key:1},{default:u(()=>[x("img",{src:de.value.photo_back_url,alt:e.$t("review.backImageAlt"),style:{width:"100%",cursor:"pointer"},onClick:t[7]||(t[7]=e=>openImageModal(1))},null,8,le)]),_:1})):S("",!0)]),_:1})]),x("div",ae,[c(d(z),{expand:"block",color:"success",onClick:t[8]||(t[8]=e=>async function approveProduct(e){const{data:l}=await n.auth.getUser(),a=null==l?void 0:l.user;if(!a)return;const{error:t}=await n.from("products").update({name:e.name,status:e.status,product_category_id:e.product_category_id,ingredients:e.ingredients,description:e.description,approved:!0,approved_by:a.id,approved_at:(new Date).toISOString()}).eq("id",e.id);t||(loadPendingProducts(),closeModal())}(de.value))},{default:u(()=>[V(M(e.$t("review.approve")),1)]),_:1}),c(d(z),{expand:"block",color:"danger",onClick:t[9]||(t[9]=e=>async function rejectProduct(e){const{error:l}=await n.from("products").delete().eq("id",e);l||(loadPendingProducts(),closeModal())}(de.value.id))},{default:u(()=>[V(M(e.$t("review.reject")),1)]),_:1})])]),_:1})):S("",!0)]),_:1}),c(d(P),{"is-open":se.value,onDidDismiss:closeImageModal},{default:u(()=>[c(d(m),{fullscreen:""},{default:u(()=>[c(d(z),{fill:"solid",color:"carrot",style:{position:"absolute",top:"16px",right:"16px","z-index":"9999"},onClick:closeImageModal},{default:u(()=>t[10]||(t[10]=[V(" âœ• ",-1)])),_:1,__:[10]}),de.value?(s(),r(d(O),{key:0,modules:a,zoom:!0,"slides-per-view":1,pagination:{clickable:!0},"initial-slide":ce.value,class:"fullscreen-swiper"},{default:u(()=>[de.value.photo_front_url?(s(),r(d(R),{key:0},{default:u(()=>[x("div",te,[x("img",{src:de.value.photo_front_url,alt:e.$t("review.frontImageAlt")},null,8,oe)])]),_:1})):S("",!0),de.value.photo_back_url?(s(),r(d(R),{key:1},{default:u(()=>[x("div",ie,[x("img",{src:de.value.photo_back_url,alt:e.$t("review.backImageAlt")},null,8,ne)])]),_:1})):S("",!0)]),_:1},8,["initial-slide"])):S("",!0)]),_:1})]),_:1},8,["is-open"])]),_:1},8,["is-open"])]),_:1})]),_:1}))}}))}}});
