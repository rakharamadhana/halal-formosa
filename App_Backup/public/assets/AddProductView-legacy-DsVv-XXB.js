System.register(["./index-legacy-DryGZUwD.js","./html5-qrcode-legacy-D5DtuMLO.js","./useNotifier-legacy-SkfUyYsb.js"],function(e,a){"use strict";var t,l,o,r,i,d,n,u,c,s,p,v,m,g,f,h,_,b,y,k,w,P,V,C,S,x,N,$,E,I,B,D,A,U,q,F,L,H,R,M,j,O,z,T,G,K,Q,W,X,Y,Z,J,ee,ae,te,le,oe,re,ie,de,ne,ue,ce,se,pe,ve,me,ge,fe,he,_e,be,ye,ke,we,Pe,Ve,Ce,Se,xe,Ne,Html5QrcodeSupportedFormats,Html5Qrcode,$e;return{setters:[e=>{t=e.d,l=e.bO,o=e.r,r=e.bP,i=e.a7,d=e.o,n=e.s,u=e.bQ,c=e.bR,s=e.c,p=e.w,v=e.u,m=e.b,g=e.e,f=e.O,h=e.ad,_=e.bd,b=e.S,y=e.i,k=e.V,w=e.P,P=e.Q,V=e.p,C=e.t,S=e.R,x=e.F,N=e.j,$=e.k,E=e.bS,I=e.ba,B=e.aS,D=e.bT,A=e.aj,U=e.L,q=e.by,F=e.ao,L=e.l,H=e.K,R=e.bU,M=e.bV,j=e.Z,O=e.aK,z=e.bh,T=e.bW,G=e.n,K=e.ah,Q=e.aq,W=e.H,X=e.J,Y=e.ar,Z=e.a9,J=e.b5,ee=e.bz,ae=e.bA,te=e.bX,le=e.bY,oe=e.U,re=e.bZ,ie=e.b_,de=e.bL,ne=e.bC,ue=e.y,ce=e.bN,se=e.bD,pe=e.b$,ve=e.bE,me=e.bF,ge=e.c0,fe=e.c1,he=e.c2,_e=e.c3,be=e.c4,ye=e.c5,ke=e.c6,we=e.ac,Pe=e.c7,Ve=e.bH,Ce=e.c8,Se=e.am,xe=e.a8,Ne=e._},e=>{Html5QrcodeSupportedFormats=e.H,Html5Qrcode=e.b},e=>{$e=e.u}],execute:function(){var a=document.createElement("style");a.textContent="ion-toast[data-v-1527d5fc]{transform:translateY(-55px)}#reader[data-v-1527d5fc]{width:100%;height:260px;border-radius:8px;overflow:hidden;margin:12px auto;background:#000;position:relative}#reader__scan_region[data-v-1527d5fc],#reader__dashboard_section_csr[data-v-1527d5fc]{position:relative!important;inset:auto!important;max-width:100%!important}@media (min-width: 768px){#reader[data-v-1527d5fc]{width:400px;height:300px;border-radius:8px}}ion-item[data-v-1527d5fc]{--background: transparent}.form-container[data-v-1527d5fc]{border-radius:10px;background-color:var(--ion-color-light);box-shadow:0 2px 8px rgba(0,0,0,.05)}ion-content[data-v-1527d5fc]::part(scroll){padding-bottom:100px}.keyboard-open ion-footer[data-v-1527d5fc]{margin-bottom:300px}.barcode-valid[data-v-1527d5fc]{--highlight-color-focused: var(--ion-color-success);--border-color: var(--ion-color-success)}.barcode-invalid[data-v-1527d5fc]{--highlight-color-focused: var(--ion-color-danger);--border-color: var(--ion-color-danger)}.quick-scroll-container[data-v-1527d5fc]{display:flex;gap:8px;overflow-x:auto;padding:4px 0;scrollbar-width:none}.quick-scroll-container[data-v-1527d5fc]::-webkit-scrollbar{display:none}.quick-scroll-container ion-button[data-v-1527d5fc]{flex-shrink:0}.detected-product[data-v-1527d5fc]{border-radius:8px;background:var(--ion-color-light);padding:6px}.detected-product h3[data-v-1527d5fc]{margin:0;font-size:14px;font-weight:600}\n",document.head.appendChild(a);class BarcodeValidator{static calculateEANCheckDigit(e){const a=e.split("").map(Number);let t=0;for(let o=a.length-1,r=1;o>=0;o--,r++)t+=a[o]*(r%2==1?3:1);const l=t%10;return 0===l?0:10-l}static validateEANCheckDigit(e,a){return!!/^\d+$/.test(e)&&(e.length===a&&this.calculateEANCheckDigit(e.slice(0,-1))===Number(e.slice(-1)))}static calculateLuhnCheckDigit(e){const a=e.split("").map(Number).reverse();let t=0;for(let l=0;l<a.length;l++){let e=a[l];l%2==0&&(e*=2,e>9&&(e-=9)),t+=e}return(10-t%10)%10}static validateLuhnCheckDigit(e,a){return!!/^\d+$/.test(e)&&(e.length===a&&this.calculateLuhnCheckDigit(e.slice(0,-1))===Number(e.slice(-1)))}static calculateISBNCheckDigit(e){if(13===e.length)return this.calculateEANCheckDigit(e);{let a=0;for(let l=0;l<9;l++)a+=(10-l)*Number(e[l]);const t=(11-a%11)%11;return 10===t?"X":t}}static validateISBN10(e){if(!/^\d{9}(\d|X)$/.test(e))return!1;const a=this.calculateISBNCheckDigit(e.slice(0,-1)),t=e.slice(-1);return String(a)===t}static isValidEAN8(e){return this.validateEANCheckDigit(e,8)}static isValidEAN13(e){return this.validateEANCheckDigit(e,13)}static isValidEAN14(e){return this.validateEANCheckDigit(e,14)}static isValidUPCA(e){return this.validateEANCheckDigit(e,12)}static isValidUPCE(e){return/^\d{6,8}$/.test(e)}static isValidISBN(e){const a=e.replace(/-/g,"");return 10===a.length?this.validateISBN10(a):13===a.length&&this.validateEANCheckDigit(a,13)}static isValidIMEI(e){return!!/^\d+$/.test(e)&&(14===e.length||16===e.length||15===e.length&&this.validateLuhnCheckDigit(e,15))}static isValidGSIN(e){return this.validateEANCheckDigit(e,17)}static isValidSSCC(e){return this.validateEANCheckDigit(e,18)}static isValidGLN(e){return this.validateEANCheckDigit(e,13)}static isValidASIN(e){return/^B\d{2}\w{7}$/.test(e)||/^\d{9}(\d|X)$/.test(e)}}const Ee={key:0,class:"ion-text-center ion-padding"},Ie={class:"form-container"},Be={slot:"label"},De={key:2,class:"ion-padding"},Ae={key:3,id:"reader"},Ue={slot:"label"},qe={slot:"label"},Fe={slot:"label"},Le={slot:"label"},He={slot:"content"},Re={key:7,class:"ion-padding-horizontal ion-margin-top"},Me={key:0,class:"ion-margin-top"},je={key:0,class:"ion-padding-top"},Oe={slot:"label"},ze={class:"quick-scroll-container ion-margin-horizontal"},Te={key:8,style:{padding:"0 16px 16px"}},Ge=["src"],Ke={key:9,style:{padding:"0 16px 16px"}},Qe=["src"];e("default",Ne(t({__name:"AddProductView",props:{editProduct:{}},emits:["updated","close"],setup(e,{emit:a}){const{notifyEvent:t}=$e(),{awardAndCelebrate:Ne}=Se(),{errorMsg:We,setError:Xe}=l(),Ye=o([]),Ze=o(!1),{resizeImage:Je}=Pe(),ea=o(null),aa=o(!1),ta="Halal certified by ",la="Muslim-friendly ingredients, OK.",oa="Syubhah ingredients found.",ra="Haram ingredients found.",ia={Halal:"success","Muslim-friendly":"primary",Syubhah:"warning",Haram:"danger"},da=e,{allHighlights:na,blacklistPatterns:ua,fetchHighlightsWithCache:ca,incrementUsageCount:sa}=u(),{cropperRef:pa,cropperSrc:va,showCropper:ma,croppedPreviewUrl:ga,ocrLoading:fa,openCropper:ha,confirmCrop:_a,closeCropper:ba,ingredientHighlights:ya,ingredientsText:ka,autoStatus:wa,productName:Pa,recheckHighlightsSmart:Va}=r({allHighlights:na,blacklistPatterns:ua,fetchHighlightsWithCache:ca,incrementUsageCount:sa,setError:Xe,setBackFile:e=>{Da.value=e,Ua.value&&URL.revokeObjectURL(Ua.value),Ua.value=URL.createObjectURL(e)}}),Ca=o(null);i([wa,Pa,ka],([e,a,t])=>{e&&(Sa.value.status=e),a&&!Sa.value.name.trim()&&(Sa.value.name=a),t&&(Sa.value.ingredients=t)}),d(async()=>{const[e,a]=await Promise.all([n.from("ingredient_highlights").select("keyword, keyword_zh, color"),n.from("ingredient_blacklist").select("pattern").eq("is_active",!0)]);if(!e.error&&e.data&&(na.value=e.data),!a.error&&a.data&&(ua.value=a.data.map(e=>new RegExp(e.pattern,"i"))),da.editProduct){var t,l,o,r,i;Sa.value={barcode:da.editProduct.barcode,name:da.editProduct.name,status:da.editProduct.status,product_category_id:null!==(t=da.editProduct.product_category_id)&&void 0!==t?t:null,ingredients:null!==(l=da.editProduct.ingredients)&&void 0!==l?l:"",description:null!==(o=da.editProduct.description)&&void 0!==o?o:"",store_ids:[]},Aa.value=null!==(r=da.editProduct.photo_front_url)&&void 0!==r?r:null,Ua.value=null!==(i=da.editProduct.photo_back_url)&&void 0!==i?i:null;const{data:e}=await n.from("product_stores").select("store_id").eq("product_id",da.editProduct.id);e&&(Sa.value.store_ids=e.map(e=>e.store_id))}await(async()=>{const{data:e,error:a}=await n.from("stores").select("id, name, logo_url, sort_order").order("sort_order",{ascending:!0});!a&&e&&(Ye.value=e.map(e=>({...e,id:String(e.id)})))})(),await ca(!0),await fetchCategoryRules(),await fetchCategories()});const Sa=o({barcode:"",name:"",status:"Muslim-friendly",product_category_id:null,ingredients:"",description:"",store_ids:[]}),xa=o({}),Na={Halal:"Halal certified.","Muslim-friendly":"Muslim-friendly ingredients, OK.",Syubhah:"Syubhah ingredients found.",Haram:"Haram ingredients found."};i(()=>Sa.value.description,(e,a)=>{!Ia.value&&e!==a&&Oa.value&&(Ea.value=!0)}),i([wa,Pa,ka],([e,a])=>{var t,l;if(e&&(Sa.value.status=e,$a.value=!0,console.log("âš¡ AutoStatus applied:",e),Oa.value=!0,null!==(t=Sa.value.description)&&void 0!==t&&t.trim()||(Sa.value.description=null!==(l=Na[e])&&void 0!==l?l:"")),a&&!Sa.value.name.trim()&&(Sa.value.name=a,console.log("ðŸ· AutoProductName applied:",a)),Sa.value.name&&!Sa.value.product_category_id){const e=Sa.value.name.toLowerCase();for(const a in xa.value)if(e.includes(a)){Sa.value.product_category_id=xa.value[a],console.log(`ðŸ“‚ AutoCategory applied: "${Sa.value.product_category_id}" (matched "${a}")`);break}}}),i(()=>Sa.value.status,e=>{var a;e&&(za.value||Oa.value&&(Ea.value||(Ia.value=!0,Sa.value.description=null!==(a=Na[e])&&void 0!==a?a:"",we(()=>{Ia.value=!1}))))}),i(()=>Sa.value.barcode,async e=>{if(!e)return Ga.value=null,Ka.value="",void(Ca.value=null);const a=validateBarcode(e);if(!a.isValid)return Ga.value=!1,void(Ka.value=a.message);if(!da.editProduct){const a=await async function checkBarcodeExists(e){const{data:a}=await n.from("products").select("id, name, status, photo_front_url").eq("barcode",e).maybeSingle();return a||null}(e);if(a)return Ga.value=!1,Ka.value="âš ï¸ Product already exists",void(Ca.value={id:a.id,name:a.name,status:a.status,photo_front_url:a.photo_front_url});Ca.value=null}Ga.value=!0,Ka.value=a.message});const $a=o(!1),Ea=o(!1),Ia=o(!1),Ba=o(null),Da=o(null),Aa=o(null),Ua=o(null),qa=o(!1),Fa=o(!1),La=o(!1),Ha=o(!1),Ra=o(""),Ma=o(!1),ja=o(""),Oa=o(!1),za=o(!1),Ta=o(null),Ga=o(null),Ka=o(""),Qa=o(null),Wa=o([]),Xa=a;function onProductNameInput(e){const a=e.target;console.log("âœï¸ Product name typed:",a.value)}function handleIngredientsInput(e){const a=e.target;console.log("ðŸ¥¬ Ingredients input:",a.value)}async function recheckHighlights(){Ze.value=!0;try{await Va()}finally{Ze.value=!1}}function handleBack(){da.editProduct?Xa("close"):window.history.length>1?ce.back():ce.push("/search")}const fetchCategories=async()=>{const{data:e,error:a}=await n.from("product_categories").select("id, name").order("name");!a&&e&&(Wa.value=e)},fetchCategoryRules=async()=>{const{data:e,error:a}=await n.from("category_rules").select("keyword, category_id");!a&&e&&(xa.value=e.reduce((e,a)=>(e[a.keyword.toLowerCase()]=a.category_id,e),{}))};function applyQuickDescription(e){Sa.value.description=e}async function scanIngredientsWithCamera(){const e=await se.getPhoto({quality:90,allowEditing:!1,resultType:me.Uri,source:ve.Camera,direction:pe.Rear}),a=await fetch(e.webPath).then(e=>e.blob()),t=new File([a],`ingredients-${Date.now()}.jpg`,{type:"image/jpeg"});Ta.value=t,ha(t)}function scanIngredientsFromGallery(){const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{const a=e.target;a.files&&a.files[0]&&(Ta.value=a.files[0],ha(a.files[0]))},e.click()}const Ya=o([]),Za=o(null);async function startBarcodeScan(){if(Ma.value)return Qa.value&&(await Qa.value.stop(),document.getElementById("reader").innerHTML="",Qa.value=null),void(Ma.value=!1);Ma.value=!0;try{if(Z.isNativePlatform()){const e=await he.scanBarcode({hint:ke.ALL,scanInstructions:"Align the barcode within the frame",cameraDirection:ye.BACK,scanOrientation:be.ADAPTIVE,android:{scanningLibrary:_e.MLKIT}});null!=e&&e.ScanResult&&(await ge.impact({style:fe.Medium}),Sa.value.barcode=e.ScanResult),Ma.value=!1}else{if(await we(),!document.getElementById("reader"))return console.error("âŒ #reader container not found"),void(Ma.value=!1);const e=new Html5Qrcode("reader",{verbose:!1});Qa.value=e;const a={fps:15,qrbox:{width:300,height:150},formatsToSupport:[Html5QrcodeSupportedFormats.EAN_13,Html5QrcodeSupportedFormats.EAN_8,Html5QrcodeSupportedFormats.UPC_A,Html5QrcodeSupportedFormats.UPC_E]},t=await Html5Qrcode.getCameras();if(!t||!t.length)return console.error("âŒ No cameras found"),void(Ma.value=!1);const l=t.find(e=>/back|rear|environment/i.test(e.label)),o=l?l.id:t[0].id;if(await async function loadCameras(){try{var e;const a=await Html5Qrcode.getCameras();Ya.value=a.map(e=>({id:e.id,label:e.label||`Camera ${e.id}`}));const t=a.find(e=>/back|rear|environment/i.test(e.label));Za.value=t?t.id:(null===(e=a[0])||void 0===e?void 0:e.id)||null}catch(a){console.error("âŒ Failed to get cameras:",a)}}(),!Za.value)return console.error("âŒ No camera available"),void(Ma.value=!1);await e.start(o,a,async a=>{console.log("âœ… Web barcode detected:",a),await ge.impact({style:fe.Medium}),Sa.value.barcode=a,Oa.value=!0,await we(),ea.value&&(ea.value.$el.value=a),await e.stop(),document.getElementById("reader").innerHTML="",Qa.value=null,Ma.value=!1},e=>{console.log(e)})}}catch(e){console.error("âŒ Barcode scan failed:",e),Ma.value=!1}}async function takeFrontPicture(){try{const e=await se.getPhoto({quality:90,allowEditing:!1,resultType:me.Uri,source:ve.Camera,direction:pe.Rear});Aa.value=e.webPath||null,Ba.value=await Je(e.webPath||"")}catch(e){console.error("Error taking front photo:",e),Xe("âŒ Failed to capture front image.")}}async function takeBackPicture(){try{const e=await se.getPhoto({quality:90,allowEditing:!1,resultType:me.Uri,source:ve.Camera,direction:pe.Rear});Ua.value=e.webPath||null,Da.value=await Je(e.webPath||"")}catch(e){console.error("Error taking back photo:",e),Xe("âŒ Failed to capture back image.")}}function uploadFrontFromGallery(){const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{const a=e.target;if(a.files&&a.files[0]){const e=a.files[0],t=new FileReader;t.onload=async()=>{Aa.value=t.result,Ba.value=await Je(t.result)},t.readAsDataURL(e)}},e.click()}function uploadBackFromGallery(){const e=document.createElement("input");e.type="file",e.accept="image/*",e.onchange=e=>{const a=e.target;if(a.files&&a.files[0]){const e=a.files[0],t=new FileReader;t.onload=async()=>{Ua.value=t.result,Da.value=await Je(t.result)},t.readAsDataURL(e)}},e.click()}function validateBarcode(e){const a=e.replace(/-/g,"");return BarcodeValidator.isValidEAN8(a)||BarcodeValidator.isValidEAN13(a)||BarcodeValidator.isValidEAN14(a)||BarcodeValidator.isValidUPCA(a)||BarcodeValidator.isValidUPCE(a)||BarcodeValidator.isValidISBN(a)||BarcodeValidator.isValidIMEI(a)||BarcodeValidator.isValidGSIN(a)||BarcodeValidator.isValidSSCC(a)||BarcodeValidator.isValidGLN(a)||BarcodeValidator.isValidASIN(a)?{isValid:!0,message:"âœ… Valid barcode"}:{isValid:!1,message:"âŒ Invalid barcode"}}async function saveProductStores(e,a,t){try{if(a.length>0){const l=a.map(a=>({product_id:e,store_id:a,added_by:t})),{error:o}=await n.from("product_stores").upsert(l,{onConflict:"product_id,store_id"});if(o)throw o;const{error:r}=await n.from("product_stores").delete().eq("product_id",e).not("store_id","in",`(${a.join(",")})`);if(r)throw r}else await n.from("product_stores").delete().eq("product_id",e);console.log("âœ… Stores synced safely:",a)}catch(l){throw console.error("âŒ Failed to save product_stores:",l),l}}async function handleSubmit(){const e=["admin","contributor"].includes(Ve.value||"user");qa.value=!0,We.value="",Ha.value=!1;try{var a,l;const{data:{user:o}}=await n.auth.getUser();if(!o)return Xe("You must be logged in to submit a product."),void(qa.value=!1);const{data:r}=await n.from("user_roles").select("role").eq("user_id",o.id).single();Ce(o.id,(null==r?void 0:r.role)||"user");const{barcode:i}=Sa.value,d=validateBarcode(Sa.value.barcode);if(!d.isValid)return Xe(d.message),void(qa.value=!1);if(!Sa.value.name.trim())return Xe("Product name is required.");if(!Sa.value.status)return Xe("Product status is required.");if(!Sa.value.ingredients.trim())return Xe("Ingredients are required.");if(!Sa.value.product_category_id)return Xe("Product category is required.");if(!Sa.value.description.trim())return Xe("Description is required.");if(!da.editProduct&&!Ba.value)return Xe("Front image is required.");if(!da.editProduct&&!Da.value)return Xe("Back image is required.");const{store_ids:u,...c}=Sa.value;let s=(null===(a=da.editProduct)||void 0===a?void 0:a.photo_front_url)||"",p=(null===(l=da.editProduct)||void 0===l?void 0:l.photo_back_url)||"";if(Ba.value){const{error:e}=await n.storage.from("product-images").upload(`${i}/front.jpg`,Ba.value,{upsert:!0});if(e)return console.log(e),void Xe("âŒ Failed to upload front image.");const{data:a}=n.storage.from("product-images").getPublicUrl(`${i}/front.jpg`);s=a.publicUrl,console.log("Front image uploaded:",s)}if(Da.value){const{error:e}=await n.storage.from("product-images").upload(`${i}/back.jpg`,Da.value,{upsert:!0});if(e)return console.log(e),void Xe("âŒ Failed to upload back image.");const{data:a}=n.storage.from("product-images").getPublicUrl(`${i}/back.jpg`);p=a.publicUrl,console.log("Back image uploaded:",p)}if(da.editProduct)await n.from("products").update({...c,photo_front_url:s,photo_back_url:p,updated_at:(new Date).toISOString(),updated_by:o.id,approved:!!e||da.editProduct.approved,approved_by:e?o.id:da.editProduct.approved_by,approved_at:e?(new Date).toISOString():da.editProduct.approved_at}).eq("id",da.editProduct.id),await saveProductStores(da.editProduct.id,u,o.id),Ra.value="âœ… Product updated successfully!",await t("update_product","âœï¸ Product Updated",`${Sa.value.name} (${Sa.value.status})\nBarcode: ${Sa.value.barcode}`,s||p,{barcode:Sa.value.barcode,status:Sa.value.status,isNative:!0}),Xa("updated");else{const{data:a,error:l}=await n.from("products").insert([{...c,barcode:i,photo_front_url:s,photo_back_url:p,added_by:o.id,approved:e,approved_by:e?o.id:null,approved_at:e?(new Date).toISOString():null,created_at:(new Date).toISOString()}]).select("id").single();if(l||!a)throw l||new Error("âŒ Failed to create product, no data returned");await saveProductStores(a.id,u,o.id),Ra.value=e?"âœ… Product published successfully!":"âœ… Product submitted and awaiting approval.",e&&await t("new_product","ðŸ†• New Product Published!",`${Sa.value.name} (${Sa.value.status})\nBarcode: ${Sa.value.barcode}`,s||p,{barcode:Sa.value.barcode,status:Sa.value.status,isNative:!0}),Sa.value={barcode:"",name:"",status:"Muslim-friendly",product_category_id:null,ingredients:"",description:"",store_ids:[]},Ba.value=null,Da.value=null,Aa.value=null,Ua.value=null,ya.value=[],Ga.value=null,Ka.value="",await Ne("add_product",1e4),await xe.log("add_product_success",{barcode:i,name:Sa.value.name,status:Sa.value.status})}Fa.value=!0}catch(o){console.error("Submission error:",o),Xe(o.message||"An unexpected error occurred.")}finally{qa.value=!1}}return c(()=>{va.value&&URL.revokeObjectURL(va.value),ga.value&&URL.revokeObjectURL(ga.value)}),(e,a)=>(m(),s(v(ue),null,{default:p(()=>[g(v(f),null,{default:p(()=>[g(h,{title:da.editProduct?e.$t("addProduct.editTitle"):e.$t("addProduct.title"),icon:v(_),showProfile:!0,"show-back":"",useRouterBack:!1,onBack:handleBack},null,8,["title","icon"])]),_:1}),g(v(b),{class:"ion-padding"},{default:p(()=>[g(v(k),{"is-open":v(ma),onDidDismiss:v(ba)},{default:p(()=>[g(v(f),null,{default:p(()=>[g(v(w),null,{default:p(()=>[g(v(P),null,{default:p(()=>[V(C(e.$t("addProduct.cropIngredients")),1)]),_:1}),g(v(S),{slot:"end"},{default:p(()=>[g(v(x),{onClick:v(_a)},{default:p(()=>[V(C(e.$t("addProduct.done")),1)]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1}),g(v(b),null,{default:p(()=>[g(v(E),{ref_key:"cropperRef",ref:pa,class:"cropper",src:v(va),"stencil-props":{aspectRatio:null}},null,8,["src"]),v(fa)?(m(),N("div",Ee,[g(v(I),{name:"crescent",color:"primary"}),y("p",null,C(e.$t("addProduct.processingOcr")),1)])):$("",!0)]),_:1})]),_:1},8,["is-open","onDidDismiss"]),y("form",{onSubmit:B(handleSubmit,["prevent"])},[y("div",Ie,[g(v(D),null,{default:p(()=>[g(v(A),{class:U({"barcode-valid":!0===Ga.value,"barcode-invalid":!1===Ga.value})},{default:p(()=>[g(v(q),{ref_key:"barcodeInput",ref:ea,modelValue:Sa.value.barcode,"onUpdate:modelValue":a[0]||(a[0]=e=>Sa.value.barcode=e),required:"",type:"tel",inputmode:"numeric",pattern:"[0-9]*",maxlength:14,minlength:8,"clear-input":"","label-placement":"floating",placeholder:e.$t("addProduct.barcodePlaceholder")},{default:p(()=>[y("div",Be,[V(C(e.$t("addProduct.barcode"))+" ",1),g(v(F),{color:"danger"},{default:p(()=>a[18]||(a[18]=[V("*",-1)])),_:1,__:[18]})])]),_:1},8,["modelValue","placeholder"]),null!==Ga.value?(m(),s(v(L),{key:0,icon:Ga.value?v(H):v(R),color:Ga.value?"success":"danger",slot:"end",style:{"font-size":"20px"}},null,8,["icon","color"])):$("",!0),g(v(x),{color:"carrot",slot:"end",size:"default",onClick:startBarcodeScan},{default:p(()=>[g(v(L),{icon:Ma.value?v(M):v(j)},null,8,["icon"])]),_:1})]),_:1},8,["class"]),Ka.value?(m(),s(v(O),{key:0,color:Ga.value?"success":"danger",class:"ion-padding-start"},{default:p(()=>[V(C(Ka.value),1)]),_:1},8,["color"])):$("",!0),Ca.value?(m(),s(v(A),{key:1,lines:"none",class:"detected-product"},{default:p(()=>[g(v(z),{slot:"start"},{default:p(()=>[g(v(T),{src:Ca.value.photo_front_url||"/placeholder-product.png"},null,8,["src"])]),_:1}),g(v(G),null,{default:p(()=>{return[y("h3",null,C(Ca.value.name),1),g(v(K),{size:"small",class:U(`chip-${e=Ca.value.status,null!==(a=ia[null!=e?e:""])&&void 0!==a?a:"medium"}`)},{default:p(()=>[V(C(Ca.value.status),1)]),_:1},8,["class"])];var e,a}),_:1})]),_:1})):$("",!0),Ma.value&&Ya.value.length>1?(m(),N("div",De,[g(v(A),null,{default:p(()=>[g(v(G),null,{default:p(()=>a[19]||(a[19]=[V("Camera",-1)])),_:1,__:[19]}),g(v(Q),{modelValue:Za.value,"onUpdate:modelValue":a[1]||(a[1]=e=>Za.value=e),onIonChange:a[2]||(a[2]=e=>async function switchCamera(e){if(Qa.value)try{await Qa.value.stop(),document.getElementById("reader").innerHTML="";const a={fps:15,qrbox:{width:300,height:150},formatsToSupport:[Html5QrcodeSupportedFormats.EAN_13,Html5QrcodeSupportedFormats.EAN_8,Html5QrcodeSupportedFormats.UPC_A,Html5QrcodeSupportedFormats.UPC_E]};await Qa.value.start(e,a,async e=>{var a;console.log("âœ… Web barcode detected:",e),Sa.value.barcode=e,Oa.value=!0,await ge.impact({style:fe.Medium}),await(null===(a=Qa.value)||void 0===a?void 0:a.stop()),document.getElementById("reader").innerHTML="",Qa.value=null,Ma.value=!1},e=>{console.log("ðŸ“¡ Scan error:",e)}),Za.value=e}catch(a){console.error("âŒ Failed to switch camera:",a)}}(e.detail.value))},{default:p(()=>[(m(!0),N(W,null,X(Ya.value,e=>(m(),s(v(Y),{key:e.id,value:e.id},{default:p(()=>[V(C(e.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})])):$("",!0),Ma.value&&!v(Z).isNativePlatform()?(m(),N("div",Ae)):$("",!0),g(v(A),null,{default:p(()=>[g(v(q),{modelValue:Sa.value.name,"onUpdate:modelValue":a[3]||(a[3]=e=>Sa.value.name=e),required:"","clear-input":"","label-placement":"floating",placeholder:e.$t("addProduct.productNamePlaceholder"),onInput:onProductNameInput},{default:p(()=>[y("div",Ue,[V(C(e.$t("addProduct.productName"))+" ",1),g(v(F),{color:"danger"},{default:p(()=>a[20]||(a[20]=[V("*",-1)])),_:1,__:[20]})])]),_:1},8,["modelValue","placeholder"])]),_:1}),g(v(A),null,{default:p(()=>[g(v(Q),{modelValue:Sa.value.status,"onUpdate:modelValue":a[4]||(a[4]=e=>Sa.value.status=e),interface:"popover",required:""},{default:p(()=>[y("div",qe,[V(C(e.$t("addProduct.status"))+" ",1),g(v(F),{color:"danger"},{default:p(()=>a[21]||(a[21]=[V("*",-1)])),_:1,__:[21]})]),g(v(Y),{value:"Halal"},{default:p(()=>[V(C(e.$t("addProduct.halal")),1)]),_:1}),g(v(Y),{value:"Muslim-friendly"},{default:p(()=>[V(C(e.$t("addProduct.muslimFriendly")),1)]),_:1}),g(v(Y),{value:"Syubhah"},{default:p(()=>[V(C(e.$t("addProduct.syubhah")),1)]),_:1}),g(v(Y),{value:"Haram"},{default:p(()=>[V(C(e.$t("addProduct.haram")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1}),g(v(A),null,{default:p(()=>[g(v(Q),{modelValue:Sa.value.product_category_id,"onUpdate:modelValue":a[5]||(a[5]=e=>Sa.value.product_category_id=e),modelModifiers:{number:!0},interface:"popover",required:""},{default:p(()=>[y("div",Fe,[V(C(e.$t("addProduct.category"))+" ",1),g(v(F),{color:"danger"},{default:p(()=>a[22]||(a[22]=[V("*",-1)])),_:1,__:[22]})]),(m(!0),N(W,null,X(Wa.value,e=>(m(),s(v(Y),{key:e.id,value:e.id},{default:p(()=>[V(C(e.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),g(v(A),null,{default:p(()=>[g(v(J),{modelValue:Sa.value.ingredients,"onUpdate:modelValue":a[6]||(a[6]=e=>Sa.value.ingredients=e),"label-placement":"floating",placeholder:e.$t("addProduct.ingredientsPlaceholder"),"auto-grow":!0,onInput:handleIngredientsInput,onBlur:recheckHighlights,required:""},{default:p(()=>[y("div",Le,[V(C(e.$t("addProduct.ingredients"))+" ",1),g(v(F),{color:"danger"},{default:p(()=>a[23]||(a[23]=[V("*",-1)])),_:1,__:[23]})])]),_:1},8,["modelValue","placeholder"]),g(v(S),{slot:"end"},{default:p(()=>[g(v(x),{onClick:scanIngredientsWithCamera,disabled:v(fa)},{default:p(()=>[g(v(L),{icon:v(ee)},null,8,["icon"])]),_:1},8,["disabled"]),g(v(x),{onClick:scanIngredientsFromGallery,disabled:v(fa)},{default:p(()=>[g(v(L),{icon:v(ae)},null,8,["icon"])]),_:1},8,["disabled"])]),_:1})]),_:1}),ja.value?(m(),s(v(te),{key:4,class:"ion-margin-top ion-margin-horizontal"},{default:p(()=>[g(v(le),{value:"rawOcr"},{default:p(()=>[g(v(A),{slot:"header",style:{"background-color":"transparent"}},{default:p(()=>[g(v(G),null,{default:p(()=>[V(C(e.$t("addProduct.detectedText")),1)]),_:1})]),_:1}),y("div",He,[g(v(J),{modelValue:ja.value,"onUpdate:modelValue":a[7]||(a[7]=e=>ja.value=e),readonly:"",style:{width:"100%",background:"var(--ion-background-color-step-50)","border-bottom-left-radius":"8px","border-bottom-right-radius":"8px",padding:"8px","--padding":"8px","min-height":"100px"}},null,8,["modelValue"])])]),_:1})]),_:1})):$("",!0),v(fa)?(m(),s(v(oe),{key:5,type:"indeterminate",color:"primary",style:{"margin-top":"10px"}})):$("",!0),Ze.value?(m(),s(v(oe),{key:6,type:"indeterminate",color:"primary"})):$("",!0),v(ya).length?(m(),N("div",Re,[(m(!0),N(W,null,X(v(ya).filter(e=>"primary"!==v(re)(e.color)),(e,a)=>(m(),s(v(K),{key:a,class:U(["ion-margin-end ion-margin-bottom",["chip-"+v(re)(e.color)]])},{default:p(()=>[V(C(e.keyword)+" ",1),e.matchedVariant?(m(),N(W,{key:0},[V("("+C(e.matchedVariant)+")",1)],64)):$("",!0),V(" â€” "+C(v(ie)(v(re)(e.color))),1)]),_:2},1032,["class"]))),128)),v(ya).some(e=>"primary"===v(re)(e.color))?(m(),N("div",Me,[g(v(x),{fill:"outline",expand:"block",size:"small",color:"primary",onClick:a[8]||(a[8]=e=>aa.value=!aa.value)},{default:p(()=>[V(C(aa.value?"Hide Muslim-Friendly Ingredients":"Show Muslim-Friendly Ingredients"),1)]),_:1}),aa.value?(m(),N("div",je,[(m(!0),N(W,null,X(v(ya).filter(e=>"primary"===v(re)(e.color)),(e,a)=>(m(),s(v(K),{key:a,class:U(["ion-margin-end ion-margin-bottom",["chip-"+v(re)(e.color)]])},{default:p(()=>[V(C(e.keyword)+" ",1),e.matchedVariant?(m(),N(W,{key:0},[V("("+C(e.matchedVariant)+")",1)],64)):$("",!0),V(" â€” "+C(v(ie)(v(re)(e.color))),1)]),_:2},1032,["class"]))),128))])):$("",!0)])):$("",!0)])):$("",!0),g(v(A),{lines:"none"},{default:p(()=>[g(v(G),{position:"stacked"},{default:p(()=>[V(C(e.$t("addProduct.stores"))+" ",1),g(v(F),{color:"danger"},{default:p(()=>a[24]||(a[24]=[V("*",-1)])),_:1,__:[24]})]),_:1}),g(de,{stores:Ye.value,mode:"select",modelValue:Sa.value.store_ids,"onUpdate:modelValue":a[9]||(a[9]=e=>Sa.value.store_ids=e)},null,8,["stores","modelValue"])]),_:1}),g(v(A),null,{default:p(()=>[g(v(J),{modelValue:Sa.value.description,"onUpdate:modelValue":a[10]||(a[10]=e=>Sa.value.description=e),"label-placement":"floating",placeholder:e.$t("addProduct.descriptionPlaceholder"),"auto-grow":!0,required:""},{default:p(()=>[y("div",Oe,[V(C(e.$t("addProduct.description"))+" ",1),g(v(F),{color:"danger"},{default:p(()=>a[25]||(a[25]=[V("*",-1)])),_:1,__:[25]})])]),_:1},8,["modelValue","placeholder"])]),_:1}),y("div",ze,[g(v(x),{size:"small",fill:"outline",color:"success",onClick:a[11]||(a[11]=e=>applyQuickDescription(ta))},{default:p(()=>a[26]||(a[26]=[V(" Halal by ",-1)])),_:1,__:[26]}),g(v(x),{size:"small",fill:"outline",color:"primary",onClick:a[12]||(a[12]=e=>applyQuickDescription(la))},{default:p(()=>a[27]||(a[27]=[V(" Muslim-friendly OK ",-1)])),_:1,__:[27]}),g(v(x),{size:"small",fill:"outline",color:"warning",onClick:a[13]||(a[13]=e=>applyQuickDescription(oa))},{default:p(()=>a[28]||(a[28]=[V(" Syubhah found ",-1)])),_:1,__:[28]}),g(v(x),{size:"small",fill:"outline",color:"danger",onClick:a[14]||(a[14]=e=>applyQuickDescription(ra))},{default:p(()=>a[29]||(a[29]=[V(" Haram found ",-1)])),_:1,__:[29]})]),g(v(A),null,{default:p(()=>[g(v(G),null,{default:p(()=>[V(C(e.$t("addProduct.frontImage"))+" ",1),g(v(F),{color:"danger"},{default:p(()=>a[30]||(a[30]=[V("*",-1)])),_:1,__:[30]})]),_:1}),g(v(S),{slot:"end"},{default:p(()=>[g(v(x),{onClick:takeFrontPicture,fill:"clear"},{default:p(()=>[g(v(L),{icon:v(ee)},null,8,["icon"])]),_:1}),g(v(x),{onClick:uploadFrontFromGallery,fill:"clear"},{default:p(()=>[g(v(L),{icon:v(ae)},null,8,["icon"])]),_:1})]),_:1})]),_:1}),Aa.value?(m(),N("div",Te,[y("img",{src:Aa.value,alt:"Front Preview",style:{"max-width":"100%","border-radius":"8px"}},null,8,Ge)])):$("",!0),g(v(A),{style:{"--inner-border-width":"0"}},{default:p(()=>[g(v(G),null,{default:p(()=>[V(C(e.$t("addProduct.backImage"))+" ",1),g(v(F),{color:"danger"},{default:p(()=>a[31]||(a[31]=[V("*",-1)])),_:1,__:[31]})]),_:1}),g(v(S),{slot:"end"},{default:p(()=>[g(v(x),{onClick:takeBackPicture,fill:"clear"},{default:p(()=>[g(v(L),{icon:v(ee)},null,8,["icon"])]),_:1}),g(v(x),{onClick:uploadBackFromGallery,fill:"clear"},{default:p(()=>[g(v(L),{icon:v(ae)},null,8,["icon"])]),_:1})]),_:1})]),_:1}),Ua.value?(m(),N("div",Ke,[y("img",{src:Ua.value,alt:"Back Preview",style:{"max-width":"100%","border-radius":"8px"}},null,8,Qe)])):$("",!0)]),_:1})]),g(v(x),{expand:"block",type:"submit",class:"ion-margin-top",color:"carrot",disabled:qa.value},{default:p(()=>[V(C(qa.value?e.$t("addProduct.submitting"):da.editProduct?e.$t("addProduct.update"):e.$t("addProduct.submit")),1)]),_:1},8,["disabled"]),qa.value?(m(),s(v(I),{key:0,id:"spinner",name:"dots",class:"ion-text-center ion-margin-top"})):$("",!0),g(v(ne),{"is-open":Fa.value,message:e.$t("addProduct.submitSuccess"),duration:1500,color:"success",position:"bottom",onDidDismiss:a[15]||(a[15]=e=>Fa.value=!1),style:{"margin-bottom":"100px"}},null,8,["is-open","message"]),g(v(ne),{"is-open":La.value,message:e.$t("addProduct.ocrSuccess"),duration:2e3,color:"success",position:"bottom",onDidDismiss:a[16]||(a[16]=e=>La.value=!1)},null,8,["is-open","message"]),g(v(ne),{"is-open":!!v(We),message:v(We),color:"danger",position:"bottom",duration:2500,onDidDismiss:a[17]||(a[17]=e=>We.value="")},null,8,["is-open","message"])],32)]),_:1})]),_:1}))}}),[["__scopeId","data-v-1527d5fc"]]))}}});
